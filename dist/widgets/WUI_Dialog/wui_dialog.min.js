var WUI_Dialog=new function(){"use strict";var a={},b=null,c=null,d=null,e=0,f=0,g=0,h=0,i=null,j=[],k={dialog:"wui-dialog",content:"wui-dialog-content",btn:"wui-dialog-btn",btn_close:"wui-dialog-close",detach:"wui-dialog-detach",minimized:"wui-dialog-minimized",minimize:"wui-dialog-minimize",maximize:"wui-dialog-maximize",header:"wui-dialog-header",open:"wui-dialog-open",closed:"wui-dialog-closed",draggable:"wui-dialog-draggable",transition:"wui-dialog-transition",dim_transition:"wui-dialog-dim-transition",modal:"wui-dialog-modal",status_bar:"wui-dialog-status-bar"},l={title:"",width:"80%",height:"40%",open:!0,closable:!0,minimizable:!1,draggable:!1,resizable:!1,detachable:!1,min_width:"title",min_height:32,status_bar:!1,status_bar_content:"",keep_align_when_resized:!1,halign:"left",valign:"top",top:0,left:0,modal:!1,minimized:!1,on_close:null,on_detach:null,on_resize:null};Element.prototype._addEventListener||(Element.prototype._addEventListener=Element.prototype.addEventListener,Element.prototype.addEventListener=function(a,b,c){this._addEventListener(a,b,c),this.eventListenerList||(this.eventListenerList={}),this.eventListenerList[a]||(this.eventListenerList[a]=[]),this.eventListenerList[a].push(b)},Element.prototype._removeEventListener=Element.prototype.removeEventListener,Element.prototype.removeEventListener=function(a,b,c){if(this.eventListenerList){var d,e=this.eventListenerList[a];if(e)for(d=0;e.length>d;d+=1)if(e[d]===b){e.splice(d,1);break}}this._removeEventListener(a,b,c)});var m=function(a){for(var b=0;j.length>b;b+=1)if(j[b]===a.detachable_ref){j.splice(b,1);break}},n=function(b,c,d,e){var f,g,h,i,l=a[b.id];if(l){if(c&&l.detachable_ref&&(l.detachable_ref.closed||l.detachable_ref.close(),m(l)),e&&l.modal_element)for(document.body.removeChild(l.modal_element),g=0;j.length>g;g+=1)for(i=j[g],f=i.document.body.getElementsByClassName(k.modal),h=0;f.length>h;h+=1)i.document.body.removeChild(f[h]);l.dialog.classList.contains(k.open)&&(b.classList.add(k.closed),b.classList.remove(k.open),d&&null!==l.opts.on_close&&l.opts.on_close())}},o=function(b){var c=0,d=null,e=a[b.id];if(!e.opts.modal){for(var f in a)a.hasOwnProperty(f)&&(d=a[f].dialog,isNaN(d.style.zIndex)||(c=parseInt(d.style.zIndex,10),c>100&&(d.style.zIndex=100)));b.style.zIndex=101}},p=function(a){var b=document.createElement("div");return b.className="wui-dialog-modal",b.addEventListener("click",function(b){b.preventDefault(),n(a,!0,!0,!0)}),b.style.zIndex=16777270,b},q=function(b){var c=a[b.id],d=c.opts,e=b.parentElement.offsetWidth,f=b.parentElement.offsetHeight,g=b.offsetWidth,h=b.offsetHeight;b.style.left="center"===d.halign?Math.round((e-g)/2+d.left)+"px":"right"===d.halign?e-g+d.left+"px":d.left+"px",b.style.top="center"===d.valign?Math.round((f-h)/2+d.top)+"px":"bottom"===d.valign?f-h+d.top+"px":d.top+"px"},r=function(b,c){var d=a[c.id],e=d.resize_handler;b.classList.toggle(k.minimize),b.classList.toggle(k.maximize),c.classList.toggle(k.minimized),e&&e.classList.toggle(k.open),d.status_bar&&d.status_bar.classList.toggle(k.open)},s=function(b){null===i&&(i=setTimeout(function(){i=null;var c,d,e,f,g,h,j,l=document;if(b)for(l=b.document,c=l.getElementsByClassName(k.content),j=0;c.length>j;j+=1)e=c[j],f=e.parentElement,d=a[f.id],g=f.getElementsByClassName(k.status_bar),e.style.height=g.length>0?b.innerHeight-32+"px":b.innerHeight+"px",h=e.getBoundingClientRect(),d.opts.on_resize&&d.opts.on_resize(h.width,h.height);else for(c=l.getElementsByClassName(k.content),j=0;c.length>j;j+=1)e=c[j],f=e.parentElement,g=f.getElementsByClassName(k.status_bar),e.style.height=g.length>0?f.offsetHeight-64+"px":f.offsetHeight-32+"px",q(f),h=e.getBoundingClientRect(),d=a[f.id],d.opts.on_resize&&d.opts.on_resize(h.width,h.height)},125))},t=function(a,b){var c,d;do{if(1==a.nodeType&&a.eventListenerList)for(c in a.eventListenerList)if("length"!==c&&a.eventListenerList.hasOwnProperty(c))for(d=0;a.eventListenerList[c].length>d;d+=1)b.addEventListener(c,a.eventListenerList[c][d],!1);a.hasChildNodes()&&t(a.firstChild,b.firstChild),a=a.nextSibling,b=b.nextSibling}while(a&&b)},u=function(b){var c,d,e,f,g,h,i,l=a[b.id],m=b.firstElementChild.firstElementChild.firstElementChild,o=m.textContent||m.innerText||"",p=l.detachable_ref,q=b.getBoundingClientRect();for(b.classList.contains(k.minimized)?(c=parseInt(b.style.width,10),d=parseInt(b.style.height,10)-32):(c=q.width,d=q.height-32),e=void 0!==window.screenLeft?window.screenLeft:screen.left,f=void 0!==window.screenTop?window.screenTop:screen.top,n(b,!0,!1,!1),p=window.open("",o,["toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes","width="+c,"height="+d,"top="+(q.top+f+32),"left="+(q.left+e)].join(",")),h="",g=document.head.getElementsByTagName("link"),i=0;g.length>i;i+=1)"text/css"===g[i].type&&"stylesheet"===g[i].rel&&(h+=g[i].outerHTML);for(g=document.head.getElementsByTagName("style"),i=0;g.length>i;i+=1)h+=g[i].outerHTML;p.document.open(),p.document.write("<html><head>"+("<title>"+o+"</title>")+h+'</head><body class="wui-dialog-detach-window-body"></body></html>'),p.document.close(),p.document.body.appendChild(b.children[1].cloneNode(!0));var r=b.getElementsByClassName(k.status_bar);if(r.length>0){var u=r[0].cloneNode(!0);u.classList.add(k.open),p.document.body.appendChild(u)}p.addEventListener("resize",function(){s(p)},!1),p.addEventListener("load",function(){t(b.children[1],p.document.body.firstElementChild),l.opts.on_detach&&l.opts.on_detach(p)}),p.addEventListener("beforeunload",function(){n(b,!0,!0,!0)},!1),l.detachable_ref=p,j.push(p)},v=function(a){a.preventDefault(),a.stopPropagation();var b=a.target,c=null;b.classList.contains(k.btn_close)?(c=b.parentElement.parentElement,n(c,!1,!0,!0)):b.classList.contains(k.maximize)||b.classList.contains(k.minimize)?(c=b.parentElement.parentElement,r(b,c)):b.classList.contains(k.detach)&&(c=b.parentElement.parentElement,u(c))},w=function(a){if(b){a.preventDefault();var c,g,h,i=a.clientX,j=a.clientY,k=a.changedTouches,l=null;if(k)for(c=0;k.length>c;c+=1)if(l=k[c],l.identifier===d){i=k[c].clientX,j=k[c].clientY;break}g=i-e,h=j-f,b.style.left=g+"px",b.style.top=h+"px"}},x=function(a){if(b){var c,e=a.changedTouches,f=null,g=b.ownerDocument,h=g.defaultView||g.parentWindow;if(e){for(c=0;e.length>c;c+=1)if(f=e[c],f.identifier===d){b=null,g.body.style.cursor="default",h.removeEventListener("touchmove",w,!1),h.removeEventListener("touchend",x,!1);break}}else b=null,g.body.style.cursor="default",h.removeEventListener("mousemove",w,!1),h.removeEventListener("mouseup",x,!1)}},y=function(a){var c,g,h,i=a.clientX,j=a.clientY,l=0,m=0,n=a.changedTouches;if(a.preventDefault(),null===b)if(n)d=n[0].identifier,i=n[0].clientX,j=n[0].clientY;else if(0!==a.button)return;h=a.target.parentElement,!h.classList.contains(k.maximize)&&h.classList.contains(k.draggable)&&(b=h,c=b.ownerDocument,g=c.defaultView||c.parentWindow,o(b),c.body.style.cursor="move",l=parseInt(b.style.left,10),m=parseInt(b.style.top,10),e=i-l,f=j-m,g.addEventListener("mousemove",w,!1),g.addEventListener("touchmove",w,!1),g.addEventListener("mouseup",x,!1),g.addEventListener("touchend",x,!1))},z=function(a){a.preventDefault(),a.stopPropagation();var b=a.target.parentElement,e=b.offsetLeft,f=b.offsetTop,i=a.changedTouches,j=b.ownerDocument,l=j.defaultView||j.parentWindow;i&&(d=i[0].identifier),g=e,h=f,b.classList.remove(k.dim_transition),l.addEventListener("mousemove",A,!1),l.addEventListener("touchmove",A,!1),l.addEventListener("mouseup",B,!1),l.addEventListener("touchend",B,!1),c=b},A=function(b){b.preventDefault();var e,f,i=b.clientX,j=b.clientY,l=b.changedTouches,m=null,n=a[c.id],o=null,p=null,r=0,s=0,t=0;if(l)for(s=0;l.length>s;s+=1)if(m=l[s],m.identifier===d){i=l[s].clientX,j=l[s].clientY;break}for(e=i-g,f=j-h,p=c.firstElementChild.firstElementChild.firstElementChild,r=p.offsetWidth+148,"title"===n.opts.min_width&&r>e?e=r:n.opts.min_width>e&&(e=n.opts.min_width),n.opts.status_bar&&(t=32),n.opts.min_height+t>f&&(f=n.opts.min_height+t),c.style.width=e+"px",c.classList.contains(k.minimized)||(c.style.height=f+"px"),o=c.getElementsByClassName(k.content),s=0;o.length>s;s+=1){var u,v=o[s],w=a[v.parentElement.id];v.style.height=c.offsetHeight-32-t+"px",u=v.getBoundingClientRect(),w.opts.on_resize&&w.opts.on_resize(u.width,u.height),n.opts.keep_align_when_resized&&q(c)}},B=function(a){var b=c.ownerDocument,d=b.defaultView||b.parentWindow;a.preventDefault(),c.classList.add(k.dim_transition),d.removeEventListener("mousemove",A,!1),d.removeEventListener("touchmove",A,!1),d.removeEventListener("mouseup",B,!1),d.removeEventListener("touchend",B,!1),c=null},C=function(){for(var b in a)a.hasOwnProperty(b)&&n(a[b].dialog,!0,!1,!0)};this.create=function(b,c){var d,e={};if(void 0!==a[b])return void console.log("WUI_Dialog id '"+b+"' already created, aborting.");for(d in l)l.hasOwnProperty(d)&&(e[d]=l[d]);if(void 0!==c)for(d in c)c.hasOwnProperty(d)&&void 0!==l[d]&&(e[d]=c[d]);var f=document.getElementById(b),g=document.createElement("div"),h=null,i=null,j=null,m=null,n=null,o=null,p=null;if(null===f)return void("undefined"!=typeof console&&console.log('WUI dialog create, unknow element with id "'+b+'".'));var t=f.firstElementChild;return null===t&&(t=document.createElement("div"),f.appendChild(t)),f.style.width=e.width,f.style.height=e.height,f.classList.add(k.dialog),t.classList.add(k.content),g.className=k.header,t.style.height=e.status_bar?f.offsetHeight-64+"px":f.offsetHeight-32+"px",o=document.createElement("div"),n=document.createElement("div"),o.style.display="inline-block",n.className="wui-dialog-title",o.innerHTML=e.title,n.appendChild(o),g.appendChild(n),f.classList.add(e.open?k.open:k.closed),e.draggable&&(f.classList.toggle(k.draggable),g.addEventListener("mousedown",y,!1),g.addEventListener("touchstart",y,!1)),e.closable&&(j=document.createElement("div"),j.className=k.btn+" "+k.btn_close,j.title="Close",g.appendChild(j)),e.minimizable&&(m=document.createElement("div"),m.className=k.btn+" "+k.minimize,e.minimized&&r(m,f),g.appendChild(m)),e.detachable&&(i=document.createElement("div"),i.className=k.btn+" "+k.detach,i.title="Detach",g.appendChild(i)),e.status_bar&&(p=document.createElement("div"),p.classList.add(k.status_bar),p.classList.add(k.transition),p.classList.add(k.open),p.innerHTML=e.status_bar_content,f.appendChild(p)),f.addEventListener("click",v,!1),f.addEventListener("touchstart",v,!1),window.addEventListener("resize",function(){s(!1)},!1),window.addEventListener("beforeunload",C,!1),f.classList.add(k.transition),f.classList.add(k.dim_transition),f.insertBefore(g,t),e.resizable&&(h=document.createElement("div"),h.addEventListener("mousedown",z,!1),h.addEventListener("touchstart",z,!1),h.classList.add("wui-dialog-resize"),h.classList.add(k.transition),h.classList.add(k.open),f.appendChild(h)),a[b]={dialog:f,minimized_id:-1,resize_handler:h,opts:e,detachable_ref:null,modal_element:null,status_bar:p},q(f),b},this.setStatusBarContent=function(b,c){var d,e,f=a[b];return void 0===f?void("undefined"!=typeof console&&console.log('Cannot setStatusBarContent of WUI dialog "'+b+'".')):void(f.status_bar&&(f.status_bar.innerHTML=c,e=f.detachable_ref,e&&(e.closed||(d=e.document.body.getElementsByClassName(k.status_bar),d.length>0&&(d[0].innerHTML=c)))))},this.open=function(b,c){var d,e,f,g=a[b];if(void 0===g)return void("undefined"!=typeof console&&console.log('Cannot open WUI dialog "'+b+'".'));if(g.detachable_ref&&!g.detachable_ref.closed)return void g.detachable_ref.focus();if(f=g.dialog,g.opts.modal)for(d=p(f),g.dialog.style.zIndex=16777271,g.modal_element=d,document.body.appendChild(d),e=0;j.length>e;e+=1)d=p(f),j[e].document.body.appendChild(d);return c?void u(f):(f.classList.remove(k.closed),f.classList.add(k.open),void o(f))},this.close=function(b,c){var d=a[b];return void 0===d?void("undefined"!=typeof console&&console.log('Cannot close WUI dialog "'+b+'".')):void n(d.dialog,!0,c)},this.destroy=function(b){var c,d=a[b];return void 0===d?void console.log("Element id '"+b+"' is not a WUI_Dialog, destroying aborted."):(n(d.dialog,!0,!1,!0),c=d.dialog,c.parentElement.removeChild(c),void delete a[b])}};
