var WUI_Dialog=new function(){var a={},b=null,c=null,d=0,e=0,f=null,g={dialog:"wui-dialog",content:"wui-dialog-content",btn:"wui-dialog-btn",btn_close:"wui-dialog-close",minimize:"wui-dialog-minimize",maximize:"wui-dialog-maximize",header:"wui-dialog-header",open:"wui-dialog-open",closed:"wui-dialog-closed",draggable:"wui-dialog-draggable"},h={title:"",width:"80%",height:"40%",open:!0,closable:!0,minimizable:!1,draggable:!1,resizable:!1,halign:"left",valign:"top",top:0,left:0,modal:!1,minimized:!1,on_close:null},i=function(b,c){var d=a[b.id];d.dialog.classList.contains(g.open)&&(d.modal_element&&document.body.removeChild(d.modal_element),b.classList.add(g.closed),b.classList.remove(g.open),c&&null!==d.opts.on_close&&d.opts.on_close())},j=function(b){var c=0,d=null,e=a[b.id];if(!e.opts.modal){for(var f in a)a.hasOwnProperty(f)&&(d=a[f].dialog,isNaN(d.style.zIndex)||(c=parseInt(d.style.zIndex,10),c>100&&(d.style.zIndex=100)));b.style.zIndex=101}},k=function(b){var c=a[b.id],d=c.opts,e=b.parentElement.offsetWidth,f=b.parentElement.offsetHeight,g=b.offsetWidth,h=b.offsetHeight;b.style.left="center"===d.halign?(e-g)/2+d.left+"px":"right"===d.halign?e-g+d.left+"px":d.left+"px",b.style.top="center"===d.valign?(f-h)/2+d.top+"px":"bottom"===d.valign?f-h+d.top+"px":d.top+"px"},l=function(a,b){a.classList.toggle(g.minimize),a.classList.toggle(g.maximize),b.classList.toggle("wui-dialog-minimized")},m=function(){null===f&&(f=setTimeout(function(){f=null;var a,b=document.getElementsByClassName(g.content);for(a=0;b.length>a;a+=1){var c=b[a],d=c.parentElement;c.style.height=d.offsetHeight-32+"px",k(d)}},125))},n=function(a){a.preventDefault(),a.stopPropagation();var b=a.target,c=null;b.classList.contains(g.btn_close)?(c=b.parentElement.parentElement,i(c,!0)):(b.classList.contains(g.maximize)||b.classList.contains(g.minimize))&&(c=b.parentElement.parentElement,l(b,c))},o=function(a){a.preventDefault();var f,g,h,i=a.clientX,j=a.clientY,k=a.changedTouches,l=null;if(k)for(f=0;k.length>f;f+=1)if(l=k[f],l.identifier===c){i=k[f].clientX,j=k[f].clientY;break}g=i-d,h=j-e,b.style.left=g+"px",b.style.top=h+"px"},p=function(a){var d,e=a.changedTouches,f=null;if(e){for(d=0;e.length>d;d+=1)if(f=e[d],f.identifier===c){b=null,document.body.style.cursor="default",window.removeEventListener("touchmove",o,!1),window.removeEventListener("touchmove",p,!1);break}}else b=null,document.body.style.cursor="default",window.removeEventListener("mousemove",o,!1),window.removeEventListener("mousemove",p,!1)},q=function(a){var f=a.clientX,h=a.clientY,i=0,k=0,l=a.changedTouches;if(a.preventDefault&&a.preventDefault(),null===b)if(l)c=l[0].identifier,f=l[0].clientX,h=l[0].clientY;else if(0!==a.button)return;b=a.target.parentElement,!b.classList.contains(g.maximize)&&b.classList.contains(g.draggable)&&(j(b),document.body.style.cursor="move",i=parseInt(b.style.left,10),k=parseInt(b.style.top,10),d=f-i,e=h-k,window.addEventListener("mousemove",o,!1),window.addEventListener("touchmove",o,!1),window.addEventListener("mouseup",p,!1),window.addEventListener("touchend",p,!1))};this.create=function(b,c){var d,e={};if(void 0!==a[b])return void console.log("WUI_Dialog id '"+b+"' already created, aborting.");for(d in h)h.hasOwnProperty(d)&&(e[d]=h[d]);if(void 0!==c)for(d in c)c.hasOwnProperty(d)&&void 0!==h[d]&&(e[d]=c[d]);var f=document.getElementById(b),i=document.createElement("div"),j=null,o=null,p=null;if(null===f)return void("undefined"!=typeof console&&console.log('WUI dialog create, unknow element with id "'+b+'".'));var r=f.firstElementChild;return null===r&&(r=document.createElement("div"),f.appendChild(r)),f.style.width=e.width,f.style.height=e.height,e.resizable&&(f.style.resize="both"),f.classList.add(g.dialog),r.classList.add(g.content),i.className=g.header,r.style.height=f.offsetHeight-32+"px",""!==e.title&&(p=document.createElement("div"),p.className="wui-dialog-title",p.innerHTML=e.title,i.appendChild(p)),f.classList.add(e.open?g.open:g.closed),e.draggable&&(f.classList.toggle(g.draggable),i.addEventListener("mousedown",q,!1),i.addEventListener("touchstart",q,!1)),e.closable&&(j=document.createElement("div"),j.className=g.btn+" "+g.btn_close,i.appendChild(j)),e.minimizable&&(o=document.createElement("div"),o.className=g.btn+" "+g.minimize,e.minimized&&l(o,f),i.appendChild(o)),f.addEventListener("click",n,!1),f.addEventListener("touchstart",n,!1),window.addEventListener("resize",m,!1),f.classList.add("wui-dialog-transition"),f.insertBefore(i,r),a[b]={dialog:f,minimized_id:-1,opts:e,modal_element:null},k(f),b},this.open=function(b){var c,d=a[b];return void 0===d?void("undefined"!=typeof console&&console.log('Cannot open WUI dialog "'+b+'".')):(d.opts.modal&&(c=document.createElement("div"),c.className="wui-dialog-modal",c.addEventListener("click",function(a){a.preventDefault(),i(d.dialog,!0)}),c.style.zIndex=999999,d.dialog.style.zIndex=1e6,d.modal_element=c,document.body.appendChild(c)),d.dialog.classList.remove(g.closed),d.dialog.classList.add(g.open),void j(d.dialog))},this.close=function(b,c){var d=a[b];return void 0===d?void("undefined"!=typeof console&&console.log('Cannot close WUI dialog "'+b+'".')):void i(d.dialog,c)},this.destroy=function(b){var c,d=a[b];return void 0===d?void console.log("Element id '"+b+"' is not a WUI_Dialog, destroying aborted."):(d.modal_element&&document.body.removeChild(d.modal_element),c=d.dialog,c.parentElement.removeChild(c),void delete a[b])}};
