var WUI_Dialog=new function(){"use strict";var a={},b=null,c=null,d=null,e=0,f=0,g=0,h=0,i=null,j={dialog:"wui-dialog",content:"wui-dialog-content",btn:"wui-dialog-btn",btn_close:"wui-dialog-close",minimized:"wui-dialog-minimized",minimize:"wui-dialog-minimize",maximize:"wui-dialog-maximize",header:"wui-dialog-header",open:"wui-dialog-open",closed:"wui-dialog-closed",draggable:"wui-dialog-draggable",dim_transition:"wui-dialog-dim-transition"},k={title:"",width:"80%",height:"40%",open:!0,closable:!0,minimizable:!1,draggable:!1,resizable:!1,min_width:"title",min_height:32,keep_align_when_resized:!1,halign:"left",valign:"top",top:0,left:0,modal:!1,minimized:!1,on_close:null},l=function(b,c){var d=a[b.id];d.dialog.classList.contains(j.open)&&(d.modal_element&&document.body.removeChild(d.modal_element),b.classList.add(j.closed),b.classList.remove(j.open),c&&null!==d.opts.on_close&&d.opts.on_close())},m=function(b){var c=0,d=null,e=a[b.id];if(!e.opts.modal){for(var f in a)a.hasOwnProperty(f)&&(d=a[f].dialog,isNaN(d.style.zIndex)||(c=parseInt(d.style.zIndex,10),c>100&&(d.style.zIndex=100)));b.style.zIndex=101}},n=function(b){var c=a[b.id],d=c.opts,e=b.parentElement.offsetWidth,f=b.parentElement.offsetHeight,g=b.offsetWidth,h=b.offsetHeight;b.style.left="center"===d.halign?(e-g)/2+d.left+"px":"right"===d.halign?e-g+d.left+"px":d.left+"px",b.style.top="center"===d.valign?(f-h)/2+d.top+"px":"bottom"===d.valign?f-h+d.top+"px":d.top+"px"},o=function(b,c){var d=a[c.id];b.classList.toggle(j.minimize),b.classList.toggle(j.maximize),c.classList.toggle(j.minimized),d.resize_handler&&(d.resize_handler.style.display=c.classList.contains(j.minimized)?"none":"block")},p=function(){null===i&&(i=setTimeout(function(){i=null;var a,b=document.getElementsByClassName(j.content);for(a=0;b.length>a;a+=1){var c=b[a],d=c.parentElement;c.style.height=d.offsetHeight-32+"px",n(d)}},125))},q=function(a){a.preventDefault(),a.stopPropagation();var b=a.target,c=null;b.classList.contains(j.btn_close)?(c=b.parentElement.parentElement,l(c,!0)):(b.classList.contains(j.maximize)||b.classList.contains(j.minimize))&&(c=b.parentElement.parentElement,o(b,c))},r=function(a){a.preventDefault();var c,g,h,i=a.clientX,j=a.clientY,k=a.changedTouches,l=null;if(k)for(c=0;k.length>c;c+=1)if(l=k[c],l.identifier===d){i=k[c].clientX,j=k[c].clientY;break}g=i-e,h=j-f,b.style.left=g+"px",b.style.top=h+"px"},s=function(a){var c,e=a.changedTouches,f=null;if(e){for(c=0;e.length>c;c+=1)if(f=e[c],f.identifier===d){b=null,document.body.style.cursor="default",window.removeEventListener("touchmove",r,!1),window.removeEventListener("touchmove",s,!1);break}}else b=null,document.body.style.cursor="default",window.removeEventListener("mousemove",r,!1),window.removeEventListener("mousemove",s,!1)},t=function(a){var c=a.clientX,g=a.clientY,h=0,i=0,k=a.changedTouches;if(a.preventDefault(),null===b)if(k)d=k[0].identifier,c=k[0].clientX,g=k[0].clientY;else if(0!==a.button)return;b=a.target.parentElement,!b.classList.contains(j.maximize)&&b.classList.contains(j.draggable)&&(m(b),document.body.style.cursor="move",h=parseInt(b.style.left,10),i=parseInt(b.style.top,10),e=c-h,f=g-i,window.addEventListener("mousemove",r,!1),window.addEventListener("touchmove",r,!1),window.addEventListener("mouseup",s,!1),window.addEventListener("touchend",s,!1))},u=function(a){a.preventDefault(),a.stopPropagation();var b=a.target.parentElement,e=b.offsetLeft,f=b.offsetTop,i=a.changedTouches;i&&(d=i[0].identifier),g=e,h=f,b.classList.remove(j.dim_transition),window.addEventListener("mousemove",v,!1),window.addEventListener("touchmove",v,!1),window.addEventListener("mouseup",w,!1),window.addEventListener("touchend",w,!1),c=b},v=function(b){b.preventDefault();var e,f,i=b.clientX,k=b.clientY,l=b.changedTouches,m=null,o=a[c.id],p=null,q=null,r=0,s=0;if(l)for(s=0;l.length>s;s+=1)if(m=l[s],m.identifier===d){i=l[s].clientX,k=l[s].clientY;break}for(e=i-g,f=k-h,q=c.firstElementChild.firstElementChild.firstElementChild,r=q.offsetWidth+108,"title"===o.opts.min_width&&r>e?e=r:o.opts.min_width>e&&(e=o.opts.min_width),o.opts.min_height>f&&(f=o.opts.min_height),c.style.width=e+"px",c.classList.contains(j.minimized)||(c.style.height=f+"px"),p=c.getElementsByClassName(j.content),s=0;p.length>s;s+=1){var t=p[s];t.style.height=c.offsetHeight-32+"px",o.opts.keep_align_when_resized&&n(c)}},w=function(a){a.preventDefault(),c.classList.add(j.dim_transition),window.removeEventListener("mousemove",v,!1),window.removeEventListener("touchmove",v,!1),window.removeEventListener("mouseup",w,!1),window.removeEventListener("touchend",w,!1),c=null};this.create=function(b,c){var d,e={};if(void 0!==a[b])return void console.log("WUI_Dialog id '"+b+"' already created, aborting.");for(d in k)k.hasOwnProperty(d)&&(e[d]=k[d]);if(void 0!==c)for(d in c)c.hasOwnProperty(d)&&void 0!==k[d]&&(e[d]=c[d]);var f=document.getElementById(b),g=document.createElement("div"),h=null,i=null,l=null,m=null,r=null;if(null===f)return void("undefined"!=typeof console&&console.log('WUI dialog create, unknow element with id "'+b+'".'));var s=f.firstElementChild;return null===s&&(s=document.createElement("div"),f.appendChild(s)),f.style.width=e.width,f.style.height=e.height,f.classList.add(j.dialog),s.classList.add(j.content),g.className=j.header,s.style.height=f.offsetHeight-32+"px",r=document.createElement("div"),m=document.createElement("div"),r.style.display="inline-block",m.className="wui-dialog-title",r.innerHTML=e.title,m.appendChild(r),g.appendChild(m),f.classList.add(e.open?j.open:j.closed),e.draggable&&(f.classList.toggle(j.draggable),g.addEventListener("mousedown",t,!1),g.addEventListener("touchstart",t,!1)),e.closable&&(i=document.createElement("div"),i.className=j.btn+" "+j.btn_close,g.appendChild(i)),e.minimizable&&(l=document.createElement("div"),l.className=j.btn+" "+j.minimize,e.minimized&&o(l,f),g.appendChild(l)),f.addEventListener("click",q,!1),f.addEventListener("touchstart",q,!1),window.addEventListener("resize",p,!1),f.classList.add("wui-dialog-transition"),f.classList.add(j.dim_transition),f.insertBefore(g,s),e.resizable&&(h=document.createElement("div"),h.addEventListener("mousedown",u,!1),h.addEventListener("touchstart",u,!1),h.classList.add("wui-dialog-resize"),f.appendChild(h)),a[b]={dialog:f,minimized_id:-1,resize_handler:h,opts:e,modal_element:null},n(f),b},this.open=function(b){var c,d=a[b];return void 0===d?void("undefined"!=typeof console&&console.log('Cannot open WUI dialog "'+b+'".')):(d.opts.modal&&(c=document.createElement("div"),c.className="wui-dialog-modal",c.addEventListener("click",function(a){a.preventDefault(),l(d.dialog,!0)}),c.style.zIndex=999999,d.dialog.style.zIndex=1e6,d.modal_element=c,document.body.appendChild(c)),d.dialog.classList.remove(j.closed),d.dialog.classList.add(j.open),void m(d.dialog))},this.close=function(b,c){var d=a[b];return void 0===d?void("undefined"!=typeof console&&console.log('Cannot close WUI dialog "'+b+'".')):void l(d.dialog,c)},this.destroy=function(b){var c,d=a[b];return void 0===d?void console.log("Element id '"+b+"' is not a WUI_Dialog, destroying aborted."):(d.modal_element&&document.body.removeChild(d.modal_element),c=d.dialog,c.parentElement.removeChild(c),void delete a[b])}};
