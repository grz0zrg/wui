var WUI_Dialog=new function(){var a={},b=null,c=null,d=null,e=0,f=0,g=0,h=0,i=null,j={dialog:"wui-dialog",content:"wui-dialog-content",btn:"wui-dialog-btn",btn_close:"wui-dialog-close",minimize:"wui-dialog-minimize",maximize:"wui-dialog-maximize",header:"wui-dialog-header",open:"wui-dialog-open",closed:"wui-dialog-closed",draggable:"wui-dialog-draggable",dim_transition:"wui-dialog-dim-transition"},k={title:"",width:"80%",height:"40%",open:!0,closable:!0,minimizable:!1,draggable:!1,resizable:!1,keep_align_when_resized:!1,halign:"left",valign:"top",top:0,left:0,modal:!1,minimized:!1,on_close:null},l=function(b,c){var d=a[b.id];d.dialog.classList.contains(j.open)&&(d.modal_element&&document.body.removeChild(d.modal_element),b.classList.add(j.closed),b.classList.remove(j.open),c&&null!==d.opts.on_close&&d.opts.on_close())},m=function(b){var c=0,d=null,e=a[b.id];if(!e.opts.modal){for(var f in a)a.hasOwnProperty(f)&&(d=a[f].dialog,isNaN(d.style.zIndex)||(c=parseInt(d.style.zIndex,10),c>100&&(d.style.zIndex=100)));b.style.zIndex=101}},n=function(b){var c=a[b.id],d=c.opts,e=b.parentElement.offsetWidth,f=b.parentElement.offsetHeight,g=b.offsetWidth,h=b.offsetHeight;b.style.left="center"===d.halign?(e-g)/2+d.left+"px":"right"===d.halign?e-g+d.left+"px":d.left+"px",b.style.top="center"===d.valign?(f-h)/2+d.top+"px":"bottom"===d.valign?f-h+d.top+"px":d.top+"px"},o=function(a,b){a.classList.toggle(j.minimize),a.classList.toggle(j.maximize),b.classList.toggle("wui-dialog-minimized")},p=function(){null===i&&(i=setTimeout(function(){i=null;var a,b=document.getElementsByClassName(j.content);for(a=0;b.length>a;a+=1){var c=b[a],d=c.parentElement;c.style.height=d.offsetHeight-32+"px",n(d)}},125))},q=function(a){a.preventDefault(),a.stopPropagation();var b=a.target,c=null;b.classList.contains(j.btn_close)?(c=b.parentElement.parentElement,l(c,!0)):(b.classList.contains(j.maximize)||b.classList.contains(j.minimize))&&(c=b.parentElement.parentElement,o(b,c))},r=function(a){a.preventDefault();var c,g,h,i=a.clientX,j=a.clientY,k=a.changedTouches,l=null;if(k)for(c=0;k.length>c;c+=1)if(l=k[c],l.identifier===d){i=k[c].clientX,j=k[c].clientY;break}g=i-e,h=j-f,b.style.left=g+"px",b.style.top=h+"px"},s=function(a){var c,e=a.changedTouches,f=null;if(e){for(c=0;e.length>c;c+=1)if(f=e[c],f.identifier===d){b=null,document.body.style.cursor="default",window.removeEventListener("touchmove",r,!1),window.removeEventListener("touchmove",s,!1);break}}else b=null,document.body.style.cursor="default",window.removeEventListener("mousemove",r,!1),window.removeEventListener("mousemove",s,!1)},t=function(a){var c=a.clientX,g=a.clientY,h=0,i=0,k=a.changedTouches;if(a.preventDefault&&a.preventDefault(),null===b)if(k)d=k[0].identifier,c=k[0].clientX,g=k[0].clientY;else if(0!==a.button)return;b=a.target.parentElement,!b.classList.contains(j.maximize)&&b.classList.contains(j.draggable)&&(m(b),document.body.style.cursor="move",h=parseInt(b.style.left,10),i=parseInt(b.style.top,10),e=c-h,f=g-i,window.addEventListener("mousemove",r,!1),window.addEventListener("touchmove",r,!1),window.addEventListener("mouseup",s,!1),window.addEventListener("touchend",s,!1))},u=function(a){a.preventDefault(),a.stopPropagation();var b=a.target.parentElement,e=b.offsetLeft,f=b.offsetTop,i=a.changedTouches;i&&(d=i[0].identifier),g=e,h=f,b.classList.remove(j.dim_transition),window.addEventListener("mousemove",v,!1),window.addEventListener("touchmove",v,!1),window.addEventListener("mouseup",w,!1),window.addEventListener("touchend",w,!1),c=b},v=function(b){b.preventDefault();var e=b.clientX,f=b.clientY,i=b.changedTouches,k=null,l=a[c.id],m=0;if(i)for(m=0;i.length>m;m+=1)if(k=i[m],k.identifier===d){e=i[m].clientX,f=i[m].clientY;break}c.style.width=e-g+"px",c.style.height=f-h+"px";var o=c.getElementsByClassName(j.content);for(m=0;o.length>m;m+=1){var p=o[m];p.style.height=c.offsetHeight-32+"px",l.opts.keep_align_when_resized&&n(c)}},w=function(a){a.preventDefault(),c.classList.add(j.dim_transition),window.removeEventListener("mousemove",v,!1),window.removeEventListener("touchmove",v,!1),window.removeEventListener("mouseup",w,!1),window.removeEventListener("touchend",w,!1),c=null};this.create=function(b,c){var d,e={};if(void 0!==a[b])return void console.log("WUI_Dialog id '"+b+"' already created, aborting.");for(d in k)k.hasOwnProperty(d)&&(e[d]=k[d]);if(void 0!==c)for(d in c)c.hasOwnProperty(d)&&void 0!==k[d]&&(e[d]=c[d]);var f,g=document.getElementById(b),h=document.createElement("div"),i=null,l=null,m=null;if(null===g)return void("undefined"!=typeof console&&console.log('WUI dialog create, unknow element with id "'+b+'".'));var r=g.firstElementChild;return null===r&&(r=document.createElement("div"),g.appendChild(r)),g.style.width=e.width,g.style.height=e.height,g.classList.add(j.dialog),r.classList.add(j.content),h.className=j.header,r.style.height=g.offsetHeight-32+"px",""!==e.title&&(m=document.createElement("div"),m.className="wui-dialog-title",m.innerHTML=e.title,h.appendChild(m)),g.classList.add(e.open?j.open:j.closed),e.draggable&&(g.classList.toggle(j.draggable),h.addEventListener("mousedown",t,!1),h.addEventListener("touchstart",t,!1)),e.closable&&(i=document.createElement("div"),i.className=j.btn+" "+j.btn_close,h.appendChild(i)),e.minimizable&&(l=document.createElement("div"),l.className=j.btn+" "+j.minimize,e.minimized&&o(l,g),h.appendChild(l)),g.addEventListener("click",q,!1),g.addEventListener("touchstart",q,!1),window.addEventListener("resize",p,!1),g.classList.add("wui-dialog-transition"),g.classList.add(j.dim_transition),g.insertBefore(h,r),e.resizable&&(f=document.createElement("div"),f.addEventListener("mousedown",u,!1),f.addEventListener("touchstart",u,!1),f.classList.add("wui-dialog-resize"),g.appendChild(f)),a[b]={dialog:g,minimized_id:-1,opts:e,modal_element:null},n(g),b},this.open=function(b){var c,d=a[b];return void 0===d?void("undefined"!=typeof console&&console.log('Cannot open WUI dialog "'+b+'".')):(d.opts.modal&&(c=document.createElement("div"),c.className="wui-dialog-modal",c.addEventListener("click",function(a){a.preventDefault(),l(d.dialog,!0)}),c.style.zIndex=999999,d.dialog.style.zIndex=1e6,d.modal_element=c,document.body.appendChild(c)),d.dialog.classList.remove(j.closed),d.dialog.classList.add(j.open),void m(d.dialog))},this.close=function(b,c){var d=a[b];return void 0===d?void("undefined"!=typeof console&&console.log('Cannot close WUI dialog "'+b+'".')):void l(d.dialog,c)},this.destroy=function(b){var c,d=a[b];return void 0===d?void console.log("Element id '"+b+"' is not a WUI_Dialog, destroying aborted."):(d.modal_element&&document.body.removeChild(d.modal_element),c=d.dialog,c.parentElement.removeChild(c),void delete a[b])}};
