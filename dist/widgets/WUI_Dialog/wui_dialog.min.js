var WUI_Dialog=new function(){"use strict";var a={},b=null,c=null,d=null,e=0,f=0,g=0,h=0,i=null,j=[],k={dialog:"wui-dialog",content:"wui-dialog-content",btn:"wui-dialog-btn",btn_close:"wui-dialog-close",detach:"wui-dialog-detach",minimized:"wui-dialog-minimized",minimize:"wui-dialog-minimize",maximize:"wui-dialog-maximize",header:"wui-dialog-header",open:"wui-dialog-open",closed:"wui-dialog-closed",draggable:"wui-dialog-draggable",dim_transition:"wui-dialog-dim-transition",modal:"wui-dialog-modal"},l={title:"",width:"80%",height:"40%",open:!0,closable:!0,minimizable:!1,draggable:!1,resizable:!1,detachable:!1,min_width:"title",min_height:32,keep_align_when_resized:!1,halign:"left",valign:"top",top:0,left:0,modal:!1,minimized:!1,on_close:null,on_detach:null};Element.prototype._addEventListener||(Element.prototype._addEventListener=Element.prototype.addEventListener,Element.prototype.addEventListener=function(a,b,c){this._addEventListener(a,b,c),this.eventListenerList||(this.eventListenerList={}),this.eventListenerList[a]||(this.eventListenerList[a]=[]),this.eventListenerList[a].push(b)},Element.prototype._removeEventListener=Element.prototype.removeEventListener,Element.prototype.removeEventListener=function(a,b,c){if(this.eventListenerList){var d,e=this.eventListenerList[a];if(e)for(d=0;e.length>d;d+=1)if(e[d]===b){e.splice(d,1);break}}this._removeEventListener(a,b,c)});var m=function(a){for(var b=0;j.length>b;b+=1)if(j[b]===a.detachable_ref){j.splice(b,1);break}},n=function(b,c,d,e){var f,g,h,i,l=a[b.id];if(l){if(c&&l.detachable_ref&&(l.detachable_ref.closed||l.detachable_ref.close(),m(l)),e&&l.modal_element)for(document.body.removeChild(l.modal_element),g=0;j.length>g;g+=1)for(i=j[g],f=i.document.body.getElementsByClassName(k.modal),h=0;f.length>h;h+=1)i.document.body.removeChild(f[h]);l.dialog.classList.contains(k.open)&&(b.classList.add(k.closed),b.classList.remove(k.open),d&&null!==l.opts.on_close&&l.opts.on_close())}},o=function(b){var c=0,d=null,e=a[b.id];if(!e.opts.modal){for(var f in a)a.hasOwnProperty(f)&&(d=a[f].dialog,isNaN(d.style.zIndex)||(c=parseInt(d.style.zIndex,10),c>100&&(d.style.zIndex=100)));b.style.zIndex=101}},p=function(a){var b=document.createElement("div");return b.className="wui-dialog-modal",b.addEventListener("click",function(b){b.preventDefault(),n(a,!0,!0,!0)}),b.style.zIndex=16777270,b},q=function(b){var c=a[b.id],d=c.opts,e=b.parentElement.offsetWidth,f=b.parentElement.offsetHeight,g=b.offsetWidth,h=b.offsetHeight;b.style.left="center"===d.halign?Math.round((e-g)/2+d.left)+"px":"right"===d.halign?e-g+d.left+"px":d.left+"px",b.style.top="center"===d.valign?Math.round((f-h)/2+d.top)+"px":"bottom"===d.valign?f-h+d.top+"px":d.top+"px"},r=function(b,c){var d=a[c.id],e=d.resize_handler;b.classList.toggle(k.minimize),b.classList.toggle(k.maximize),c.classList.toggle(k.minimized),e&&(e.style.display=c.classList.contains(k.minimized)?"none":"block")},s=function(a){null===i&&(i=setTimeout(function(){i=null;var b,c,d,e,f=document;if(a)for(f=a.document,b=f.getElementsByClassName(k.content),e=0;b.length>e;e+=1)c=b[e],d=c.parentElement,c.style.height=a.innerHeight+"px";else for(b=f.getElementsByClassName(k.content),e=0;b.length>e;e+=1)c=b[e],d=c.parentElement,c.style.height=d.offsetHeight-32+"px",q(d)},125))},t=function(a,b){var c,d;do{if(1==a.nodeType&&a.eventListenerList)for(c in a.eventListenerList)if("length"!==c&&a.eventListenerList.hasOwnProperty(c))for(d=0;a.eventListenerList[c].length>d;d+=1)b.addEventListener(c,a.eventListenerList[c][d],!1);a.hasChildNodes()&&t(a.firstChild,b.firstChild),a=a.nextSibling,b=b.nextSibling}while(a&&b)},u=function(b){var c,d,e,f,g,h,i,k=a[b.id],l=b.firstElementChild.firstElementChild.firstElementChild,m=l.textContent||l.innerText||"",o=k.detachable_ref,p=b.getBoundingClientRect();for(c=parseInt(p.width,10),d=parseInt(p.height,10)-32,e=void 0!==window.screenLeft?window.screenLeft:screen.left,f=void 0!==window.screenTop?window.screenTop:screen.top,n(b,!0,!1,!1),o=window.open("",m,["toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes","width="+c,"height="+d,"top="+(p.top+f+32),"left="+(p.left+e)].join(",")),h="",g=document.head.getElementsByTagName("link"),i=0;g.length>i;i+=1)"text/css"===g[i].type&&"stylesheet"===g[i].rel&&(h+=g[i].outerHTML);for(g=document.head.getElementsByTagName("style"),i=0;g.length>i;i+=1)h+=g[i].outerHTML;o.document.open(),o.document.write("<html><head>"+("<title>"+m+"</title>")+h+'</head><body class="wui-dialog-detach-window-body"></body></html>'),o.document.close(),o.document.body.appendChild(b.children[1].cloneNode(!0)),o.addEventListener("resize",function(){s(o)},!1),o.addEventListener("load",function(){t(b.children[1],o.document.body.firstElementChild),k.opts.on_detach&&k.opts.on_detach(o)}),o.addEventListener("beforeunload",function(){n(b,!0,!0,!0)},!1),k.detachable_ref=o,j.push(o)},v=function(a){a.preventDefault();var b=a.target,c=null;b.classList.contains(k.btn_close)?(c=b.parentElement.parentElement,n(c,!1,!0,!0)):b.classList.contains(k.maximize)||b.classList.contains(k.minimize)?(c=b.parentElement.parentElement,r(b,c)):b.classList.contains(k.detach)&&(c=b.parentElement.parentElement,u(c))},w=function(a){a.preventDefault();var c,g,h,i=a.clientX,j=a.clientY,k=a.changedTouches,l=null;if(k)for(c=0;k.length>c;c+=1)if(l=k[c],l.identifier===d){i=k[c].clientX,j=k[c].clientY;break}g=i-e,h=j-f,b.style.left=g+"px",b.style.top=h+"px"},x=function(a){var c,e=a.changedTouches,f=null,g=b.ownerDocument,h=g.defaultView||g.parentWindow;if(e){for(c=0;e.length>c;c+=1)if(f=e[c],f.identifier===d){b=null,g.body.style.cursor="default",h.removeEventListener("touchmove",w,!1),h.removeEventListener("touchmove",x,!1);break}}else b=null,g.body.style.cursor="default",h.removeEventListener("mousemove",w,!1),h.removeEventListener("mousemove",x,!1)},y=function(a){var c,g,h=a.clientX,i=a.clientY,j=0,l=0,m=a.changedTouches;if(a.preventDefault(),null===b)if(m)d=m[0].identifier,h=m[0].clientX,i=m[0].clientY;else if(0!==a.button)return;b=a.target.parentElement,c=b.ownerDocument,g=c.defaultView||c.parentWindow,!b.classList.contains(k.maximize)&&b.classList.contains(k.draggable)&&(o(b),c.body.style.cursor="move",j=parseInt(b.style.left,10),l=parseInt(b.style.top,10),e=h-j,f=i-l,g.addEventListener("mousemove",w,!1),g.addEventListener("touchmove",w,!1),g.addEventListener("mouseup",x,!1),g.addEventListener("touchend",x,!1))},z=function(a){a.preventDefault(),a.stopPropagation();var b=a.target.parentElement,e=b.offsetLeft,f=b.offsetTop,i=a.changedTouches,j=b.ownerDocument,l=j.defaultView||j.parentWindow;i&&(d=i[0].identifier),g=e,h=f,b.classList.remove(k.dim_transition),l.addEventListener("mousemove",A,!1),l.addEventListener("touchmove",A,!1),l.addEventListener("mouseup",B,!1),l.addEventListener("touchend",B,!1),c=b},A=function(b){b.preventDefault();var e,f,i=b.clientX,j=b.clientY,l=b.changedTouches,m=null,n=a[c.id],o=null,p=null,r=0,s=0;if(l)for(s=0;l.length>s;s+=1)if(m=l[s],m.identifier===d){i=l[s].clientX,j=l[s].clientY;break}for(e=i-g,f=j-h,"center"===n.opts.halign&&(e+=2),"center"===n.opts.valign&&(f+=2),p=c.firstElementChild.firstElementChild.firstElementChild,r=p.offsetWidth+148,"title"===n.opts.min_width&&r>e?e=r:n.opts.min_width>e&&(e=n.opts.min_width),n.opts.min_height>f&&(f=n.opts.min_height),c.style.width=e+"px",c.classList.contains(k.minimized)||(c.style.height=f+"px"),o=c.getElementsByClassName(k.content),s=0;o.length>s;s+=1){var t=o[s];t.style.height=c.offsetHeight-32+"px",n.opts.keep_align_when_resized&&q(c)}},B=function(a){var b=c.ownerDocument,d=b.defaultView||b.parentWindow;a.preventDefault(),c.classList.add(k.dim_transition),d.removeEventListener("mousemove",A,!1),d.removeEventListener("touchmove",A,!1),d.removeEventListener("mouseup",B,!1),d.removeEventListener("touchend",B,!1),c=null},C=function(){for(var b in a)a.hasOwnProperty(b)&&n(a[b].dialog,!0,!1,!0)};this.create=function(b,c){var d,e={};if(void 0!==a[b])return void console.log("WUI_Dialog id '"+b+"' already created, aborting.");for(d in l)l.hasOwnProperty(d)&&(e[d]=l[d]);if(void 0!==c)for(d in c)c.hasOwnProperty(d)&&void 0!==l[d]&&(e[d]=c[d]);var f=document.getElementById(b),g=document.createElement("div"),h=null,i=null,j=null,m=null,n=null,o=null;if(null===f)return void("undefined"!=typeof console&&console.log('WUI dialog create, unknow element with id "'+b+'".'));var p=f.firstElementChild;return null===p&&(p=document.createElement("div"),f.appendChild(p)),f.style.width=e.width,f.style.height=e.height,f.classList.add(k.dialog),p.classList.add(k.content),g.className=k.header,p.style.height=f.offsetHeight-32+"px",o=document.createElement("div"),n=document.createElement("div"),o.style.display="inline-block",n.className="wui-dialog-title",o.innerHTML=e.title,n.appendChild(o),g.appendChild(n),f.classList.add(e.open?k.open:k.closed),e.draggable&&(f.classList.toggle(k.draggable),g.addEventListener("mousedown",y,!1),g.addEventListener("touchstart",y,!1)),e.closable&&(j=document.createElement("div"),j.className=k.btn+" "+k.btn_close,j.title="Close",g.appendChild(j)),e.minimizable&&(m=document.createElement("div"),m.className=k.btn+" "+k.minimize,e.minimized&&r(m,f),g.appendChild(m)),e.detachable&&(i=document.createElement("div"),i.className=k.btn+" "+k.detach,i.title="Detach",g.appendChild(i)),f.addEventListener("click",v,!1),f.addEventListener("touchstart",v,!1),window.addEventListener("resize",function(){s(!1)},!1),window.addEventListener("beforeunload",C,!1),f.classList.add("wui-dialog-transition"),f.classList.add(k.dim_transition),f.insertBefore(g,p),e.resizable&&(h=document.createElement("div"),h.addEventListener("mousedown",z,!1),h.addEventListener("touchstart",z,!1),h.classList.add("wui-dialog-resize"),f.appendChild(h)),a[b]={dialog:f,minimized_id:-1,resize_handler:h,opts:e,detachable_ref:null,modal_element:null},q(f),b},this.open=function(b,c){var d,e,f,g=a[b];if(void 0===g)return void("undefined"!=typeof console&&console.log('Cannot open WUI dialog "'+b+'".'));if(g.detachable_ref&&!g.detachable_ref.closed)return void g.detachable_ref.focus();if(f=g.dialog,g.opts.modal)for(d=p(f),g.dialog.style.zIndex=16777271,g.modal_element=d,document.body.appendChild(d),e=0;j.length>e;e+=1)d=p(f),j[e].document.body.appendChild(d);return c?void u(f):(f.classList.remove(k.closed),f.classList.add(k.open),void o(f))},this.close=function(b,c){var d=a[b];return void 0===d?void("undefined"!=typeof console&&console.log('Cannot close WUI dialog "'+b+'".')):void n(d.dialog,!0,c)},this.destroy=function(b){var c,d=a[b];return void 0===d?void console.log("Element id '"+b+"' is not a WUI_Dialog, destroying aborted."):(n(d.dialog,!0,!1,!0),c=d.dialog,c.parentElement.removeChild(c),void delete a[b])}};
