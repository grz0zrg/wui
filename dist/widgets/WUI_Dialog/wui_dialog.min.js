var WUI_Dialog=new function(){var a={},b=null,c=null,d=0,e=0,f=null,g={dialog:"wui-dialog",content:"wui-dialog-content",btn:"wui-dialog-btn",btn_close:"wui-dialog-close",minimize:"wui-dialog-minimize",maximize:"wui-dialog-maximize",header:"wui-dialog-header",open:"wui-dialog-open",closed:"wui-dialog-closed",draggable:"wui-dialog-draggable"},h={title:"",width:"80%",height:"40%",open:!0,closable:!0,minimizable:!1,draggable:!1,resizable:!1,halign:"none",valign:"none",top:"0px",bottom:"0px",left:"0px",right:"0px",minimized:!1,on_close:null},i=function(b,c){var d=a[b.id];d.dialog.classList.contains(g.open)&&(b.classList.add(g.closed),b.classList.remove(g.open),c&&null!==d.opts.on_close&&d.opts.on_close())},j=function(b){var c=0,d=null;for(var e in a)a.hasOwnProperty(e)&&(d=a[e].dialog,isNaN(d.style.zIndex)||(c=parseInt(d.style.zIndex,10),c>100&&(d.style.zIndex=100)));b.style.zIndex=101},k=function(a,b){a.classList.toggle(g.minimize),a.classList.toggle(g.maximize),b.classList.toggle("wui-dialog-minimized")},l=function(){null===f&&(f=setTimeout(function(){f=null;var a,b=document.getElementsByClassName(g.content);for(a=0;b.length>a;a+=1){var c=b[a],d=c.parentElement;c.style.height=d.offsetHeight-32+"px"}},125))},m=function(a){a.preventDefault(),a.stopPropagation();var b=a.target,c=null;b.classList.contains(g.btn_close)?(c=b.parentElement.parentElement,i(c,!0)):(b.classList.contains(g.maximize)||b.classList.contains(g.minimize))&&(c=b.parentElement.parentElement,k(b,c))},n=function(f){f.preventDefault();var g,h,i,j=f.clientX,k=f.clientY,l=f.changedTouches,m=null,n=a[b.id];if(l)for(g=0;l.length>g;g+=1)if(m=l[g],m.identifier===c){j=l[g].clientX,k=l[g].clientY;break}h=j-d,i=k-e,b.style.left=h+"px",b.style.top=i+"px","right"===n.opts.halign?b.style.right=h+"px":"center"===n.opts.halign&&(b.style.right=-h+"px"),"bottom"===n.opts.valign?b.style.bottom=i+"px":"center"===n.opts.valign&&(b.style.bottom=-i+"px")},o=function(a){var d,e=a.changedTouches,f=null;if(e){for(d=0;e.length>d;d+=1)if(f=e[d],f.identifier===c){b=null,document.body.style.cursor="default",window.removeEventListener("touchmove",n,!1),window.removeEventListener("touchmove",o,!1);break}}else b=null,document.body.style.cursor="default",window.removeEventListener("mousemove",n,!1),window.removeEventListener("mousemove",o,!1)},p=function(a){var f=a.clientX,h=a.clientY,i=a.changedTouches;if(a.preventDefault&&a.preventDefault(),null===b)if(i)c=i[0].identifier,f=i[0].clientX,h=i[0].clientY;else if(0!==a.button)return;b=a.target.parentElement,!b.classList.contains(g.maximize)&&b.classList.contains(g.draggable)&&(j(b),document.body.style.cursor="move",d=f-parseInt(b.style.left,10),e=h-parseInt(b.style.top,10),window.addEventListener("mousemove",n,!1),window.addEventListener("touchmove",n,!1),window.addEventListener("mouseup",o,!1),window.addEventListener("touchend",o,!1))};this.create=function(b,c){var d,e={};if(void 0!==a[b])return void console.log("WUI_Dialog id '"+b+"' already created, aborting.");for(d in h)h.hasOwnProperty(d)&&(e[d]=h[d]);if(void 0!==c)for(d in c)c.hasOwnProperty(d)&&void 0!==h[d]&&(e[d]=c[d]);var f=document.getElementById(b),i=document.createElement("div"),j=null,n=null,o=null;if(null===f)return void("undefined"!=typeof console&&console.log('WUI dialog create, unknow element with id "'+b+'".'));var q=f.firstElementChild;return null===q&&(q=document.createElement("div"),f.appendChild(q)),f.style.width=e.width,f.style.height=e.height,e.resizable&&(f.style.resize="both"),"center"===e.halign?(f.style.left="0",f.style.right="0"):"right"===e.halign?(f.style.right="0",f.style.left="auto"):"left"===e.halign?f.style.left="0":(f.style.left=e.left,f.style.right=e.right),"center"===e.valign?(f.style.top="0",f.style.bottom="0"):"bottom"===e.valign?(f.style.top="auto",f.style.bottom="0"):"top"===e.valign?f.style.top="0":(f.style.top=e.top,f.style.bottom=e.bottom),f.classList.add(g.dialog),q.classList.add(g.content),i.className=g.header,q.style.height=f.offsetHeight-32+"px",""!==e.title&&(o=document.createElement("div"),o.className="wui-dialog-title",o.innerHTML=e.title,i.appendChild(o)),f.classList.add(e.open?g.open:g.closed),e.draggable&&(f.classList.toggle(g.draggable),i.addEventListener("mousedown",p,!1),i.addEventListener("touchstart",p,!1)),e.closable&&(j=document.createElement("div"),j.className=g.btn+" "+g.btn_close,i.appendChild(j)),e.minimizable&&(n=document.createElement("div"),n.className=g.btn+" "+g.minimize,e.minimized&&k(n,f),i.appendChild(n)),f.addEventListener("click",m,!1),f.addEventListener("touchstart",m,!1),window.addEventListener("resize",l,!1),f.classList.add("wui-dialog-transition"),f.insertBefore(i,q),a[b]={dialog:f,minimized_id:-1,bottom_pos:f.style.bottom,opts:e},b},this.open=function(b){var c=a[b];return void 0===c?void("undefined"!=typeof console&&console.log('Cannot open WUI dialog "'+b+'".')):(c.dialog.classList.remove(g.closed),c.dialog.classList.add(g.open),void j(c.dialog))},this.close=function(b,c){var d=a[b];return void 0===d?void("undefined"!=typeof console&&console.log('Cannot close WUI dialog "'+b+'".')):void i(d.dialog,c)}};
