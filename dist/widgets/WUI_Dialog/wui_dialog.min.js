var WUI_Dialog=new function(){var a={},b=null,c=null,d=0,e=0,f={dialog:"wui-dialog",content:"wui-dialog-content",btn:"wui-dialog-btn",btn_close:"wui-dialog-close",minimize:"wui-dialog-minimize",maximize:"wui-dialog-maximize",header:"wui-dialog-header",open:"wui-dialog-open",closed:"wui-dialog-closed",draggable:"wui-dialog-draggable"},g={title:"",width:"80%",height:"40%",open:!0,closable:!0,minimizable:!1,draggable:!1,resizable:!1,halign:"none",valign:"none",top:"0px",bottom:"0px",left:"0px",right:"0px",minimized:!1,on_close:null,use_event_listener:!0},h=function(b,c){var d=a[b.id];d.dialog.classList.contains(f.open)&&(b.classList.add(f.closed),b.classList.remove(f.open),c&&null!==d.opts.on_close&&d.opts.on_close())},i=function(b){var c=100,d=0,e=null;for(var f in a)a.hasOwnProperty(f)&&(e=a[f].dialog,isNaN(e.style.zIndex)||(d=parseInt(e.style.zIndex,10),d>c&&(c=d),d>1e5&&(d-=1e5)));b.style.zIndex=c+1},j=function(a,b){a.classList.toggle(f.minimize),a.classList.toggle(f.maximize),b.classList.toggle("wui-dialog-minimized")},k=function(){var a,b=document.getElementsByClassName(f.content);for(a=0;b.length>a;a+=1){var c=b[a],d=c.parentElement;c.style.height=d.offsetHeight-32+"px"}},l=function(a){a.preventDefault&&a.preventDefault();var b=a.target.parentElement.parentElement;h(b,!0)},m=function(a){a.preventDefault&&a.preventDefault();var b=a.target,c=a.target.parentElement.parentElement;j(b,c)},n=function(f){f.preventDefault&&f.preventDefault();var g,h,i,j=f.clientX,k=f.clientY,l=f.changedTouches,m=null,n=a[b.id];if(l)for(g=0;l.length>g;g+=1)if(m=l[g],m.identifier===c){j=l[g].clientX,k=l[g].clientY;break}h=j-d,i=k-e,b.style.left=h+"px",b.style.top=i+"px","right"===n.opts.halign?b.style.right=h+"px":"center"===n.opts.halign&&(b.style.right=-h+"px"),"bottom"===n.opts.valign?b.style.bottom=i+"px":"center"===n.opts.valign&&(b.style.bottom=-i+"px")},o=function(a){var d,e=a.changedTouches,f=null;if(e){for(d=0;e.length>d;d+=1)if(f=e[d],f.identifier===c){b=null,document.body.style.cursor="default",window.removeEventListener("touchmove",n,!1);break}}else b=null,document.body.style.cursor="default",window.removeEventListener("mousemove",n,!1)},p=function(a){var g=a.clientX,h=a.clientY,j=a.changedTouches;if(a.preventDefault&&a.preventDefault(),null===b)if(j)c=j[0].identifier,g=j[0].clientX,h=j[0].clientY;else if(0!==a.button)return;b=a.target.parentElement,!b.classList.contains(f.maximize)&&b.classList.contains(f.draggable)&&(i(b),document.body.style.cursor="move",d=g-parseInt(b.style.left,10),e=h-parseInt(b.style.top,10),window.addEventListener("mousemove",n,!1),window.addEventListener("touchmove",n,!1))};this.triggerEvent=function(a,b){var c=a.target,d=a.type;if(void 0!==b&&(d=b),"click"===d){if(c.classList.contains(f.btn_close))return l(a),!0;if(c.classList.contains(f.minimize)||c.classList.contains(f.maximize))return m(a),!0}else if("mousedown"===d&&c.classList.contains(f.header))return p(a),!0;return!1},this.create=function(b,c){var d,e={};if(void 0!==a[b])return void console.log("WUI_Dialog id '"+b+"' already created, aborting.");for(d in g)g.hasOwnProperty(d)&&(e[d]=g[d]);if(void 0!==c)for(d in c)c.hasOwnProperty(d)&&void 0!==g[d]&&(e[d]=c[d]);var h=document.getElementById(b),i=document.createElement("div"),n=null,q=null,r=null;if(null===h)return void("undefined"!=typeof console&&console.log('WUI dialog create, unknow element with id "'+b+'".'));var s=h.firstElementChild;return null===s&&(s=document.createElement("div"),h.appendChild(s)),h.style.width=e.width,h.style.height=e.height,e.resizable&&(h.style.resize="both"),"center"===e.halign?(h.style.left="0",h.style.right="0"):"right"===e.halign?(h.style.right="0",h.style.left="auto"):"left"===e.halign?h.style.left="0":(h.style.left=e.left,h.style.right=e.right),"center"===e.valign?(h.style.top="0",h.style.bottom="0"):"bottom"===e.valign?(h.style.top="auto",h.style.bottom="0"):"top"===e.valign?h.style.top="0":(h.style.top=e.top,h.style.bottom=e.bottom),h.classList.add(f.dialog),s.classList.add(f.content),i.className=f.header,s.style.height=h.offsetHeight-32+"px",""!==e.title&&(r=document.createElement("div"),r.className="wui-dialog-title",r.innerHTML=e.title,i.appendChild(r)),h.classList.add(e.open?f.open:f.closed),e.draggable&&(h.classList.toggle(f.draggable),e.use_event_listener&&(i.addEventListener("mousedown",p,!1),i.addEventListener("touchstart",p,!1)),window.addEventListener("mouseup",o,!1),window.addEventListener("touchend",o,!1)),e.closable&&(n=document.createElement("div"),n.className=f.btn+" "+f.btn_close,e.use_event_listener&&(n.addEventListener("click",l,!1),n.addEventListener("touchstart",l,!1)),i.appendChild(n)),e.minimizable&&(q=document.createElement("div"),q.className=f.btn+" "+f.minimize,e.use_event_listener&&(q.addEventListener("click",m,!1),q.addEventListener("touchstart",m,!1)),e.minimized&&j(q,h),i.appendChild(q)),window.addEventListener("resize",k,!1),h.classList.add("wui-dialog-transition"),h.insertBefore(i,s),a[b]={dialog:h,minimized_id:-1,bottom_pos:h.style.bottom,opts:e},b},this.open=function(b){var c=a[b];return void 0===c?void("undefined"!=typeof console&&console.log('Cannot open WUI dialog "'+b+'".')):(c.dialog.classList.remove(f.closed),c.dialog.classList.add(f.open),void i(c.dialog))},this.close=function(b,c){var d=a[b];return void 0===d?void("undefined"!=typeof console&&console.log('Cannot close WUI dialog "'+b+'".')):void h(d.dialog,c)}};
