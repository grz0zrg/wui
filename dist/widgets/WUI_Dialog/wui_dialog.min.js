var WUI_Dialog=new function(){"use strict";var a=this,b={},c=null,d=null,e=null,f=0,g=0,h=0,i=0,j=null,k=[],l={dialog:"wui-dialog",content:"wui-dialog-content",btn:"wui-dialog-btn",btn_close:"wui-dialog-close",detach:"wui-dialog-detach",minimized:"wui-dialog-minimized",minimize:"wui-dialog-minimize",maximize:"wui-dialog-maximize",header:"wui-dialog-header",open:"wui-dialog-open",closed:"wui-dialog-closed",draggable:"wui-dialog-draggable",transition:"wui-dialog-transition",dim_transition:"wui-dialog-dim-transition",modal:"wui-dialog-modal",status_bar:"wui-dialog-status-bar"},m={title:"",width:"80%",height:"40%",open:!0,closable:!0,minimizable:!1,draggable:!1,resizable:!1,detachable:!1,min_width:"title",min_height:32,header_btn:null,status_bar:!1,status_bar_content:"",keep_align_when_resized:!1,halign:"left",valign:"top",top:0,left:0,modal:!1,minimized:!1,on_close:null,on_detach:null,on_pre_detach:null,on_resize:null},n=function(a){for(var b=a.parentElement;null!=b;){if(b.classList.contains(l.dialog))return!0;b=b.parentElement}return!1};Element.prototype._addEventListener||(Element.prototype._addEventListener=Element.prototype.addEventListener,Element.prototype.addEventListener=function(a,b,c){this._addEventListener(a,b,c),n(this)&&(this.eventListenerList||(this.eventListenerList={}),this.eventListenerList[a]||(this.eventListenerList[a]=[]),this.eventListenerList[a].push(b))},Element.prototype._removeEventListener=Element.prototype.removeEventListener,Element.prototype.removeEventListener=function(a,b,c){if(this.eventListenerList){var d,e=this.eventListenerList[a];if(e)for(d=0;d<e.length;d+=1)if(e[d]===b){e.splice(d,1);break}}this._removeEventListener(a,b,c)});var o=function(a){window.WUI_Reporting&&"undefined"!=typeof console&&console.log(a)},p=function(a){var b=0;for(b=0;b<k.length;b+=1)if(k[b]===a.detachable_ref){k.splice(b,1);break}},q=function(a,c,d,e){var f,g,h,i,j=b[a.id];if(j&&(c&&j.detachable_ref&&(j.detachable_ref.closed||j.detachable_ref.close(),p(j)),!j.dialog.classList.contains(l.closed))){if(e&&j.modal_element)for(document.body.removeChild(j.modal_element),g=0;g<k.length;g+=1)for(i=k[g],f=i.document.body.getElementsByClassName(l.modal),h=0;h<f.length;h+=1)i.document.body.removeChild(f[h]);j.dialog.classList.contains(l.open)&&(a.classList.add(l.closed),a.classList.remove(l.open),d&&null!==j.opts.on_close&&j.opts.on_close())}},r=function(a){var c=0,d=null,e=null,f=b[a.id];if(!f.opts.modal){for(var g in b)b.hasOwnProperty(g)&&(d=b[g].dialog,isNaN(d.style.zIndex)||(c=parseInt(d.style.zIndex,10),c>100&&(d.style.zIndex=100)));for(e=f.dialog.parentElement;null!==e;)e.classList.contains(l.dialog)&&(e.style.zIndex=101),e=e.parentElement;a.style.zIndex=101}},s=function(a){var b=document.createElement("div");return b.className="wui-dialog-modal",b.addEventListener("click",function(b){b.preventDefault(),q(a,!0,!0,!0)}),b.style.zIndex=16777270,b},t=function(a){var c=b[a.id],d=c.opts,e=a.parentElement.offsetWidth,f=a.parentElement.offsetHeight,g=a.offsetWidth,h=a.offsetHeight;a.style.left="center"===d.halign?Math.round((e-g)/2+d.left)+"px":"right"===d.halign?e-g+d.left+"px":d.left+"px",a.style.top="center"===d.valign?Math.round((f-h)/2+d.top)+"px":"bottom"===d.valign?f-h+d.top+"px":d.top+"px"},u=function(a,c){var d=b[c.id],e=d.resize_handler;d.dialog!==c&&u(d.header_minimaxi_btn,d.dialog),a.classList.toggle(l.minimize),a.classList.toggle(l.maximize),c.classList.toggle(l.minimized),c.classList.contains(l.minimized)?(c.style.borderStyle="solid",c.style.borderColor="#808080",c.style.borderWidth="1px"):(c.style.borderStyle="",c.style.borderColor="",c.style.borderWidth=""),e&&e.classList.toggle(l.open),d.status_bar&&d.status_bar.classList.toggle(l.open)},v=function(a){null===j&&(j=setTimeout(function(){j=null;var c,d,e,f,g,h,i,k=document;if(a)for(k=a.document,c=k.getElementsByClassName(l.content),i=0;i<c.length;i+=1)e=c[i],f=e.parentElement,d=b[f.id],g=f.getElementsByClassName(l.status_bar),e.style.height=g.length>0?a.innerHeight-32+"px":a.innerHeight+"px",h=e.getBoundingClientRect(),d.opts.on_resize&&d.opts.on_resize(h.width,h.height);else for(c=k.getElementsByClassName(l.content),i=0;i<c.length;i+=1)e=c[i],f=e.parentElement,g=f.getElementsByClassName(l.status_bar),e.style.height=g.length>0?f.offsetHeight-64+"px":f.offsetHeight-32+"px",t(f),h=e.getBoundingClientRect(),d=b[f.id],d.opts.on_resize&&d.opts.on_resize(h.width,h.height)},125))},w=function(a,b){var c,d;do{if(1==a.nodeType&&a.eventListenerList)for(c in a.eventListenerList)if("length"!==c&&a.eventListenerList.hasOwnProperty(c))for(d=0;d<a.eventListenerList[c].length;d+=1)b.addEventListener(c,a.eventListenerList[c][d],!1);a.hasChildNodes()&&w(a.firstChild,b.firstChild),a=a.nextSibling,b=b.nextSibling}while(a&&b)},x=function(a){var c,d,e,f,g,h,i,j=b[a.id],m=a.firstElementChild.firstElementChild.firstElementChild,n=m.textContent||m.innerText||"",o=j.detachable_ref,p=a.getBoundingClientRect();for(j.opts.on_pre_detach&&j.opts.on_pre_detach(),a.classList.contains(l.minimized)?(c=parseInt(a.style.width,10),d=parseInt(a.style.height,10)-32):(c=p.width,d=p.height-32),e=void 0!==window.screenLeft?window.screenLeft:screen.left,f=void 0!==window.screenTop?window.screenTop:screen.top,q(a,!0,!1,!1),o=window.open("",n,["toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes","width="+c,"height="+d,"top="+(p.top+f+32),"left="+(p.left+e)].join(",")),j.detachable_ref=o,h="",g=document.head.getElementsByTagName("link"),i=0;i<g.length;i+=1)"text/css"===g[i].type&&"stylesheet"===g[i].rel&&(h+=g[i].outerHTML);for(g=document.head.getElementsByTagName("style"),i=0;i<g.length;i+=1)h+=g[i].outerHTML;o.document.open(),o.document.write("<html><head>"+("<title>"+n+"</title>")+h+"</head>"+('<body id="'+a.id+'" class="wui-dialog-detach-window-body" onload="parent.opener.WUI_Dialog.childWindowLoaded(document.body.id)">')+"</body></html>"),o.document.close(),o.document.body.appendChild(a.children[1].cloneNode(!0));var r=a.getElementsByClassName(l.status_bar);if(r.length>0){var s=r[0].cloneNode(!0);s.classList.add(l.open),o.document.body.appendChild(s)}o.addEventListener("keyup",function(b){27===b.keyCode&&q(a,!0,!0,!0)},!1),o.addEventListener("resize",function(){v(o)},!1),o.addEventListener("beforeunload",function(){q(a,!0,!0,!0),j.modal_element&&document.body.removeChild(j.modal_element)},!1),k.push(o)},y=function(a){a.preventDefault();var b=a.target,c=null;b.classList.contains(l.btn_close)?(c=b.parentElement.parentElement,q(c,!1,!0,!0)):b.classList.contains(l.maximize)||b.classList.contains(l.minimize)?(c=b.parentElement.parentElement,u(b,c)):b.classList.contains(l.detach)&&(c=b.parentElement.parentElement,x(c))},z=function(c){if(27===c.keyCode){var d,e;for(d in b)if(b.hasOwnProperty(d)&&(e=b[d],e.opts.closable&&"101"===e.dialog.style.zIndex&&e.dialog.classList.contains(l.open)))return void a.close(d,!0)}},A=function(a){if(c){a.preventDefault();var d,h,i,j=b[c.id],k=a.clientX,l=a.clientY,m=a.changedTouches,n=null;if(m)for(d=0;d<m.length;d+=1)if(n=m[d],n.identifier===e){k=m[d].clientX,l=m[d].clientY;break}h=k-f,i=l-g,c.style.left=h+"px",c.style.top=i+"px",j.dialog!==c&&(j.dialog.style.left=h+"px",j.dialog.style.top=i+"px")}},B=function(a){if(c){var b,d=a.changedTouches,f=null,g=c.ownerDocument,h=g.defaultView||g.parentWindow;if(d){for(b=0;b<d.length;b+=1)if(f=d[b],f.identifier===e){c=null,g.body.style.cursor="default",h.removeEventListener("touchmove",A,!1),h.removeEventListener("touchend",B,!1);break}}else c=null,g.body.style.cursor="default",h.removeEventListener("mousemove",A,!1),h.removeEventListener("mouseup",B,!1)}},C=function(a){var b,d,h,i=a.clientX,j=a.clientY,k=0,m=0,n=a.changedTouches;if(a.preventDefault(),null===c)if(n)e=n[0].identifier,i=n[0].clientX,j=n[0].clientY;else if(0!==a.button)return;h=a.target.parentElement,!h.classList.contains(l.maximize)&&h.classList.contains(l.draggable)&&(c=h,b=c.ownerDocument,d=b.defaultView||b.parentWindow,r(c),b.body.style.cursor="move",k=parseInt(c.style.left,10),m=parseInt(c.style.top,10),f=i-k,g=j-m,d.addEventListener("mousemove",A,!1),d.addEventListener("touchmove",A,!1),d.addEventListener("mouseup",B,!1),d.addEventListener("touchend",B,!1))},D=function(a){a.preventDefault(),a.stopPropagation();var b=a.target.parentElement,c=b.offsetLeft,f=b.offsetTop,g=a.changedTouches,j=b.ownerDocument,k=j.defaultView||j.parentWindow;g&&(e=g[0].identifier),h=c,i=f,b.classList.remove(l.dim_transition),k.addEventListener("mousemove",E,!1),k.addEventListener("touchmove",E,!1),k.addEventListener("mouseup",F,!1),k.addEventListener("touchend",F,!1),d=b},E=function(a){a.preventDefault();var c,f,g=a.clientX,j=a.clientY,k=a.changedTouches,m=null,n=b[d.id],o=null,p=null,q=0,r=0,s=0;if(k)for(r=0;r<k.length;r+=1)if(m=k[r],m.identifier===e){g=k[r].clientX,j=k[r].clientY;break}for(c=g-h,f=j-i,p=d.firstElementChild.firstElementChild.firstElementChild,q=p.offsetWidth+148,"title"===n.opts.min_width&&c<q?c=q:c<n.opts.min_width&&(c=n.opts.min_width),n.opts.status_bar&&(s=32),f<n.opts.min_height+s&&(f=n.opts.min_height+s),d.style.width=c+"px",d.classList.contains(l.minimized)||(d.style.height=f+"px"),o=d.getElementsByClassName(l.content),r=0;r<o.length;r+=1){var u,v=o[r],w=b[v.parentElement.id];v.style.height=d.offsetHeight-32-s+"px",u=v.getBoundingClientRect(),w.opts.on_resize&&w.opts.on_resize(u.width,u.height),n.opts.keep_align_when_resized&&t(d)}},F=function(a){var b=d.ownerDocument,c=b.defaultView||b.parentWindow;a.preventDefault(),d.classList.add(l.dim_transition),c.removeEventListener("mousemove",E,!1),c.removeEventListener("touchmove",E,!1),c.removeEventListener("mouseup",F,!1),c.removeEventListener("touchend",F,!1),d=null},G=function(){for(var a in b)b.hasOwnProperty(a)&&q(b[a].dialog,!0,!1,!0)},H=function(){o("WUI_RangeSlider 'create' failed, first argument not an id nor a DOM element.")};this.create=function(a,c){var d,e,f=document.createElement("div"),g=null,h=null,i=null,j=null,k=null,n=null,p=null,q=null,s=null,w={},x=0;if("string"==typeof a)d=document.getElementById(a);else{if("object"!=typeof a)return void H();if("string"!=typeof a.innerHTML)return void H();d=a,a=d.id}if(void 0!==b[a])return void o("WUI_Dialog id '"+a+"' already created, aborting.");for(e in m)m.hasOwnProperty(e)&&(w[e]=m[e]);if(void 0!==c)for(e in c)c.hasOwnProperty(e)&&void 0!==m[e]&&(w[e]=c[e]);var z=d.firstElementChild;if(null===z&&(z=document.createElement("div"),d.appendChild(z)),d.style.width=w.width,d.style.height=w.height,d.classList.add(l.dialog),z.classList.add(l.content),f.className=l.header,"auto"!==w.height&&"100%"!==w.height&&(z.style.height=w.status_bar?d.offsetHeight-64+"px":d.offsetHeight-32+"px"),n=document.createElement("div"),k=document.createElement("div"),n.style.display="inline-block",k.className="wui-dialog-title",n.innerHTML=w.title,k.appendChild(n),f.appendChild(k),w.draggable&&(d.classList.toggle(l.draggable),f.addEventListener("mousedown",C,!1),f.addEventListener("touchstart",C,!1)),w.closable&&(i=document.createElement("div"),i.className=l.btn+" "+l.btn_close,i.title="Close",f.appendChild(i)),w.minimizable&&(j=document.createElement("div"),j.className=l.btn+" "+l.minimize,w.minimized&&u(j,d),f.appendChild(j)),w.detachable&&(h=document.createElement("div"),h.className=l.btn+" "+l.detach,h.title="Detach",f.appendChild(h)),w.header_btn)for(x=0;x<w.header_btn.length;x+=1)q=w.header_btn[x],p=document.createElement("div"),void 0!==q.title&&(p.title=q.title),void 0!==q.on_click&&(p.addEventListener("touchstart",q.on_click,!1),p.addEventListener("mousedown",q.on_click,!1),void 0!==q.class_name&&(p.className=l.btn+" "+q.class_name,f.appendChild(p)));return w.status_bar&&(s=document.createElement("div"),s.classList.add(l.status_bar),s.classList.add(l.transition),s.classList.add(l.open),s.innerHTML=w.status_bar_content,d.appendChild(s)),f.addEventListener("click",y,!1),f.addEventListener("touchstart",y,!1),window.addEventListener("resize",function(){v(!1)},!1),window.addEventListener("beforeunload",G,!1),d.classList.add(l.transition),d.classList.add(l.dim_transition),d.insertBefore(f,z),w.resizable&&(g=document.createElement("div"),g.addEventListener("mousedown",D,!1),g.addEventListener("touchstart",D,!1),g.classList.add("wui-dialog-resize"),g.classList.add(l.transition),g.classList.add(l.open),d.appendChild(g)),b[a]={dialog:d,minimized_id:-1,resize_handler:g,header_minimaxi_btn:j,opts:w,detachable_ref:null,modal_element:null,status_bar:s},t(d),r(d),w.open?this.open(a,!1):d.classList.add(l.closed),a},this.setStatusBarContent=function(a,c){var d,e,f=b[a];return void 0===f?void o('Cannot setStatusBarContent of WUI dialog "'+a+'".'):void(f.status_bar&&(f.status_bar.innerHTML=c,e=f.detachable_ref,e&&(e.closed||(d=e.document.body.getElementsByClassName(l.status_bar),d.length>0&&(d[0].innerHTML=c)))))},this.open=function(a,c){var d,e,f,g=b[a];if(void 0===g)return void o('Cannot open WUI dialog "'+a+'".');if(g.detachable_ref&&!g.detachable_ref.closed)return void g.detachable_ref.focus();if(f=g.dialog,g.opts.modal)for(d=s(f),g.dialog.style.zIndex=16777271,g.modal_element=d,document.body.appendChild(d),e=0;e<k.length;e+=1)d=s(f),k[e].document.body.appendChild(d);return c?void x(f):(f.classList.remove(l.closed),f.classList.add(l.open),void r(f))},this.focus=function(a){var c=b[a];return void 0===c?void o('Cannot focus WUI dialog "'+a+'".'):void r(c.dialog)},this.close=function(a,c){var d=b[a];return void 0===d?void o('Cannot close WUI dialog "'+a+'".'):void q(d.dialog,!0,c,!0)},this.destroy=function(a){var c,d=b[a];return void 0===d?void o("Element id '"+a+"' is not a WUI_Dialog, destroying aborted."):(q(d.dialog,!0,!1,!0),c=d.dialog,c.parentElement.removeChild(c),void delete b[a])},this.childWindowLoaded=function(a){var c=b[a],d=c.detachable_ref;d&&(d.document.body.firstElementChild?(w(c.dialog.children[1],d.document.body.firstElementChild),c.opts.on_detach&&c.opts.on_detach(d)):window.setTimeout(function(){WUI_Dialog.childWindowLoaded(a)},500))},this.getDetachedDialog=function(a){var c=b[a],d=0;if(void 0===c)return void 0!==a&&o("WUI_Dialog.getDetachedDialog: Element id '"+a+"' is not a WUI_Dialog."),null;for(d=0;d<k.length;d+=1)if(k[d]===c.detachable_ref)return c.detachable_ref;return null},document.addEventListener("keyup",z,!1)};