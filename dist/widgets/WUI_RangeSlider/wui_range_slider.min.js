var WUI_RangeSlider=new function(){"use strict";var a={},b=null,c=null,d=null,e=null,f={hook:"wui-rangeslider-hook",bar:"wui-rangeslider-bar",filler:"wui-rangeslider-filler",hook_focus:"wui-rangeslider-hook-focus"},g={width:148,height:8,title:"",title_min_width:0,value_min_width:0,min:0,max:1,step:.01,scroll_step:.01,vertical:!1,title_on_top:!1,on_change:null,default_value:.5},h=function(a){var b=a.ownerDocument,c=a.getBoundingClientRect(),d=b.body,e=b.documentElement,f=b.defaultView||b.parentWindow,g=f.pageYOffset||e.scrollTop||d.scrollTop,h=f.pageXOffset||e.scrollLeft||d.scrollLeft,i=e.clientTop||d.clientTop||0,j=e.clientLeft||d.clientLeft||0,k=c.top+g-i,l=c.left+h-j;return{top:Math.round(k),left:Math.round(l)}},i=function(a,b){null!==a&&a(b)},j=function(a,b){var c=""+a,d=c.indexOf("."),e=-1==d?c.length:1+d+b,f=c.substr(0,e),g=isNaN(f)?0:f;return parseFloat(g)},k=function(a){return a.classList.contains(f.hook)?a:a.classList.contains(f.filler)?a.firstElementChild:a.firstElementChild.firstElementChild},l=function(b,c,d){var e=b,f=e.childNodes[2],g=a[e.id],h=e.childNodes[1],i=h.firstElementChild,k=i.firstElementChild,l=c.opts.width,m=c.opts.height,n=Math.abs((d-c.opts.min)/c.opts.range);d=j(d,4),c.opts.vertical?(n=Math.round(n*h.offsetHeight),i.style.position="absolute",i.style.bottom="0",i.style.width="100%",i.style.height=n+"px",k.style.marginTop=-l+"px",k.style.marginLeft=-l/2-1+"px",k.style.width=2*l+"px",k.style.height=2*l+"px",f.style.marginTop="13px",g.element!==e&&(g.filler.style.position="absolute",g.filler.style.bottom="0",g.filler.style.width="100%",g.filler.style.height=n+"px",g.hook.style.marginTop=-l+"px",g.hook.style.marginLeft=-l/2-1+"px",g.hook.style.width=2*l+"px",g.hook.style.height=2*l+"px",g.value_input.style.marginTop="13px")):(n=Math.round(n*l),i.style.width=n+"px",i.style.height="100%",k.style.left=n+"px",k.style.marginTop=-m/2+"px",k.style.marginLeft=-m+"px",k.style.width=2*m+"px",k.style.height=2*m+"px",g.element!==e&&(g.filler.style.width=n+"px",g.filler.style.height="100%",g.hook.style.left=n+"px",g.hook.style.marginTop=-m/2+"px",g.hook.style.marginLeft=-m+"px",g.hook.style.width=2*m+"px",g.hook.style.height=2*m+"px")),g.value_input.value=d,f.value=d,c.value=d},m=function(a){if(a.preventDefault(),null!==d){var f,g,k=d.parentElement,l=k.parentElement,m=l.parentElement.lastElementChild,n=h(l),o=l.offsetWidth,p=0,q=a.clientX,r=a.clientY,s=a.changedTouches,t=null;if(s)for(f=0;s.length>f;f+=1)if(t=s[f],t.identifier===e){q=s[f].clientX,r=s[f].clientY;break}if(c.opts.vertical?(o=l.offsetHeight,p=Math.round((n.top+l.offsetHeight-r)/c.opts.step)*c.opts.step):p=Math.round((q-n.left)/c.opts.step)*c.opts.step,p>o?(p=o,b=c.opts.max):0>p?(p=0,b=c.opts.min):b=Math.round((c.opts.min+p/o*c.opts.range)/c.opts.step)*c.opts.step,c.value===b)return;c.value=b,g=j(b,4),m.value=g,c.value_input.value=g,c.opts.vertical?(k.style.height=p+"px",c.filler.style.height=p+"px"):(k.style.width=p+"px",c.filler.style.width=p+"px",d.style.left=p+"px",c.hook.style.left=p+"px"),i(c.opts.on_change,b)}},n=function(a){if(d){a.preventDefault();var b,g=a.changedTouches,h=null,i=!1,j=d.ownerDocument,k=j.defaultView||j.parentWindow;if(g){for(b=0;g.length>b;b+=1)if(h=g[b],h.identifier===e){i=!0,k.removeEventListener("touchend",n,!1),k.removeEventListener("touchmove",m,!1);break}}else i=!0,k.removeEventListener("mouseup",n,!1),k.removeEventListener("mousemove",m,!1);i&&(d.classList.remove(f.hook_focus),d=null,c=null,j.body.style.cursor="default")}},o=function(b){b.preventDefault(),b.stopPropagation();var g,h,i=null,j=!1,l=b.changedTouches;null===c&&l&&(e=l[0].identifier,j=!0),0===b.button&&(j=!0),j&&(d=k(b.target),d.classList.add(f.hook_focus),i=d.parentElement.parentElement.parentElement,c=a[i.id],g=i.ownerDocument,h=g.defaultView||g.parentWindow,g.body.style.cursor="pointer",m(b),h.addEventListener("mousemove",m,!1),h.addEventListener("touchmove",m,!1),h.addEventListener("mouseup",n,!1),h.addEventListener("touchend",n,!1))},p=function(b){b.preventDefault(),b.stopPropagation();var c=b.target,d=c.parentElement.parentElement.parentElement,e=a[d.id],f=e.opts.default_value;l(d,e,f),i(e.opts.on_change,f)},q=function(b){b.preventDefault(),b.stopPropagation();var c=k(b.target),d=c.parentElement.parentElement.parentElement,e=a[d.id],f=b.wheelDelta?b.wheelDelta/40:b.detail?-b.detail:0,g=e.value;f>=0?g+=e.opts.scroll_step:g-=e.opts.scroll_step,g>e.opts.max?g=e.opts.max:e.opts.min>g&&(g=e.opts.min),l(d,e,g),i(e.opts.on_change,g)},r=function(b){if(!b.target.validity||b.target.validity.valid){var c=b.target.parentElement.childNodes[1];if(void 0!==c){var d=k(c),e=d.parentElement.parentElement.parentElement,f=a[e.id];l(e,f,b.target.value),i(f.opts.on_change,b.target.value)}}};this.create=function(b,c){var d,e=document.getElementById(b),h={};if(void 0!==a[b])return void console.log("WUI_RangeSlider id '"+b+"' already created, aborting.");for(d in g)g.hasOwnProperty(d)&&(h[d]=g[d]);if(void 0!==c){for(d in c)c.hasOwnProperty(d)&&void 0!==g[d]&&(h[d]=c[d]);void 0!==c.max&&(h.range=c.max),void 0!==c.step&&(h.step=c.step,void 0===c.scroll_step&&(h.scroll_step=h.step)),void 0!==c.title_on_top?h.title_on_top=c.title_on_top:h.vertical&&(h.title_on_top=!0),void 0!==c.default_value?h.default_value=c.default_value:void 0!==c.min&&void 0!==c.max&&(h.default_value=h.min+h.max/2)}0>h.min&&(h.range=h.max-h.min),a[b]=null,e.classList.add("wui-rangeslider"),h.title_on_top&&e.classList.add("wui-rangeslider-title-ontop");var i=document.createElement("div"),j=document.createElement("div"),k=document.createElement("div"),m=document.createElement("div"),n=document.createElement("div"),s=document.createElement("input"),t={element:e,opts:h,bar:j,filler:k,hook:m,value_input:s,value:h.default_value};return i.innerHTML=h.title,s.setAttribute("value",h.default_value),s.setAttribute("type","number"),s.setAttribute("min",h.min),s.setAttribute("max",h.max),s.setAttribute("step",h.step),s.classList.add("wui-rangeslider-input"),n.classList.add("wui-rangeslider-value"),i.classList.add("wui-rangeslider-title"),j.classList.add(f.bar),k.classList.add(f.filler),m.classList.add(f.hook),h.vertical&&(i.style.textAlign="center"),i.style.minWidth=h.title_min_width+"px",n.style.minWidth=h.value_min_width+"px",s.style.minWidth=h.value_min_width+"px",j.style.width=h.width+"px",j.style.height=h.height+"px",j.appendChild(k),k.appendChild(m),e.appendChild(i),e.appendChild(j),e.appendChild(s),j.addEventListener("mousedown",o,!1),j.addEventListener("touchstart",o,!1),m.addEventListener("dblclick",p,!1),s.addEventListener("input",r,!1),j.addEventListener("mousewheel",q,!1),j.addEventListener("DOMMouseScroll",q,!1),a[b]=t,l(e,t,h.default_value),b},this.destroy=function(b){var c,d=a[b];return void 0===d?void console.log("Element id '"+b+"' is not a WUI_RangeSlider, destroying aborted."):(c=d.element,c.parentElement.removeChild(c),void delete a[b])}};
