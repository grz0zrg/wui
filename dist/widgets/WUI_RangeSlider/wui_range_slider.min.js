var WUI_RangeSlider=new function(){"use strict";var a={},b=null,c=null,d=null,e=null,f="_wui_container",g={hook:"wui-rangeslider-hook",bar:"wui-rangeslider-bar",filler:"wui-rangeslider-filler",hook_focus:"wui-rangeslider-hook-focus",value_input:"wui-rangeslider-input"},h={width:148,height:8,title:"",title_min_width:0,value_min_width:0,min:0,max:1,step:.01,scroll_step:.01,vertical:!1,title_on_top:!1,on_change:null,default_value:.5,configurable:null},i={min:0,max:0,step:0,scroll_step:0},j=function(a){var b=a.ownerDocument,c=a.getBoundingClientRect(),d=b.body,e=b.documentElement,f=b.defaultView||b.parentWindow,g=f.pageYOffset||e.scrollTop||d.scrollTop,h=f.pageXOffset||e.scrollLeft||d.scrollLeft,i=e.clientTop||d.clientTop||0,j=e.clientLeft||d.clientLeft||0,k=c.top+g-i,l=c.left+h-j;return{top:Math.round(k),left:Math.round(l)}},k=function(a,b){null!==a&&a(b)},l=function(a,b){var c=""+a,d=c.indexOf("."),e=-1==d?c.length:1+d+b,f=c.substr(0,e),g=isNaN(f)?0:f;return parseFloat(g)},m=function(a){return a.classList.contains(g.hook)?a:a.classList.contains(g.filler)?a.firstElementChild:a.firstElementChild.firstElementChild},n=function(b,c,d){var e=b,f=a[e.id],h=e.getElementsByClassName(g.bar)[0],i=h.firstElementChild,j=i.firstElementChild,k=h.nextElementSibling,m=c.opts.width,n=c.opts.height,o=Math.abs((d-c.opts.min)/c.opts.range);d=l(d,4),c.opts.vertical?(o=Math.round(o*h.offsetHeight),i.style.position="absolute",i.style.bottom="0",i.style.width="100%",i.style.height=o+"px",j.style.marginTop=-m+"px",j.style.marginLeft=-m/2-1+"px",j.style.width=2*m+"px",j.style.height=2*m+"px",k.style.marginTop="13px",f.element!==e&&(f.filler.style.position="absolute",f.filler.style.bottom="0",f.filler.style.width="100%",f.filler.style.height=o+"px",f.hook.style.marginTop=-m+"px",f.hook.style.marginLeft=-m/2-1+"px",f.hook.style.width=2*m+"px",f.hook.style.height=2*m+"px",f.value_input.style.marginTop="13px")):(o=Math.round(o*m),i.style.width=o+"px",i.style.height="100%",j.style.left=o+"px",j.style.marginTop=-n/2+"px",j.style.marginLeft=-n+"px",j.style.width=2*n+"px",j.style.height=2*n+"px",f.element!==e&&(f.filler.style.width=o+"px",f.filler.style.height="100%",f.hook.style.left=o+"px",f.hook.style.marginTop=-n/2+"px",f.hook.style.marginLeft=-n+"px",f.hook.style.width=2*n+"px",f.hook.style.height=2*n+"px")),f.value_input.value=d,k.value=d,c.value=d},o=function(a){if(a.preventDefault(),null!==d){var f,g,h=d.parentElement,i=h.parentElement,m=i.nextElementSibling,n=j(i),o=i.offsetWidth,p=0,q=a.clientX,r=a.clientY,s=a.changedTouches,t=null;if(s)for(f=0;s.length>f;f+=1)if(t=s[f],t.identifier===e){q=s[f].clientX,r=s[f].clientY;break}if(c.opts.vertical?(o=i.offsetHeight,p=Math.round((n.top+i.offsetHeight-r)/c.opts.step)*c.opts.step):p=Math.round((q-n.left)/c.opts.step)*c.opts.step,p>o?(p=o,b=c.opts.max):0>p?(p=0,b=c.opts.min):b=Math.round((c.opts.min+p/o*c.opts.range)/c.opts.step)*c.opts.step,c.value===b)return;c.value=b,g=l(b,4),m.value=g,c.value_input.value=g,c.opts.vertical?(h.style.height=p+"px",c.filler.style.height=p+"px"):(h.style.width=p+"px",c.filler.style.width=p+"px",d.style.left=p+"px",c.hook.style.left=p+"px"),k(c.opts.on_change,b)}},p=function(a){if(d){a.preventDefault();var b,f=a.changedTouches,h=null,i=!1,j=d.ownerDocument,k=j.defaultView||j.parentWindow;if(f){for(b=0;f.length>b;b+=1)if(h=f[b],h.identifier===e){i=!0,k.removeEventListener("touchend",p,!1),k.removeEventListener("touchmove",o,!1);break}}else i=!0,k.removeEventListener("mouseup",p,!1),k.removeEventListener("mousemove",o,!1);i&&(d.classList.remove(g.hook_focus),d=null,c=null,j.body.style.cursor="default")}},q=function(b){b.preventDefault(),b.stopPropagation();var f,h,i=null,j=!1,k=b.changedTouches;null===c&&k&&(e=k[0].identifier,j=!0),0===b.button&&(j=!0),j&&(d=m(b.target),d.classList.add(g.hook_focus),i=d.parentElement.parentElement.parentElement,c=a[i.id],f=i.ownerDocument,h=f.defaultView||f.parentWindow,f.body.style.cursor="pointer",o(b),h.addEventListener("mousemove",o,!1),h.addEventListener("touchmove",o,!1),h.addEventListener("mouseup",p,!1),h.addEventListener("touchend",p,!1))},r=function(b){b.preventDefault(),b.stopPropagation();var c=b.target,d=c.parentElement.parentElement.parentElement,e=a[d.id],f=e.opts.default_value;n(d,e,f),k(e.opts.on_change,f)},s=function(b){b.preventDefault(),b.stopPropagation();var c=m(b.target),d=c.parentElement.parentElement.parentElement,e=a[d.id],f=b.wheelDelta?b.wheelDelta/40:b.detail?-b.detail:0,g=e.value;f>=0?g+=e.opts.scroll_step:g-=e.opts.scroll_step,g>e.opts.max?g=e.opts.max:e.opts.min>g&&(g=e.opts.min),n(d,e,g),k(e.opts.on_change,g)},t=function(b){if(!b.target.validity||b.target.validity.valid){var c=b.target.parentElement.childNodes[1];if(void 0!==c){var d=m(c),e=d.parentElement.parentElement.parentElement,f=a[e.id];n(e,f,b.target.value),k(f.opts.on_change,b.target.value)}}},u=function(a,b,c){return function(a){var d=a.target,e=b.opts;(!d.validity||d.validity.valid)&&("min"===c?(e.min=l(d.value,4),b.value_input.min=e.min,e.range=e.max-e.min):"max"===c?(e.max=l(d.value,4),b.value_input.max=e.max,e.range=e.max-e.min):"step"===c?(e.step=l(d.value,4),b.value_input.step=e.step):"scroll_step"===c&&(e.scroll_step=l(d.value,4)),void 0!==e.configurable[c]&&(e.configurable[c].val=d.value))}},v=function(b){b.preventDefault(),b.stopPropagation();var c,d,e,h,k,l,m,n,o=b.target,p=o.parentElement,q=a[p.id],r=q.opts,s=o.ownerDocument,t=q.element.id+f,v=1;if(document.getElementById(t)||(q.configure_panel_open=!1),q.configure_panel_open!==!0){k=s.createElement("div"),k.className="wui-rangeslider-configure-container",n=s.createElement("div"),n.className="wui-rangeslider-configure-close",c=function(a){q.configure_panel_open=!1;var b=document.getElementById(t),c=a.target.ownerDocument.getElementById(t);b&&b.parentElement.removeChild(b),c&&c.parentElement.removeChild(c)},n.addEventListener("click",c,!1),n.addEventListener("touchstart",c,!1),k.id=t,k.appendChild(n);for(e in r.configurable)r.configurable.hasOwnProperty(e)&&void 0!==i[e]&&(h=r.configurable[e],l=s.createElement("div"),l.style.display="inline-block",l.style.marginRight="8px",l.style.width="80px",l.style.textAlign="right",l.innerHTML=e.replace("_"," ")+" : ",m=s.createElement("input"),m.className=g.value_input,k.appendChild(l),k.appendChild(m),v%2===0&&k.appendChild(s.createElement("div")),m.setAttribute("type","number"),void 0!==h&&(void 0!==h.min&&(m.setAttribute("min",h.min),m.title=m.title+" min: "+h.min),void 0!==h.max&&(m.setAttribute("max",h.max),m.title=m.title+" max: "+h.max),void 0!==h.val?m.setAttribute("value",h.val):"min"===e?m.setAttribute("value",r.min):"max"===e?m.setAttribute("value",r.max):"step"===e?m.setAttribute("value",r.step):"scroll_step"===e&&m.setAttribute("value",r.scroll_step)),m.addEventListener("input",u(b,q,e),!1),v+=1);d=j(o),p.insertBefore(k,o),q.configure_panel_open=!0}};this.create=function(b,c){var d,e=document.getElementById(b),f={};if(void 0!==a[b])return void console.log("WUI_RangeSlider id '"+b+"' already created, aborting.");for(d in h)h.hasOwnProperty(d)&&(f[d]=h[d]);if(void 0!==c){for(d in c)c.hasOwnProperty(d)&&void 0!==h[d]&&(f[d]=c[d]);void 0!==c.max&&(f.range=c.max),void 0!==c.step&&(f.step=c.step,void 0===c.scroll_step&&(f.scroll_step=f.step)),void 0!==c.title_on_top?f.title_on_top=c.title_on_top:f.vertical&&(f.title_on_top=!0),void 0!==c.default_value?f.default_value=c.default_value:void 0!==c.min&&void 0!==c.max&&(f.default_value=f.min+f.max/2)}0>f.min&&(f.range=f.max-f.min),a[b]=null,e.classList.add("wui-rangeslider"),f.title_on_top&&e.classList.add("wui-rangeslider-title-ontop");var j=document.createElement("div"),k=document.createElement("div"),l=document.createElement("div"),m=document.createElement("div"),o=document.createElement("div"),p=document.createElement("input"),u={element:e,opts:f,bar:k,filler:l,hook:m,value_input:p,value:f.default_value};if(j.innerHTML=f.title,p.setAttribute("value",f.default_value),p.setAttribute("type","number"),p.setAttribute("min",f.min),p.setAttribute("max",f.max),p.setAttribute("step",f.step),p.classList.add(g.value_input),o.classList.add("wui-rangeslider-value"),j.classList.add("wui-rangeslider-title"),k.classList.add(g.bar),l.classList.add(g.filler),m.classList.add(g.hook),f.vertical&&(j.style.textAlign="center"),j.style.minWidth=f.title_min_width+"px",o.style.minWidth=f.value_min_width+"px",p.style.minWidth=f.value_min_width+"px",k.style.width=f.width+"px",k.style.height=f.height+"px",k.appendChild(l),l.appendChild(m),e.appendChild(j),e.appendChild(k),e.appendChild(p),f.configurable){var w=0;for(d in f.configurable)f.configurable.hasOwnProperty(d)&&void 0!==i[d]&&(w+=1);if(w>0){var x=document.createElement("div");x.classList.add("wui-rangeslider-configurable-btn"),x.addEventListener("click",v,!1),x.addEventListener("touchstart",v,!1),f.title_on_top&&!f.vertical?(x.style.bottom="0",j.style.marginBottom="4px"):f.title_on_top&&f.vertical?(j.style.marginLeft="16px",j.style.marginRight="16px",x.style.top="0"):(j.style.marginLeft="16px",x.style.top="0"),f.vertical?e.appendChild(x):e.insertBefore(x,j)}}return k.addEventListener("mousedown",q,!1),k.addEventListener("touchstart",q,!1),m.addEventListener("dblclick",r,!1),p.addEventListener("input",t,!1),k.addEventListener("mousewheel",s,!1),k.addEventListener("DOMMouseScroll",s,!1),a[b]=u,n(e,u,f.default_value),b},this.destroy=function(b){var c,d,e,g=a[b];return void 0===g?void console.log("Element id '"+b+"' is not a WUI_RangeSlider, destroying aborted."):(c=g.element,c.parentElement.removeChild(c),d=c.ownerDocument,e=d.getElementById(b+f),e&&d.removeChild(e),void delete a[b])}};