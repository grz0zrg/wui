var WUI_RangeSlider=new function(){"use strict";var a={},b=null,c=null,d=null,e=null,f="_wui_container",g="background-color: #00ff00",h=null,i={},j={g:"MIDI learn"},k={h:"wui-rangeslider-hook",i:"wui-rangeslider-bar",j:"wui-rangeslider-filler",k:"wui-rangeslider-hook-focus",l:"wui-rangeslider-input",g:"wui-rangeslider-midi-learn-btn"},l={width:148,height:8,title:"",m:0,o:0,min:0,max:1,p:4,step:.01,q:.01,vertical:!1,s:!1,t:null,u:0,value:0,i:!0,v:null,A:null},m={min:0,max:0,step:0,q:0},n={B:{},C:!1,v:{},value:0},o=function(a){for(var b,c,d=document.getElementById(a);d;){if(d.classList&&d.classList.contains("wui-dialog")){b=d.id;break}d=d.parentNode}return WUI_Dialog&&(c=WUI_Dialog.D(b))?c.document.getElementById(a):null},p=function(a){var b=a.ownerDocument,c=a.getBoundingClientRect(),d=b.body,e=b.documentElement,f=b.defaultView||b.parentWindow,g=f.pageYOffset||e.scrollTop||d.scrollTop,h=f.pageXOffset||e.scrollLeft||d.scrollLeft,i=e.clientTop||d.clientTop||0,j=e.clientLeft||d.clientLeft||0,k=c.top+g-i,l=c.left+h-j;return{top:Math.round(k),left:Math.round(l)}},q=function(a,b){null!==a&&a(b)},r=function(a,b){var c=""+a,d=c.indexOf("."),e=d==-1?c.length:1+d+b,f=c.substr(0,e),g=isNaN(f)?0:f;return parseFloat(g)},s=function(a){return a.classList.contains(k.h)?a:a.classList.contains(k.j)?a.firstElementChild:a.firstElementChild.firstElementChild},t=function(b,c,d){var e,f,g,h,i=b,j=a[i.id],l=c.B.width,m=c.B.height,n=Math.abs((d-c.B.min)/c.B.range);e=i.getElementsByClassName(k.i)[0],f=e.firstElementChild,g=f.firstElementChild,h=e.nextElementSibling,d=r(d,j.B.p),c.B.vertical?(n=Math.round(n*e.offsetHeight),f.style.position="absolute",f.style.bottom="0",f.style.width="100%",f.style.height=n+"px",g.style.marginTop=-l+"px",g.style.marginLeft=-l/2-1+"px",g.style.width=2*l+"px",g.style.height=2*l+"px",h.style.marginTop="13px",j.F!==i&&(j.j.style.position="absolute",j.j.style.bottom="0",j.j.style.width="100%",j.j.style.height=n+"px",j.h.style.marginTop=-l+"px",j.h.style.marginLeft=-l/2-1+"px",j.h.style.width=2*l+"px",j.h.style.height=2*l+"px",j.l.style.marginTop="13px")):(n=Math.round(n*l),f.style.width=n+"px",f.style.height="100%",g.style.left=n+"px",g.style.marginTop=-m/2+"px",g.style.marginLeft=-m+"px",g.style.width=2*m+"px",g.style.height=2*m+"px",j.F!==i&&(j.j.style.width=n+"px",j.j.style.height="100%",j.h.style.left=n+"px",j.h.style.marginTop=-m/2+"px",j.h.style.marginLeft=-m+"px",j.h.style.width=2*m+"px",j.h.style.height=2*m+"px")),j.l.value=d,h.value=d,c.value=d},u=function(a){if(a.preventDefault(),null!==d){var f,g,h=d.parentElement,i=h.parentElement,j=i.nextElementSibling,k=p(i),l=i.offsetWidth,m=0,n=a.clientX,o=a.clientY,s=a.changedTouches,t=null;if(s)for(f=0;f<s.length;f+=1)if(t=s[f],t.identifier===e){n=s[f].clientX,o=s[f].clientY;break}if(c.B.vertical?(l=i.offsetHeight,m=Math.round((k.top+i.offsetHeight-o)/c.B.step)*c.B.step):m=Math.round((n-k.left)/c.B.step)*c.B.step,m>l?(m=l,b=c.B.max):m<0?(m=0,b=c.B.min):b=Math.round((c.B.min+m/l*c.B.range)/c.B.step)*c.B.step,c.value===b)return;c.value=b,g=r(b,c.B.p),j.value=g,c.l.value=g,c.B.vertical?(h.style.height=m+"px",c.j.style.height=m+"px"):(h.style.width=m+"px",c.j.style.width=m+"px",d.style.left=m+"px",c.h.style.left=m+"px"),q(c.B.t,b)}},v=function(a){if(d){a.preventDefault();var b,f=a.changedTouches,g=null,h=!1,i=d.ownerDocument,j=i.defaultView||i.parentWindow;if(f){for(b=0;b<f.length;b+=1)if(g=f[b],g.identifier===e){h=!0,j.removeEventListener("touchend",v,!1),j.removeEventListener("touchmove",u,!1);break}}else h=!0,j.removeEventListener("mouseup",v,!1),j.removeEventListener("mousemove",u,!1);h&&(d.classList.remove(k.k),d=null,c=null,i.body.style.cursor="default")}},w=function(b){b.preventDefault(),b.stopPropagation();var f,g,h=null,i=!1,j=b.changedTouches;null===c&&j&&(e=j[0].identifier,i=!0),0===b.button&&(i=!0),i&&(d=s(b.target),d.classList.add(k.k),h=d.parentElement.parentElement.parentElement,c=a[h.id],f=h.ownerDocument,g=f.defaultView||f.parentWindow,f.body.style.cursor="pointer",u(b),g.addEventListener("mousemove",u,!1),g.addEventListener("touchmove",u,!1),g.addEventListener("mouseup",v,!1),g.addEventListener("touchend",v,!1))},x=function(b){b.preventDefault(),b.stopPropagation();var c=b.target,d=c.parentElement.parentElement.parentElement,e=a[d.id],f=e.B.u;t(d,e,f),q(e.B.t,f)},y=function(b){b.preventDefault(),b.stopPropagation();var c=s(b.target),d=c.parentElement.parentElement.parentElement,e=a[d.id],f=b.wheelDelta?b.wheelDelta/40:b.detail?-b.detail:0,g=e.value;f>=0?g+=e.B.q:g-=e.B.q,g>e.B.max?g=e.B.max:g<e.B.min&&(g=e.B.min),t(d,e,g),q(e.B.t,g)},z=function(b){if(!b.target.validity||b.target.validity.valid){var c=b.target.parentElement.childNodes[1];if(void 0!==c){var d=s(c),e=d.parentElement.parentElement.parentElement,f=a[e.id];t(e,f,b.target.value),q(f.B.t,b.target.value)}}},A=function(a,b,c){return function(a){var d=a.target,e=b.B;d.validity&&!d.validity.valid||("min"===c?(e.min=r(d.value,e.p),b.l.min=e.min,e.range=e.max-e.min):"max"===c?(e.max=r(d.value,e.p),b.l.max=e.max,e.range=e.max-e.min):"step"===c?(e.step=r(d.value,e.p),b.l.step=e.step):"scroll_step"===c&&(e.q=r(d.value,e.p)),void 0!==e.A[c]&&(e.A[c].G=d.value))}},B=function(a){var b,c,d,e,f;if(a)for(b in i)for(c in i[b])for(d=i[b][c],f=0;f<d.H.length;f+=1)if(e=d.H[f],e===a)return void d.H.splice(f,1)},C=function(b){b.preventDefault(),b.stopPropagation();var c,d,e,f,i=b.target,l=i.parentElement,m=a[l.id];if(m.I)return m.I=!1,i.style="",i.title=j.g,m.J.title=j.g,h=null,m.v.K=null,m.v.controller=null,void B(l.id);for(d in a)a.hasOwnProperty(d)&&(e=a[d],e.I=!1,c=o(d),c&&(f=c.getElementsByClassName(k.g),f.length>0&&(f[0].style="")),e.J&&(e.J.style=""));m.I=!0,i.style=g,h=l.id},D=function(b){b.preventDefault(),b.stopPropagation();var c,d,e,g,h,i,j,l,n=b.target,o=n.parentElement,q=a[o.id],r=q.B,s=n.ownerDocument,t=q.F.id+f,u=1;if(document.getElementById(t)||(q.L=!1),q.L!==!0){h=s.createElement("div"),h.className="wui-rangeslider-configure-container",l=s.createElement("div"),l.className="wui-rangeslider-configure-close",c=function(a){q.L=!1;var b=document.getElementById(t),c=a.target.ownerDocument.getElementById(t);b&&b.parentElement&&b.parentElement.removeChild(b),c&&c.parentElement&&c.parentElement.removeChild(c)},l.addEventListener("click",c,!1),l.addEventListener("touchstart",c,!1),h.id=t,h.appendChild(l);for(e in r.A)r.A.hasOwnProperty(e)&&void 0!==m[e]&&(g=r.A[e],i=s.createElement("div"),i.style.display="inline-block",i.style.marginRight="8px",i.style.width="80px",i.style.textAlign="right",i.innerHTML=e.replace("_"," ")+" : ",j=s.createElement("input"),j.className=k.l,h.appendChild(i),h.appendChild(j),u%2===0&&h.appendChild(s.createElement("div")),j.setAttribute("type","number"),void 0!==g&&(void 0!==g.min&&(j.setAttribute("min",g.min),j.title=j.title+" min: "+g.min),void 0!==g.max&&(j.setAttribute("max",g.max),j.title=j.title+" max: "+g.max),void 0!==g.G?j.setAttribute("value",g.G):"min"===e?j.setAttribute("value",r.min):"max"===e?j.setAttribute("value",r.max):"step"===e?j.setAttribute("value",r.step):"scroll_step"===e&&j.setAttribute("value",r.q)),j.addEventListener("input",A(b,q,e),!1),u+=1);d=p(n),o.insertBefore(h,n),q.L=!0}},E=function(){console.log("WUI_RangeSlider 'create' failed, first argument not an id nor a DOM element.")};this.create=function(b,c){var d,e,f={};if("string"==typeof b)d=document.getElementById(b);else{if("object"!=typeof b)return void E();if("string"!=typeof b.innerHTML)return void E();d=b,b=d.id}if(void 0!==a[b])return void console.log("WUI_RangeSlider id '"+b+"' already created, aborting.");for(e in l)l.hasOwnProperty(e)&&(f[e]=l[e]);if(void 0!==c){for(e in c)c.hasOwnProperty(e)&&void 0!==l[e]&&(f[e]=c[e]);void 0!==c.max&&(f.range=c.max),void 0!==c.step&&(f.step=c.step,void 0===c.q&&(f.q=f.step)),void 0!==c.s?f.s=c.s:f.vertical&&(f.s=!0),void 0!==c.u?f.u=c.u:void 0!==c.min&&void 0!==c.max&&(f.u=f.min+f.max/2)}f.min<0&&(f.range=f.max-f.min),a[b]=null,d.classList.add("wui-rangeslider"),f.s&&d.classList.add("wui-rangeslider-title-ontop");var g=document.createElement("div"),h=document.createElement("div"),i=document.createElement("div"),n=document.createElement("div"),o=document.createElement("div"),p=document.createElement("input"),q={F:d,B:f,i:null,j:null,h:null,C:!1,v:{K:null,controller:null,M:"abs"},I:!1,J:null,l:p,u:f.u,value:f.value};if(g.innerHTML=f.title,p.setAttribute("value",f.value),p.setAttribute("type","number"),p.setAttribute("step",f.step),p.classList.add(k.l),o.classList.add("wui-rangeslider-value"),g.classList.add("wui-rangeslider-title"),h.classList.add(k.i),i.classList.add(k.j),n.classList.add(k.h),f.vertical&&(g.style.textAlign="center"),g.style.minWidth=f.m+"px",o.style.minWidth=f.o+"px",p.style.minWidth=f.o+"px",h.style.width=f.width+"px",h.style.height=f.height+"px",d.appendChild(g),f.i?(p.setAttribute("min",f.min),p.setAttribute("max",f.max)):(h.style.display="none",p.style.marginTop="6px",c.max&&p.setAttribute("min",f.min),c.min&&p.setAttribute("max",f.max)),h.appendChild(i),i.appendChild(n),d.appendChild(h),q.i=h,q.j=i,q.h=n,d.appendChild(p),c.max||c.min||(q.C=!0),f.A){var r=0;for(e in f.A)f.A.hasOwnProperty(e)&&void 0!==m[e]&&(r+=1);if(r>0){var s=document.createElement("div");s.classList.add("wui-rangeslider-configurable-btn"),s.addEventListener("click",D,!1),s.addEventListener("touchstart",D,!1),f.s&&!f.vertical?(s.style.bottom="0",g.style.marginBottom="4px"):f.s&&f.vertical?(g.style.marginLeft="16px",g.style.marginRight="16px",s.style.top="0"):(g.style.marginLeft="16px",s.style.top="0"),f.vertical?d.appendChild(s):d.insertBefore(s,g)}}if(f.v)if(navigator.N){var u=document.createElement("div");u.classList.add(k.g),u.title=j.g,u.addEventListener("click",C,!1),u.addEventListener("touchstart",C,!1),q.J=u,f.v.type&&(q.v.M=f.v.type),d.appendChild(u)}else console.log("WUI_RangeSlider id '"+b+"' : Web MIDI API is disabled. (not supported by your browser?)");return f.i&&(h.addEventListener("mousedown",w,!1),h.addEventListener("touchstart",w,!1),n.addEventListener("dblclick",x,!1),h.addEventListener("mousewheel",y,!1),h.addEventListener("DOMMouseScroll",y,!1)),p.addEventListener("input",z,!1),a[b]=q,t(d,q,f.value),b},this.O=function(b){var c,d,e,g=a[b];return void 0===g?void console.log("Element id '"+b+"' is not a WUI_RangeSlider, destroying aborted."):(h===b&&(midi_learn_current=null),B(b),c=g.F,c.parentElement.removeChild(c),d=c.ownerDocument,e=d.getElementById(b+f),e&&d.removeChild(e),void delete a[b])},this.P=function(b){var c,d=a[b],e={};if(void 0===d)return void console.log("Element id '"+b+"' is not a WUI_RangeSlider, getParameters aborted.");for(c in d)d.hasOwnProperty(c)&&void 0!==n[c]&&(e[c]=d[c]);return e},this.R=function(b,c){var d,e=a[b];if(void 0===e)return void console.log("Element id '"+b+"' is not a WUI_RangeSlider, setParameters aborted.");for(d in e)e.hasOwnProperty(d)&&void 0!==c[d]&&(e[d]=c[d]);e.v.K&&e.v.controller&&i["d"+e.v.K]["c"+e.v.controller].H.push(b),t(e.F,e,e.value)},this.S=function(b){var c,d,e,f,g,j,l=h,m=b.data[0],n=b.data[1],p=parseInt(b.data[2],10),r="d"+m,s="c"+n,u=0;if(h)return c=a[l],i[r]||(i[r]={}),i[r][s]||(i[r][s]={T:p,H:[],U:1}),i[r][s].H.push(l),g=o(l),g&&(e=g.getElementsByClassName(k.g),e.length>0&&(e[0].style="",e[0].title=r+" "+s)),c.v.K=m,c.v.controller=n,c.I=!1,c.J.style="",c.J.title=r+" "+s,void(h=null);if(i[r]&&i[r][s])for(d=i[r][s],u=0;u<d.H.length;u+=1)if(l=d.H[u],c=a[l],g=o(l),f=g?g:c.F,"abs"===c.v.M)j=c.B.min+c.B.range*(p/127),t(f,c,j),q(c.B.t,j);else if("rel"===c.v.M){if(d.T>p){if(d.U=-c.B.step,j=c.value-c.B.step,j<c.B.min&&!c.C)continue;d.T=p}else if(d.T<p){if(d.U=c.B.step,j=c.value+c.B.step,j>c.B.max&&!c.C)continue;d.T=p}else if(j=c.value+d.U,!c.C){if(j>c.B.max)continue;if(j<c.B.min)continue}t(f,c,j),q(c.B.t,j)}}},WUI_Input=WUI_RangeSlider;