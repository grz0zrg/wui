var WUI_ToolBar=new function(){"use strict";var a={},b={minimize_icon:"wui-toolbar-minimize-icon",maximize_icon:"wui-toolbar-maximize-icon",button:"wui-toolbar-button",minimize_group:"wui-toolbar-minimize-group",minimize_gr_v:"wui-toolbar-minimize-group-vertical",toggle:"wui-toolbar-toggle",toggle_on:"wui-toolbar-toggle-on",item:"wui-toolbar-item",group:"wui-toolbar-group",vertical_group:"wui-toolbar-group-vertical",tb:"wui-toolbar",dd_content:"wui-toolbar-dropdown-content",dd_item:"wui-toolbar-dropdown-item",dd_open:"wui-toolbar-dropdown-open"},c={item_hmargin:null,item_vmargin:null,item_width:32,item_height:32,icon_width:32,icon_height:32,allow_groups_minimize:!1,vertical:!1},d=function(b){var c=a[b];return void 0===c?("undefined"!=typeof console&&console.log('_getWidget failed, the element id "'+b+'" is not a WUI_ToolBar.'),null):c},e=function(a){var b=a.ownerDocument,c=a.getBoundingClientRect(),d=b.body,e=b.documentElement,f=b.defaultView||b.parentWindow,g=f.pageYOffset||e.scrollTop||d.scrollTop,h=f.pageXOffset||e.scrollLeft||d.scrollLeft,i=e.clientTop||d.clientTop||0,j=e.clientLeft||d.clientLeft||0,k=c.top+g-i,l=c.left+h-j;return{top:Math.round(k),left:Math.round(l)}},f=function(c,d){return void 0!==d?a[d]:c.classList.contains(b.tb)?a[c.id]:c.classList.contains(b.minimize_icon)||c.classList.contains(b.maximize_icon)||c.classList.contains(b.vertical_group)||c.classList.contains(b.group)?a[c.parentElement.id]:a[c.parentElement.parentElement.id]},g=function(a,b,c){if(void 0!==a.on_click&&null!==a.on_click){var d={id:a.id,type:b};void 0!==c&&(d.state=c),a.on_click(d)}},h=function(a,c,d){var e,f=a.createElement("div");if(void 0!==c.items)for(e=0;c.items.length>e;e+=1){var g=c.items[e],h=a.createElement("div");c.vertical||h.classList.add("wui-toolbar-dropdown-horizontal"),h.classList.add(b.dd_item),h.innerHTML=g.title,h.dataset.index=e,f.appendChild(h)}return f.addEventListener("click",j,!1),f.style.width=d.dd_items_width+"px",f.classList.add(b.dd_content),f.dataset.linkedto_tb=d.element.id,f.dataset.linkedto_tool_index=c.id,a.body.appendChild(f),f},i=function(a,c,d){var e,h,i,j=null,k=!1,l=0;j=f(a,c),h=j.element,a.parentElement&&a.parentElement.parentElement&&(h=a.parentElement.parentElement);var m=j.tools[parseInt(a.dataset.tool_id,10)];if("1"===m.element.dataset.on?(m.element.dataset.on=0,a.dataset.on=0,m.element.title=m.tooltip,a.title=m.tooltip,void 0!==m.icon&&(m.element.classList.add(m.icon),m.element.classList.remove(m.toggled_icon),a.classList.add(m.icon),a.classList.remove(m.toggled_icon))):(m.element.dataset.on=1,a.dataset.on=1,void 0!==m.tooltip_toggled&&(m.element.title=m.tooltip_toggled,a.title=m.tooltip_toggled),void 0!==m.toggled_icon&&(m.element.classList.add(m.toggled_icon),m.element.classList.remove(m.icon),a.classList.add(m.toggled_icon),a.classList.remove(m.icon)),k=!0),"none"!==m.toggled_style&&(a.classList.contains(b.toggle_on)?(m.element.classList.remove(b.toggle_on),a.classList.remove(b.toggle_on)):(m.element.classList.add(b.toggle_on),a.classList.add(b.toggle_on))),e=a.dataset.toggle_group,void 0!==e)for(i=h.getElementsByClassName(b.item),l=0;i.length>l;l+=1){var n=i[l],o=j.tools[parseInt(n.dataset.tool_id,10)];if(e===n.dataset.toggle_group&&n.dataset.tool_id!==a.dataset.tool_id){if("0"===n.dataset.on)continue;n.dataset.on="0",o.element.dataset.on="0",n.classList.remove(b.toggle_on),o.element.classList.remove(b.toggle_on),void 0!==m.toggled_icon&&(n.classList.remove(o.toggled_icon),o.element.classList.remove(o.toggled_icon)),void 0!==m.icon&&(n.classList.add(o.icon),o.element.classList.add(o.icon)),(d||void 0===d)&&g(o,"toggle",!1)}}(d===!0||void 0===d)&&g(m,"toggle",k)},j=function(c){c.preventDefault(),c.stopPropagation();var d=c.target,e=d.ownerDocument,f=d.parentElement,g=a[f.dataset.linkedto_tb],h=parseInt(f.dataset.linkedto_tool_index,10),i=g.tools[h],j=parseInt(d.dataset.index,10),l=i.items[j],m=e.getElementById(f.dataset.linkedto_tb),n=m.getElementsByClassName(b.item),o=n[h];void 0!==l.on_click&&(l.on_click(),o.classList.remove(b.toggle_on),i.element.classList.remove(b.toggle_on),k(i,o))},k=function(a,c){var d,e,f=c.ownerDocument,g=f.body.getElementsByClassName(b.dd_content);for(e=0;g.length>e;e+=1)d=g[e],d.removeEventListener("click",j,!1),d.parentElement.removeChild(d);a.element.classList.remove(b.toggle_on),c.classList.remove(b.toggle_on)},l=function(a,b){var c=function(){var d=b.ownerDocument,e=d.defaultView||d.parentWindow;k(a,b),e.removeEventListener("click",c)};return c},m=function(a){a.preventDefault(),a.stopPropagation();var c=a.target;if(c.classList.contains(b.minimize_group)||c.classList.contains(b.minimize_gr_v))return void n(c);if(c.classList.contains(b.toggle))return void i(c);if(!(c.classList.contains(b.tb)||c.classList.contains(b.group)||c.classList.contains(b.vertical_group))){var d=null,j=null,m=null,o=null,p=c.ownerDocument,q=p.defaultView||p.parentWindow;if(o=f(c),d=o.tools[c.dataset.tool_id],"dropdown"===d.type){if(c.classList.contains(b.toggle_on))return void k(d,c);j=h(p,d,o);var r=d.element;c.classList.add(b.toggle_on),r.classList.add(b.toggle_on),m=e(c),"tb_item"===d.dd_items_width&&(j.style.width=c.offsetWidth+"px"),"s"===d.orientation?(j.style.top=m.top+c.offsetHeight+"px",j.style.left=m.left+"px"):"sw"===d.orientation?(j.style.top=m.top+c.offsetHeight+"px",j.style.left=m.left-j.offsetWidth+"px"):"nw"===d.orientation?(j.style.top=m.top-j.offsetHeight+c.offsetHeight+"px",j.style.left=m.left-j.offsetWidth+"px"):"se"===d.orientation?(j.style.top=m.top+c.offsetHeight+"px",j.style.left=m.left+c.offsetWidth+"px"):"ne"===d.orientation?(j.style.top=m.top-j.offsetHeight+c.offsetHeight+"px",j.style.left=m.left+c.offsetWidth+"px"):(j.style.top=m.top-j.offsetHeight+"px",j.style.left=m.left+"px"),j.classList.add(b.dd_open),a.stopPropagation&&a.stopPropagation(),q.addEventListener("click",l(d,c),!1)}else g(d,"click")}},n=function(a){var c=a.nextSibling;a.classList.contains(b.minimize_icon)?(a.classList.add(b.maximize_icon),a.classList.remove(b.minimize_icon),a.title="Maximize group",c.style.display="none"):(a.classList.add(b.minimize_icon),a.classList.remove(b.maximize_icon),a.title="Minimize group",c.style.display="")},o=function(){console.log("WUI_RangeSlider 'create' failed, first argument not an id nor a DOM element.")};this.create=function(d,e,f){var g,h,j=null,k=null,l=null,n=null,p={};if("string"==typeof d)g=document.getElementById(d);else{if("object"!=typeof d)return void o();if("string"!=typeof d.innerHTML)return void o();g=d,d=g.id}if(void 0!==a[d])return void console.log("WUI_Toolbar id '"+d+"' already created, aborting.");for(h in c)c.hasOwnProperty(h)&&(p[h]=c[h]);if(void 0!==e)for(h in e)e.hasOwnProperty(h)&&void 0!==c[h]&&(p[h]=e[h]);a[d]={element:g,tools:[],opts:p},g.classList.add(b.tb);var q=b.group,r=b.item,s="wui-toolbar-spacer",t=b.minimize_group;p.vertical?(g.classList.add("wui-toolbar-vertical"),q=b.vertical_group,r+=" wui-toolbar-item-vertical",s="wui-toolbar-spacer-vertical",t=b.minimize_gr_v,g.style.maxWidth=p.item_width+4+"px",null===p.item_hmargin&&(p.item_hmargin=3),null===p.item_vmargin&&(p.item_vmargin=8)):(g.style.maxHeight=p.item_height+4+"px",null===p.item_hmargin&&(p.item_hmargin=3),null===p.item_vmargin&&(p.item_vmargin=0)),t=b.button+" "+b.minimize_icon+" "+t,g.addEventListener("click",m,!1);var u;for(l in f)if(f.hasOwnProperty(l)){null!==n&&(k=document.createElement("div"),k.className=s,g.appendChild(k)),p.allow_groups_minimize&&(k=document.createElement("div"),k.className=t,k.title="Minimize group",g.appendChild(k)),j=f[l];var v=document.createElement("div");for(v.className=q,p.vertical?v.style.maxWidth=p.item_width+"px":v.style.maxHeight=p.item_height+"px",u=0;j.length>u;u+=1){var w,x=j[u],y=document.createElement("div"),z=a[d].tools.length,A={element:y,on_click:x.on_click,icon:x.icon,items:[],tooltip:"",type:x.type,dd_items_width:x.dropdown_items_width,orientation:x.orientation,id:z};if(y.className=r,y.style.minWidth=p.item_width+"px",y.style.minHeight=p.item_height+"px",y.style.marginLeft=p.item_hmargin+"px",y.style.marginRight=p.item_hmargin+"px",y.style.marginTop=p.item_vmargin+"px",y.style.marginBottom=p.item_vmargin+"px",y.style.backgroundSize=p.icon_width-4+"px "+(p.icon_height-4)+"px",v.appendChild(y),a[d].tools.push(A),y.dataset.tool_id=z,A.tooltip=x.tooltip,void 0!==x.tooltip&&(y.title=x.tooltip),void 0!==x.text&&(y.innerHTML=x.text,y.style.lineHeight=p.item_height+"px",y.classList.add("wui-toolbar-text"),void 0!==x.icon&&(y.style.paddingLeft=p.icon_width+2+"px",y.style.backgroundPosition="left center")),void 0!==x.icon&&y.classList.add(x.icon),"toggle"===x.type)y.classList.add(b.toggle),A.toggled_icon=x.toggled_icon,A.tooltip_toggled=x.tooltip_toggled,A.toggled_style=x.toggled_style,void 0!==x.toggle_group&&(y.dataset.toggle_group=x.toggle_group),x.toggle_state&&(y.dataset.on="1");else if("dropdown"===x.type){if(y.classList.add(b.button),void 0!==x.items)for(w=0;x.items.length>w;w+=1){var B=x.items[w];A.items.push({title:B.title,on_click:B.on_click})}}else y.classList.add(b.button)}g.appendChild(v),n=j}var C=g.getElementsByClassName(b.item);for(u=0;C.length>u;u+=1){var D=C[u];"1"===D.dataset.on&&(D.dataset.on="0",i(D,d,!0))}return d},this.hideGroup=function(a,c){var e,f,g,h=d(a);if(h){if(e=h.element.getElementsByClassName(h.opts.vertical?b.vertical_group:b.group),0===e.length)return;f=e[c],g=f.previousElementSibling,(g.classList.contains(b.minimize_group)||g.classList.contains(b.minimize_gr_v))&&(g.style.display="none"),f.style.display="none"}},this.showGroup=function(a,c){var e,f,g,h=d(a);if(h){if(e=h.element.getElementsByClassName(h.opts.vertical?b.vertical_group:b.group),0===e.length)return;f=e[c],g=f.previousElementSibling,(g.classList.contains(b.minimize_group)||g.classList.contains(b.minimize_gr_v))&&(g.style.display=""),e[c].style.display=""}},this.toggle=function(a,b,c){var e=d(a);e&&i(e.tools[b].element,a,c)},this.getItemElement=function(a,b){var c=d(a);return c?c.tools[b].element:void 0},this.destroy=function(b){var c,d,e,f,g,h,i,j=a[b];if(void 0===j)return void console.log("Element id '"+b+"' is not a WUI_ToolBar, destroying aborted.");for(c=j.toolbar,d=j.tools,c.parentElement.removeChild(c),i=0;d.length>i;i+=1)e=d[i],"dropdown"===e.type&&(f=e.items,f.length>0&&(g=f[0],h=g.element,h.parentElement.removeChild(h)));delete a[b]}};