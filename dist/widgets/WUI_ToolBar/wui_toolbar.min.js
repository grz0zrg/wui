var WUI_ToolBar=new function(){var a={},b={minimize_icon:"wui-toolbar-minimize-icon",maximize_icon:"wui-toolbar-maximize-icon",button:"wui-toolbar-button",minimize_group:"wui-toolbar-minimize-group",minimize_gr_v:"wui-toolbar-minimize-group-vertical",toggle:"wui-toolbar-toggle",toggle_on:"wui-toolbar-toggle-on",item:"wui-toolbar-item",dd_content:"wui-toolbar-dropdown-content",dd_item:"wui-toolbar-dropdown-item",dd_open:"wui-toolbar-dropdown-open"},c={item_hmargin:3,icon_width:32,icon_height:32,allow_groups_minimize:!1,vertical:!1,use_event_listener:!0},d=function(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:Math.round(i),left:Math.round(j)}},e=function(c,d){return void 0!==d?a[d]:c.classList.contains(b.minimize_icon)||c.classList.contains(b.maximize_icon)?a[c.parentElement.id]:a[c.parentElement.parentElement.id]},f=function(a,b,c){if(void 0!==a.on_click&&null!==a.on_click){var d={type:b};void 0!==c&&(d.state=c),a.on_click(d)}},g=function(a,c,d){var g,h=a.target,i=null,j=!1,k=0;i=e(h,c);var l=i.tools[h.dataset.tool_id];if("1"===l.element.dataset.on?(l.element.dataset.on=0,l.element.title=l.tooltip,void 0!==l.icon&&(l.element.classList.add(l.icon),l.element.classList.remove(l.toggled_icon))):(l.element.dataset.on=1,void 0!==l.tooltip_toggled&&(l.element.title=l.tooltip_toggled),void 0!==l.toggled_icon&&(l.element.classList.add(l.toggled_icon),l.element.classList.remove(l.icon)),j=!0),"none"!==l.toggled_style&&l.element.classList.toggle(b.toggle_on),g=h.dataset.toggle_group,void 0!==g)for(k=0;i.tools.length>k;k+=1){var m=i.tools[k];if(g===m.element.dataset.toggle_group&&m.element!==h){if("0"===m.element.dataset.on)continue;m.element.dataset.on="0",m.element.classList.remove(b.toggle_on),void 0!==m.toggled_icon&&m.element.classList.remove(m.toggled_icon),void 0!==m.icon&&m.element.classList.add(m.icon),d&&f(m,"toggle",!1)}}d&&f(l,"toggle",j)},h=function(c){c.preventDefault&&c.preventDefault();var d=c.target,e=d.parentElement,f=a[e.dataset.linkedto_tb],g=f.tools[parseInt(e.dataset.linkedto_tool_index,10)],h=parseInt(d.dataset.index,10),i=g.items[h];void 0!==i.on_click&&(i.on_click(),g.element.classList.remove(b.toggle_on),e.classList.remove(b.dd_open))},i=function(a,c){c.classList.remove(b.dd_open),a.element.classList.remove(b.toggle_on)},j=function(a,b){var c=function(){i(a,b),window.removeEventListener("click",c)};return c},k=function(a,c){a.preventDefault&&a.preventDefault();var g=a.target,h=null,k=null,l=null,m=null;if(m=e(g,c),h=m.tools[g.dataset.tool_id],"dropdown"===h.type){if(k=h.floating_content,g.classList.contains(b.toggle_on))return void i(h,k);var n=h.element;n.classList.add(b.toggle_on),l=d(g),"tb_item"===h.dd_items_width&&(k.style.width=g.offsetWidth+"px"),"s"===h.orientation?(k.style.top=l.top+g.offsetHeight+"px",k.style.left=l.left+"px"):"sw"===h.orientation?(k.style.top=l.top+g.offsetHeight+"px",k.style.left=l.left-k.offsetWidth+"px"):"nw"===h.orientation?(k.style.top=l.top-k.offsetHeight+g.offsetHeight+"px",k.style.left=l.left-k.offsetWidth+"px"):"se"===h.orientation?(k.style.top=l.top+g.offsetHeight+"px",k.style.left=l.left+g.offsetWidth+"px"):"ne"===h.orientation?(k.style.top=l.top-k.offsetHeight+g.offsetHeight+"px",k.style.left=l.left+g.offsetWidth+"px"):(k.style.top=l.top-k.offsetHeight+"px",k.style.left=l.left+"px"),k.classList.add(b.dd_open),a.stopPropagation&&a.stopPropagation(),window.addEventListener("click",j(h,k),!1)}else f(h,"click")},l=function(a){a.preventDefault&&a.preventDefault();var c,d=a.target,f=d.nextSibling,g=f.getElementsByTagName("div"),h=null,i=null;if(h=e(d),d.classList.contains(b.minimize_icon))for(d.classList.add(b.maximize_icon),d.classList.remove(b.minimize_icon),d.title="Maximize group",f.style.width="0",f.style.height="0",c=0;g.length>c;c+=1)i=g[c],i.style.minWidth="0",i.style.minHeight="0";else for(d.classList.add(b.minimize_icon),d.classList.remove(b.maximize_icon),d.title="Minimize group",f.style.width="auto",f.style.height="auto",c=0;g.length>c;c+=1)i=g[c],i.style.minWidth=h.opts.icon_width+"px",i.style.minHeight=h.opts.icon_height+"px"};this.triggerEvent=function(a,c){var d=a.target,e=a.type;if(void 0!==c&&(e=c),"click"===e){if(d.classList.contains(b.dd_item))return h({target:d}),!0;if(d.classList.contains(b.toggle))return g({target:d},void 0,!0),!0;if(d.classList.contains(b.minimize_group)||d.classList.contains(b.minimize_gr_v))return l({target:d}),!0;if(d.classList.contains(b.button))return k(a),!0}return!1},this.create=function(d,e,f){var i,j=document.getElementById(d),m=null,n=null,o=null,p=null,q={};if(void 0!==a[d])return void console.log("WUI_Toolbar id '"+d+"' already created, aborting.");for(i in c)c.hasOwnProperty(i)&&(q[i]=c[i]);if(void 0!==f)for(i in f)f.hasOwnProperty(i)&&void 0!==c[i]&&(q[i]=f[i]);a[d]={tools:[],opts:q},j.classList.add("wui-toolbar");var r="wui-toolbar-group",s=b.item,t="wui-toolbar-spacer",u=b.minimize_group;q.vertical?(j.classList.add("wui-toolbar-vertical"),r="wui-toolbar-group-vertical",s+=" wui-toolbar-item-vertical",t="wui-toolbar-spacer-vertical",u=b.minimize_gr_v,j.style.maxWidth=q.icon_width+4+"px"):j.style.maxHeight=q.icon_height+4+"px",u=b.button+" "+b.minimize_icon+" "+u;for(o in e)if(e.hasOwnProperty(o)){null!==p&&(n=document.createElement("div"),n.className=t,j.appendChild(n)),q.allow_groups_minimize&&(n=document.createElement("div"),n.className=u,n.title="Minimize group",j.appendChild(n),q.use_event_listener&&n.addEventListener("click",l,!1)),m=e[o];var v=document.createElement("div");v.className=r,q.vertical?v.style.maxWidth=q.icon_width+"px":v.style.maxHeight=q.icon_height+"px";for(var w=0;m.length>w;w+=1){var x,y=m[w],z=document.createElement("div"),A={element:z,on_click:y.on_click,icon:y.icon,items:[],tooltip:"",type:y.type,dd_items_width:y.dropdown_items_width,orientation:y.orientation},B=a[d].tools.length;if(z.className=s,z.style.minWidth=q.icon_width+"px",z.style.minHeight=q.icon_height+"px",z.style.marginLeft=q.item_hmargin+"px",z.style.marginRight=q.item_hmargin+"px",z.style.backgroundSize=q.icon_width-4+"px "+(q.icon_height-4)+"px",v.appendChild(z),a[d].tools.push(A),z.dataset.tool_id=B,A.tooltip=y.tooltip,void 0!==y.tooltip&&(z.title=y.tooltip),void 0!==y.text&&(z.innerHTML=y.text,z.style.lineHeight=q.icon_height+"px",z.classList.add("wui-toolbar-text"),void 0!==y.icon&&(z.style.paddingLeft=q.icon_width+2+"px",z.style.backgroundPosition="left center")),void 0!==y.icon&&z.classList.add(y.icon),"toggle"===y.type)z.classList.add(b.toggle),A.toggled_icon=y.toggled_icon,A.tooltip_toggled=y.tooltip_toggled,A.toggled_style=y.toggled_style,void 0!==y.toggle_group&&(z.dataset.toggle_group=y.toggle_group),y.toggle_state&&(z.dataset.on="0",g({target:z},d,!0)),q.use_event_listener&&z.addEventListener("click",g,!1);else if("dropdown"===y.type){z.classList.add(b.button);var C=document.createElement("div");if(void 0!==y.items)for(x=0;y.items.length>x;x+=1){var D=y.items[x],E=document.createElement("div");y.vertical||E.classList.add("wui-toolbar-dropdown-horizontal"),E.classList.add(b.dd_item),E.innerHTML=D.title,E.dataset.index=x,C.appendChild(E),A.items.push({element:E,on_click:D.on_click}),q.use_event_listener&&E.addEventListener("click",h,!1)}A.floating_content=C,C.style.width=A.dd_items_width+"px",C.classList.add(b.dd_content),C.dataset.linkedto_tb=d,C.dataset.linkedto_tool_index=B,document.body.appendChild(C),q.use_event_listener&&z.addEventListener("click",k,!1)}else z.classList.add(b.button),q.use_event_listener&&z.addEventListener("click",k,!1)}j.appendChild(v),p=m}return d},this.toggle=function(b,c,d){var e=a[b];return void 0===e?void("undefined"!=typeof console&&console.log('Cannot toggle, WUI toolbar "'+b+'" was not created.')):void g({target:e.tools[c].element},b,d)},this.getItemElement=function(b,c){var d=a[b];return void 0===d?void("undefined"!=typeof console&&console.log('getItemElement problem, WUI toolbar "'+b+'" was not created.')):d.tools[c].element}};
