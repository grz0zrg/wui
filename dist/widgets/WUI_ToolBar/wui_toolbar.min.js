var WUI_ToolBar=new function(){"use strict";var a={},b={minimize_icon:"wui-toolbar-minimize-icon",maximize_icon:"wui-toolbar-maximize-icon",button:"wui-toolbar-button",minimize_group:"wui-toolbar-minimize-group",minimize_gr_v:"wui-toolbar-minimize-group-vertical",toggle:"wui-toolbar-toggle",toggle_on:"wui-toolbar-toggle-on",item:"wui-toolbar-item",group:"wui-toolbar-group",vertical_group:"wui-toolbar-group-vertical",tb:"wui-toolbar",dd_content:"wui-toolbar-dropdown-content",dd_item:"wui-toolbar-dropdown-item",dd_open:"wui-toolbar-dropdown-open"},c={item_hmargin:null,item_vmargin:null,item_width:32,item_height:32,icon_width:32,icon_height:32,allow_groups_minimize:!1,vertical:!1},d=function(b){var c=a[b];return void 0===c?("undefined"!=typeof console&&console.log('_getWidget failed, the element id "'+b+'" is not a WUI_ToolBar.'),null):c},e=function(a){var b=a.ownerDocument,c=a.getBoundingClientRect(),d=b.body,e=b.documentElement,f=b.defaultView||b.parentWindow,g=f.pageYOffset||e.scrollTop||d.scrollTop,h=f.pageXOffset||e.scrollLeft||d.scrollLeft,i=e.clientTop||d.clientTop||0,j=e.clientLeft||d.clientLeft||0,k=c.top+g-i,l=c.left+h-j;return{top:Math.round(k),left:Math.round(l)}},f=function(c,d){return void 0!==d?a[d]:c.classList.contains(b.tb)?a[c.id]:c.classList.contains(b.minimize_icon)||c.classList.contains(b.maximize_icon)||c.classList.contains(b.vertical_group)||c.classList.contains(b.group)?a[c.parentElement.id]:a[c.parentElement.parentElement.id]},g=function(a,b,c){if(void 0!==a.on_click&&null!==a.on_click){var d={id:a.id,type:b};void 0!==c&&(d.state=c),a.on_click(d)}},h=function(a,c,d){var e,f=a.createElement("div");if(void 0!==c.items)for(e=0;e<c.items.length;e+=1){var g=c.items[e],h=a.createElement("div");c.vertical||h.classList.add("wui-toolbar-dropdown-horizontal"),h.classList.add(b.dd_item),h.innerHTML=g.title,h.dataset.index=e,f.appendChild(h)}return f.addEventListener("click",j,!1),f.style.width=d.dd_items_width+"px",f.classList.add(b.dd_content),f.dataset.linkedto_tb=d.element.id,f.dataset.linkedto_tool_index=c.id,a.body.appendChild(f),f},i=function(a,c,d){var e,h,i,j=null,k=!1,l=0;j=f(a,c),h=j.element,a.parentElement&&a.parentElement.parentElement&&(h=a.parentElement.parentElement);var m=j.tools[parseInt(a.dataset.tool_id,10)];if("1"===m.element.dataset.on?(m.element.dataset.on=0,a.dataset.on=0,m.element.title=m.tooltip,a.title=m.tooltip,void 0!==m.icon&&(m.element.classList.add(m.icon),m.element.classList.remove(m.toggled_icon),a.classList.add(m.icon),a.classList.remove(m.toggled_icon))):(m.element.dataset.on=1,a.dataset.on=1,void 0!==m.tooltip_toggled&&(m.element.title=m.tooltip_toggled,a.title=m.tooltip_toggled),void 0!==m.toggled_icon&&(m.element.classList.add(m.toggled_icon),m.element.classList.remove(m.icon),a.classList.add(m.toggled_icon),a.classList.remove(m.icon)),k=!0),"none"!==m.toggled_style&&(a.classList.contains(b.toggle_on)?(m.element.classList.remove(b.toggle_on),a.classList.remove(b.toggle_on)):(m.element.classList.add(b.toggle_on),a.classList.add(b.toggle_on))),e=a.dataset.toggle_group,void 0!==e)for(i=h.getElementsByClassName(b.item),l=0;l<i.length;l+=1){var n=i[l],o=j.tools[parseInt(n.dataset.tool_id,10)];if(e===n.dataset.toggle_group&&n.dataset.tool_id!==a.dataset.tool_id){if("0"===n.dataset.on)continue;n.dataset.on="0",o.element.dataset.on="0",n.classList.remove(b.toggle_on),o.element.classList.remove(b.toggle_on),void 0!==m.toggled_icon&&(n.classList.remove(o.toggled_icon),o.element.classList.remove(o.toggled_icon)),void 0!==m.icon&&(n.classList.add(o.icon),o.element.classList.add(o.icon)),(d||void 0===d)&&g(o,"toggle",!1)}}d!==!0&&void 0!==d||g(m,"toggle",k)},j=function(c){c.preventDefault(),c.stopPropagation();var d=c.target,e=d.ownerDocument,f=d.parentElement,g=a[f.dataset.linkedto_tb],h=parseInt(f.dataset.linkedto_tool_index,10),i=g.tools[h],j=parseInt(d.dataset.index,10),l=i.items[j],m=e.getElementById(f.dataset.linkedto_tb),n=m.getElementsByClassName(b.item),o=n[h];void 0!==l.on_click&&(l.on_click(),o.classList.remove(b.toggle_on),i.element.classList.remove(b.toggle_on),k(i,o))},k=function(a,c){var d,e,f=c.ownerDocument,g=f.body.getElementsByClassName(b.dd_content);for(e=0;e<g.length;e+=1)d=g[e],d.removeEventListener("click",j,!1),d.parentElement.removeChild(d);a.element.classList.remove(b.toggle_on),c.classList.remove(b.toggle_on)},l=function(a,b){var c=function(){var d=b.ownerDocument,e=d.defaultView||d.parentWindow;k(a,b),e.removeEventListener("click",c)};return c},m=function(a){a.preventDefault(),a.stopPropagation();var c=a.target;if(c.classList.contains(b.minimize_group)||c.classList.contains(b.minimize_gr_v))return void n(c);if(c.classList.contains(b.toggle))return void i(c);if(!(c.classList.contains(b.tb)||c.classList.contains(b.group)||c.classList.contains(b.vertical_group))){var d=null,j=null,m=null,o=null,p=c.ownerDocument,q=p.defaultView||p.parentWindow;if(o=f(c),d=o.tools[c.dataset.tool_id],"dropdown"===d.type){if(c.classList.contains(b.toggle_on))return void k(d,c);j=h(p,d,o);var r=d.element;c.classList.add(b.toggle_on),r.classList.add(b.toggle_on),m=e(c),"tb_item"===d.dd_items_width&&(j.style.width=c.offsetWidth+"px"),"s"===d.orientation?(j.style.top=m.top+c.offsetHeight+"px",j.style.left=m.left+"px"):"sw"===d.orientation?(j.style.top=m.top+c.offsetHeight+"px",j.style.left=m.left-j.offsetWidth+"px"):"nw"===d.orientation?(j.style.top=m.top-j.offsetHeight+c.offsetHeight+"px",j.style.left=m.left-j.offsetWidth+"px"):"se"===d.orientation?(j.style.top=m.top+c.offsetHeight+"px",j.style.left=m.left+c.offsetWidth+"px"):"ne"===d.orientation?(j.style.top=m.top-j.offsetHeight+c.offsetHeight+"px",j.style.left=m.left+c.offsetWidth+"px"):(j.style.top=m.top-j.offsetHeight+"px",j.style.left=m.left+"px"),j.classList.add(b.dd_open),a.stopPropagation&&a.stopPropagation(),q.addEventListener("click",l(d,c),!1)}else g(d,"click")}},n=function(a){var c=a.nextSibling;a.classList.contains(b.minimize_icon)?(a.classList.add(b.maximize_icon),a.classList.remove(b.minimize_icon),a.title="Maximize group",c.style.display="none"):(a.classList.add(b.minimize_icon),a.classList.remove(b.maximize_icon),a.title="Minimize group",c.style.display="")},o=function(){console.log("WUI_RangeSlider 'create' failed, first argument not an id nor a DOM element.")};this.create=function(d,e,g){var h,j,k=null,l=null,n=null,p=null,q={};if("string"==typeof d)h=document.getElementById(d);else{if("object"!=typeof d)return void o();if("string"!=typeof d.innerHTML)return void o();h=d,d=h.id}if(void 0!==a[d])return void console.log("WUI_Toolbar id '"+d+"' already created, aborting.");for(j in c)c.hasOwnProperty(j)&&(q[j]=c[j]);if(void 0!==e)for(j in e)e.hasOwnProperty(j)&&void 0!==c[j]&&(q[j]=e[j]);a[d]={element:h,tools:[],opts:q},h.classList.add(b.tb);var r=b.group,s=b.item,t="wui-toolbar-spacer",u=b.minimize_group;q.vertical?(h.classList.add("wui-toolbar-vertical"),r=b.vertical_group,s+=" wui-toolbar-item-vertical",t="wui-toolbar-spacer-vertical",u=b.minimize_gr_v,h.style.maxWidth=q.item_width+4+"px",null===q.item_hmargin&&(q.item_hmargin=3),null===q.item_vmargin&&(q.item_vmargin=8)):(h.style.maxHeight=q.item_height+4+"px",null===q.item_hmargin&&(q.item_hmargin=3),null===q.item_vmargin&&(q.item_vmargin=0)),u=b.button+" "+b.minimize_icon+" "+u,h.addEventListener("click",m,!1);var v;for(n in g)if(g.hasOwnProperty(n)){null!==p&&(l=document.createElement("div"),l.className=t,h.appendChild(l)),q.allow_groups_minimize&&(l=document.createElement("div"),l.className=u,l.title="Minimize group",h.appendChild(l)),k=g[n];var w=document.createElement("div");for(w.className=r,q.vertical?w.style.maxWidth=q.item_width+"px":w.style.maxHeight=q.item_height+"px",v=0;v<k.length;v+=1){var x,y=k[v],z=document.createElement("div"),A=a[d].tools.length,B={element:z,on_click:y.on_click,on_rclick:y.on_rclick,icon:y.icon,items:[],tooltip:"",type:y.type,dd_items_width:y.dropdown_items_width,orientation:y.orientation,id:A};if(B.on_rclick&&z.addEventListener("contextmenu",function(a){var b=f(a.target),c=b.tools[a.target.dataset.tool_id];a.preventDefault(),c.on_rclick()}),z.className=s,z.style.minWidth=q.item_width+"px",z.style.minHeight=q.item_height+"px",z.style.marginLeft=q.item_hmargin+"px",z.style.marginRight=q.item_hmargin+"px",z.style.marginTop=q.item_vmargin+"px",z.style.marginBottom=q.item_vmargin+"px",z.style.backgroundSize=q.icon_width-4+"px "+(q.icon_height-4)+"px",w.appendChild(z),a[d].tools.push(B),z.dataset.tool_id=A,B.tooltip=y.tooltip,void 0!==y.tooltip&&(z.title=y.tooltip),void 0!==y.text&&(z.innerHTML=y.text,z.style.lineHeight=q.item_height+"px",z.classList.add("wui-toolbar-text"),void 0!==y.icon&&(z.style.paddingLeft=q.icon_width+2+"px",z.style.backgroundPosition="left center")),void 0!==y.icon&&z.classList.add(y.icon),"toggle"===y.type)z.classList.add(b.toggle),B.toggled_icon=y.toggled_icon,B.tooltip_toggled=y.tooltip_toggled,B.toggled_style=y.toggled_style,void 0!==y.toggle_group&&(z.dataset.toggle_group=y.toggle_group),y.toggle_state&&(z.dataset.on="1");else if("dropdown"===y.type){if(z.classList.add(b.button),void 0!==y.items)for(x=0;x<y.items.length;x+=1){var C=y.items[x];B.items.push({title:C.title,on_click:C.on_click})}}else z.classList.add(b.button)}h.appendChild(w),p=k}var D=h.getElementsByClassName(b.item);for(v=0;v<D.length;v+=1){var E=D[v];"1"===E.dataset.on&&(E.dataset.on="0",i(E,d,!0))}return d},this.hideGroup=function(a,c){var e,f,g,h=d(a);if(h){if(e=h.element.getElementsByClassName(h.opts.vertical?b.vertical_group:b.group),0===e.length)return;f=e[c],g=f.previousElementSibling,(g.classList.contains(b.minimize_group)||g.classList.contains(b.minimize_gr_v))&&(g.style.display="none"),f.style.display="none"}},this.showGroup=function(a,c){var e,f,g,h=d(a);if(h){if(e=h.element.getElementsByClassName(h.opts.vertical?b.vertical_group:b.group),0===e.length)return;f=e[c],g=f.previousElementSibling,(g.classList.contains(b.minimize_group)||g.classList.contains(b.minimize_gr_v))&&(g.style.display=""),e[c].style.display=""}},this.toggle=function(a,b,c){var e=d(a);e&&i(e.tools[b].element,a,c)},this.getItemElement=function(a,b){var c=d(a);if(c)return c.tools[b].element},this.destroy=function(b){var c,d,e,f,g,h,i,j=a[b];if(void 0===j)return void console.log("Element id '"+b+"' is not a WUI_ToolBar, destroying aborted.");for(c=j.toolbar,d=j.tools,c.parentElement.removeChild(c),i=0;i<d.length;i+=1)e=d[i],"dropdown"===e.type&&(f=e.items,f.length>0&&(g=f[0],h=g.element,h.parentElement.removeChild(h)));delete a[b]}};