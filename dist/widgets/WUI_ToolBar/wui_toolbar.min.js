var WUI_ToolBar=new function(){"use strict";var a={},b={minimize_icon:"wui-toolbar-minimize-icon",maximize_icon:"wui-toolbar-maximize-icon",button:"wui-toolbar-button",minimize_group:"wui-toolbar-minimize-group",minimize_gr_v:"wui-toolbar-minimize-group-vertical",toggle:"wui-toolbar-toggle",toggle_on:"wui-toolbar-toggle-on",item:"wui-toolbar-item",group:"wui-toolbar-group",vertical_group:"wui-toolbar-group-vertical",group_title:"wui-toolbar-group-title",group_title_vertical:"wui-toolbar-group-title-vertical",group_title_vertical_s:"wui-toolbar-group-title-vertical-s",tb:"wui-toolbar",dd_content:"wui-toolbar-dropdown-content",dd_item:"wui-toolbar-dropdown-item",dd_open:"wui-toolbar-dropdown-open"},c={item_hmargin:null,item_vmargin:null,item_width:32,item_height:32,icon_width:32,icon_height:32,show_groups_title:!1,groups_title_orientation:"s",allow_groups_minimize:!1,vertical:!1},d=function(a){window.WUI_Reporting&&"undefined"!=typeof console&&console.log(a)},e=function(b){var c=a[b];return void 0===c?(d('_getWidget failed, the element id "'+b+'" is not a WUI_ToolBar.'),null):c},f=function(a){var b=a.ownerDocument,c=a.getBoundingClientRect(),d=b.body,e=b.documentElement,f=b.defaultView||b.parentWindow,g=f.pageYOffset||e.scrollTop||d.scrollTop,h=f.pageXOffset||e.scrollLeft||d.scrollLeft,i=e.clientTop||d.clientTop||0,j=e.clientLeft||d.clientLeft||0,k=c.top+g-i,l=c.left+h-j;return{top:Math.round(k),left:Math.round(l)}},g=function(c,d){return void 0!==d?a[d]:c.classList.contains(b.tb)?a[c.id]:c.classList.contains(b.minimize_icon)||c.classList.contains(b.maximize_icon)||c.classList.contains(b.vertical_group)||c.classList.contains(b.group)?a[c.parentElement.id]:a[c.parentElement.parentElement.id]},h=function(a,b,c){if(a&&void 0!==a.on_click&&null!==a.on_click){var d={id:a.id,type:b};void 0!==c&&(d.state=c),a.on_click(d)}},i=function(a,c,d){var e,f=a.createElement("div");if(void 0!==c.items)for(e=0;e<c.items.length;e+=1){var g=c.items[e],h=a.createElement("div");c.vertical||h.classList.add("wui-toolbar-dropdown-horizontal"),h.classList.add(b.dd_item),h.innerHTML=g.title,h.dataset.index=e,f.appendChild(h)}return f.addEventListener("click",k,!1),f.style.width=d.dd_items_width+"px",f.classList.add(b.dd_content),f.dataset.linkedto_tb=d.element.id,f.dataset.linkedto_tool_index=c.id,a.body.appendChild(f),f},j=function(a,c,d){var e,f,i,j=null,k=!1,l=0;j=g(a,c),f=j.element,a.parentElement&&a.parentElement.parentElement&&(f=a.parentElement.parentElement);var m=j.tools[parseInt(a.dataset.tool_id,10)];if("1"===m.element.dataset.on?(m.element.dataset.on=0,a.dataset.on=0,m.element.title=m.tooltip,a.title=m.tooltip,void 0!==m.icon&&(m.element.classList.add(m.icon),m.element.classList.remove(m.toggled_icon),a.classList.add(m.icon),a.classList.remove(m.toggled_icon))):(m.element.dataset.on=1,a.dataset.on=1,void 0!==m.tooltip_toggled&&(m.element.title=m.tooltip_toggled,a.title=m.tooltip_toggled),void 0!==m.toggled_icon&&(m.element.classList.add(m.toggled_icon),m.element.classList.remove(m.icon),a.classList.add(m.toggled_icon),a.classList.remove(m.icon)),k=!0),"none"!==m.toggled_style&&(a.classList.contains(b.toggle_on)?(m.element.classList.remove(b.toggle_on),a.classList.remove(b.toggle_on)):(m.element.classList.add(b.toggle_on),a.classList.add(b.toggle_on))),e=a.dataset.toggle_group,void 0!==e)for(i=f.getElementsByClassName(b.item),l=0;l<i.length;l+=1){var n=i[l],o=j.tools[parseInt(n.dataset.tool_id,10)];if(e===n.dataset.toggle_group&&n.dataset.tool_id!==a.dataset.tool_id){if("0"===n.dataset.on)continue;n.dataset.on="0",o.element.dataset.on="0",n.classList.remove(b.toggle_on),o.element.classList.remove(b.toggle_on),void 0!==m.toggled_icon&&(n.classList.remove(o.toggled_icon),o.element.classList.remove(o.toggled_icon)),void 0!==m.icon&&(n.classList.add(o.icon),o.element.classList.add(o.icon)),(d||void 0===d)&&h(o,"toggle",!1)}}d!==!0&&void 0!==d||h(m,"toggle",k)},k=function(c){c.preventDefault(),c.stopPropagation();var d=c.target,e=d.ownerDocument,f=d.parentElement,g=a[f.dataset.linkedto_tb],h=parseInt(f.dataset.linkedto_tool_index,10),i=g.tools[h],j=parseInt(d.dataset.index,10),k=i.items[j],m=e.getElementById(f.dataset.linkedto_tb),n=m.getElementsByClassName(b.item),o=n[h];void 0!==k.on_click&&(k.on_click(),o.classList.remove(b.toggle_on),i.element.classList.remove(b.toggle_on),l(i,o))},l=function(a,c){var d,e,f=c.ownerDocument,g=f.body.getElementsByClassName(b.dd_content);for(e=0;e<g.length;e+=1)d=g[e],d.removeEventListener("click",k,!1),d.parentElement.removeChild(d);a.element.classList.remove(b.toggle_on),c.classList.remove(b.toggle_on)},m=function(a,b){var c=function(){var d=b.ownerDocument,e=d.defaultView||d.parentWindow;l(a,b),e.removeEventListener("click",c)};return c},n=function(a){a.preventDefault(),a.stopPropagation();var c=a.target;if(c.classList.contains(b.minimize_group)||c.classList.contains(b.minimize_gr_v))return void o(c);if(c.classList.contains(b.toggle))return void j(c);if(!(c.classList.contains(b.tb)||c.classList.contains(b.group)||c.classList.contains(b.vertical_group))){var d=null,e=null,k=null,n=null,p=c.ownerDocument,q=p.defaultView||p.parentWindow;if(n=g(c),d=n.tools[c.dataset.tool_id],d&&"dropdown"===d.type){if(c.classList.contains(b.toggle_on))return void l(d,c);e=i(p,d,n);var r=d.element;c.classList.add(b.toggle_on),r.classList.add(b.toggle_on),k=f(c),"tb_item"===d.dd_items_width&&(e.style.width=c.offsetWidth+"px"),"s"===d.orientation?(e.style.top=k.top+c.offsetHeight+"px",e.style.left=k.left+"px"):"sw"===d.orientation?(e.style.top=k.top+c.offsetHeight+"px",e.style.left=k.left-e.offsetWidth+"px"):"nw"===d.orientation?(e.style.top=k.top-e.offsetHeight+c.offsetHeight+"px",e.style.left=k.left-e.offsetWidth+"px"):"se"===d.orientation?(e.style.top=k.top+c.offsetHeight+"px",e.style.left=k.left+c.offsetWidth+"px"):"ne"===d.orientation?(e.style.top=k.top-e.offsetHeight+c.offsetHeight+"px",e.style.left=k.left+c.offsetWidth+"px"):(e.style.top=k.top-e.offsetHeight+"px",e.style.left=k.left+"px"),e.classList.add(b.dd_open),a.stopPropagation&&a.stopPropagation(),q.addEventListener("click",m(d,c),!1)}else h(d,"click")}},o=function(a){var c=a.nextSibling;a.classList.contains(b.minimize_icon)?(a.classList.add(b.maximize_icon),a.classList.remove(b.minimize_icon),a.title="Maximize group",c.style.display="none"):(a.classList.add(b.minimize_icon),a.classList.remove(b.maximize_icon),a.title="Minimize group",c.style.display="")},p=function(){d("WUI_RangeSlider 'create' failed, first argument not an id nor a DOM element.")};this.create=function(e,f,h){var i,k,l=null,m=null,o=null,q=null,r={};if("string"==typeof e)i=document.getElementById(e);else{if("object"!=typeof e)return void p();if("string"!=typeof e.innerHTML)return void p();i=e,e=i.id}if(void 0!==a[e])return void d("WUI_Toolbar id '"+e+"' already created, aborting.");for(k in c)c.hasOwnProperty(k)&&(r[k]=c[k]);if(void 0!==f)for(k in f)f.hasOwnProperty(k)&&void 0!==c[k]&&(r[k]=f[k]);a[e]={element:i,tools:[],opts:r},i.classList.add(b.tb);var s=b.group,t=b.item,u="wui-toolbar-spacer",v=b.minimize_group;r.vertical?(i.classList.add("wui-toolbar-vertical"),s=b.vertical_group,t+=" wui-toolbar-item-vertical",u="wui-toolbar-spacer-vertical",v=b.minimize_gr_v,i.style.maxWidth=r.item_width+4+"px",null===r.item_hmargin&&(r.item_hmargin=3),null===r.item_vmargin&&(r.item_vmargin=8)):(i.style.maxHeight=r.item_height+4+"px",null===r.item_hmargin&&(r.item_hmargin=3),null===r.item_vmargin&&(r.item_vmargin=0)),v=b.button+" "+b.minimize_icon+" "+v,i.addEventListener("click",n,!1);var w;for(o in h)if(h.hasOwnProperty(o)){null!==q&&(m=document.createElement("div"),m.className=u,i.appendChild(m)),r.allow_groups_minimize&&(m=document.createElement("div"),m.className=v,m.title="Minimize group",i.appendChild(m)),l=h[o];var x=document.createElement("div");for(x.className=s,r.vertical?x.style.maxWidth=r.item_width+"px":x.style.maxHeight=r.item_height+"px",w=0;w<l.length;w+=1){var y,z=l[w],A=document.createElement("div"),B=a[e].tools.length,C={element:A,on_click:z.on_click,on_rclick:z.on_rclick,icon:z.icon,items:[],tooltip:"",type:z.type,dd_items_width:z.dropdown_items_width,orientation:z.orientation,id:B};if(C.on_rclick&&A.addEventListener("contextmenu",function(a){var b=g(a.target),c=b.tools[a.target.dataset.tool_id];a.preventDefault(),c.on_rclick()}),A.className=t,A.style.minWidth=r.item_width+"px",A.style.minHeight=r.item_height+"px",A.style.marginLeft=r.item_hmargin+"px",A.style.marginRight=r.item_hmargin+"px",A.style.marginTop=r.item_vmargin+"px",A.style.marginBottom=r.item_vmargin+"px",A.style.backgroundSize=r.icon_width-4+"px "+(r.icon_height-4)+"px",x.appendChild(A),a[e].tools.push(C),A.dataset.tool_id=B,C.tooltip=z.tooltip,void 0!==z.tooltip&&(A.title=z.tooltip),void 0!==z.text&&(A.innerHTML=z.text,A.style.lineHeight=r.item_height+"px",A.classList.add("wui-toolbar-text"),void 0!==z.icon&&(A.style.paddingLeft=r.icon_width+2+"px",A.style.backgroundPosition="left center")),void 0!==z.icon&&A.classList.add(z.icon),void 0!==z.id&&(A.id=z.id),"toggle"===z.type)A.classList.add(b.toggle),C.toggled_icon=z.toggled_icon,C.tooltip_toggled=z.tooltip_toggled,C.toggled_style=z.toggled_style,void 0!==z.toggle_group&&(A.dataset.toggle_group=z.toggle_group),z.toggle_state&&(A.dataset.on="1");else if("dropdown"===z.type){if(A.classList.add(b.button),void 0!==z.items)for(y=0;y<z.items.length;y+=1){var D=z.items[y];C.items.push({title:D.title,on_click:D.on_click})}}else A.classList.add(b.button)}if(r.show_groups_title){var E=document.createElement("div");E.classList.add(r.vertical?b.group_title_vertical:b.group_title),E.innerHTML=o,"s"===r.groups_title_orientation?(x.appendChild(E),E.classList.add(b.group_title_vertical_s)):x.insertBefore(E,x.firstChild)}i.appendChild(x),q=l}var F=i.getElementsByClassName(b.item);for(w=0;w<F.length;w+=1){var G=F[w];"1"===G.dataset.on&&(G.dataset.on="0",j(G,e,!0))}return e},this.hideGroup=function(a,c){var d,f,g,h=e(a);if(h){if(d=h.element.getElementsByClassName(h.opts.vertical?b.vertical_group:b.group),0===d.length)return;f=d[c],g=f.previousElementSibling,(g.classList.contains(b.minimize_group)||g.classList.contains(b.minimize_gr_v))&&(g.style.display="none"),f.style.display="none"}},this.showGroup=function(a,c){var d,f,g,h=e(a);if(h){if(d=h.element.getElementsByClassName(h.opts.vertical?b.vertical_group:b.group),0===d.length)return;f=d[c],g=f.previousElementSibling,(g.classList.contains(b.minimize_group)||g.classList.contains(b.minimize_gr_v))&&(g.style.display=""),d[c].style.display=""}},this.toggle=function(a,b,c){var d=e(a);d&&j(d.tools[b].element,a,c)},this.getItemElement=function(a,b){var c=e(a);if(c)return c.tools[b].element},this.destroy=function(b){var c,e,f,g,h,i,j,k=a[b];if(void 0===k)return void d("Element id '"+b+"' is not a WUI_ToolBar, destroying aborted.");for(c=k.toolbar,e=k.tools,c.parentElement.removeChild(c),j=0;j<e.length;j+=1)f=e[j],"dropdown"===f.type&&(g=f.items,g.length>0&&(h=g[0],i=h.element,i.parentElement.removeChild(i)));delete a[b]}};