var WUI_ToolBar=new function(){var a={},b={minimize_icon:"wui-toolbar-minimize-icon",maximize_icon:"wui-toolbar-maximize-icon",button:"wui-toolbar-button",minimize_group:"wui-toolbar-minimize-group",minimize_gr_v:"wui-toolbar-minimize-group-vertical",toggle:"wui-toolbar-toggle",toggle_on:"wui-toolbar-toggle-on",item:"wui-toolbar-item",group:"wui-toolbar-group",vertical_group:"wui-toolbar-group-vertical",dd_content:"wui-toolbar-dropdown-content",dd_item:"wui-toolbar-dropdown-item",dd_open:"wui-toolbar-dropdown-open"},c={item_hmargin:null,item_vmargin:null,item_width:32,item_height:32,icon_width:32,icon_height:32,allow_groups_minimize:!1,vertical:!1},d=function(b){var c=a[b];return void 0===c?("undefined"!=typeof console&&console.log('_getWidget failed, the element id "'+b+'" is not a WUI_ToolBar.'),null):c},e=function(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:Math.round(i),left:Math.round(j)}},f=function(c,d){return void 0!==d?a[d]:c.classList.contains(b.minimize_icon)||c.classList.contains(b.maximize_icon)?a[c.parentElement.id]:a[c.parentElement.parentElement.id]},g=function(a,b,c){if(void 0!==a.on_click&&null!==a.on_click){var d={id:a.id,type:b};void 0!==c&&(d.state=c),a.on_click(d)}},h=function(a,c,d){var e,h=null,i=!1,j=0;h=f(a,c);var k=h.tools[a.dataset.tool_id];if("1"===k.element.dataset.on?(k.element.dataset.on=0,k.element.title=k.tooltip,void 0!==k.icon&&(k.element.classList.add(k.icon),k.element.classList.remove(k.toggled_icon))):(k.element.dataset.on=1,void 0!==k.tooltip_toggled&&(k.element.title=k.tooltip_toggled),void 0!==k.toggled_icon&&(k.element.classList.add(k.toggled_icon),k.element.classList.remove(k.icon)),i=!0),"none"!==k.toggled_style&&k.element.classList.toggle(b.toggle_on),e=a.dataset.toggle_group,void 0!==e)for(j=0;h.tools.length>j;j+=1){var l=h.tools[j];if(e===l.element.dataset.toggle_group&&l.element!==a){if("0"===l.element.dataset.on)continue;l.element.dataset.on="0",l.element.classList.remove(b.toggle_on),void 0!==l.toggled_icon&&l.element.classList.remove(l.toggled_icon),void 0!==l.icon&&l.element.classList.add(l.icon),(d||void 0===d)&&g(l,"toggle",!1)}}(d===!0||void 0===d)&&g(k,"toggle",i)},i=function(c){c.preventDefault(),c.stopPropagation();var d=c.target,e=d.parentElement,f=a[e.dataset.linkedto_tb],g=f.tools[parseInt(e.dataset.linkedto_tool_index,10)],h=parseInt(d.dataset.index,10),i=g.items[h];void 0!==i.on_click&&(i.on_click(),g.element.classList.remove(b.toggle_on),e.classList.remove(b.dd_open))},j=function(a,c){c.classList.remove(b.dd_open),a.element.classList.remove(b.toggle_on)},k=function(a,b){var c=function(){j(a,b),window.removeEventListener("click",c)};return c},l=function(a){a.preventDefault(),a.stopPropagation();var c=a.target;if(c.classList.contains(b.minimize_group)||c.classList.contains(b.minimize_gr_v))return void m(c);if(c.classList.contains(b.toggle))return void h(c);var d=null,i=null,l=null,n=null;if(n=f(c),d=n.tools[c.dataset.tool_id],"dropdown"===d.type){if(i=d.floating_content,c.classList.contains(b.toggle_on))return void j(d,i);var o=d.element;o.classList.add(b.toggle_on),l=e(c),"tb_item"===d.dd_items_width&&(i.style.width=c.offsetWidth+"px"),"s"===d.orientation?(i.style.top=l.top+c.offsetHeight+"px",i.style.left=l.left+"px"):"sw"===d.orientation?(i.style.top=l.top+c.offsetHeight+"px",i.style.left=l.left-i.offsetWidth+"px"):"nw"===d.orientation?(i.style.top=l.top-i.offsetHeight+c.offsetHeight+"px",i.style.left=l.left-i.offsetWidth+"px"):"se"===d.orientation?(i.style.top=l.top+c.offsetHeight+"px",i.style.left=l.left+c.offsetWidth+"px"):"ne"===d.orientation?(i.style.top=l.top-i.offsetHeight+c.offsetHeight+"px",i.style.left=l.left+c.offsetWidth+"px"):(i.style.top=l.top-i.offsetHeight+"px",i.style.left=l.left+"px"),i.classList.add(b.dd_open),a.stopPropagation&&a.stopPropagation(),window.addEventListener("click",k(d,i),!1)}else g(d,"click")},m=function(a){var c=a.nextSibling;a.classList.contains(b.minimize_icon)?(a.classList.add(b.maximize_icon),a.classList.remove(b.minimize_icon),a.title="Maximize group",c.style.display="none"):(a.classList.add(b.minimize_icon),a.classList.remove(b.maximize_icon),a.title="Minimize group",c.style.display="")};this.create=function(d,e,f){var g,j=document.getElementById(d),k=null,m=null,n=null,o=null,p={};if(void 0!==a[d])return void console.log("WUI_Toolbar id '"+d+"' already created, aborting.");for(g in c)c.hasOwnProperty(g)&&(p[g]=c[g]);if(void 0!==f)for(g in f)f.hasOwnProperty(g)&&void 0!==c[g]&&(p[g]=f[g]);a[d]={element:j,tools:[],opts:p},j.classList.add("wui-toolbar");var q=b.group,r=b.item,s="wui-toolbar-spacer",t=b.minimize_group;p.vertical?(j.classList.add("wui-toolbar-vertical"),q=b.vertical_group,r+=" wui-toolbar-item-vertical",s="wui-toolbar-spacer-vertical",t=b.minimize_gr_v,j.style.maxWidth=p.item_width+4+"px",null===p.item_hmargin&&(p.item_hmargin=3),null===p.item_vmargin&&(p.item_vmargin=8)):(j.style.maxHeight=p.item_height+4+"px",null===p.item_hmargin&&(p.item_hmargin=3),null===p.item_vmargin&&(p.item_vmargin=0)),t=b.button+" "+b.minimize_icon+" "+t,j.addEventListener("click",l,!1);for(n in e)if(e.hasOwnProperty(n)){null!==o&&(m=document.createElement("div"),m.className=s,j.appendChild(m)),p.allow_groups_minimize&&(m=document.createElement("div"),m.className=t,m.title="Minimize group",j.appendChild(m)),k=e[n];var u=document.createElement("div");u.className=q,p.vertical?u.style.maxWidth=p.item_width+"px":u.style.maxHeight=p.item_height+"px";for(var v=0;k.length>v;v+=1){var w,x=k[v],y=document.createElement("div"),z=a[d].tools.length,A={element:y,on_click:x.on_click,icon:x.icon,items:[],tooltip:"",type:x.type,dd_items_width:x.dropdown_items_width,orientation:x.orientation,id:z};if(y.className=r,y.style.minWidth=p.item_width+"px",y.style.minHeight=p.item_height+"px",y.style.marginLeft=p.item_hmargin+"px",y.style.marginRight=p.item_hmargin+"px",y.style.marginTop=p.item_vmargin+"px",y.style.marginBottom=p.item_vmargin+"px",y.style.backgroundSize=p.icon_width-4+"px "+(p.icon_height-4)+"px",u.appendChild(y),a[d].tools.push(A),y.dataset.tool_id=z,A.tooltip=x.tooltip,void 0!==x.tooltip&&(y.title=x.tooltip),void 0!==x.text&&(y.innerHTML=x.text,y.style.lineHeight=p.item_height+"px",y.classList.add("wui-toolbar-text"),void 0!==x.icon&&(y.style.paddingLeft=p.icon_width+2+"px",y.style.backgroundPosition="left center")),void 0!==x.icon&&y.classList.add(x.icon),"toggle"===x.type)y.classList.add(b.toggle),A.toggled_icon=x.toggled_icon,A.tooltip_toggled=x.tooltip_toggled,A.toggled_style=x.toggled_style,void 0!==x.toggle_group&&(y.dataset.toggle_group=x.toggle_group),x.toggle_state&&(y.dataset.on="0",h(y,d,!0));else if("dropdown"===x.type){y.classList.add(b.button);var B=document.createElement("div");if(void 0!==x.items)for(w=0;x.items.length>w;w+=1){var C=x.items[w],D=document.createElement("div");x.vertical||D.classList.add("wui-toolbar-dropdown-horizontal"),D.classList.add(b.dd_item),D.innerHTML=C.title,D.dataset.index=w,B.appendChild(D),A.items.push({element:D,on_click:C.on_click})}B.addEventListener("click",i,!1),A.floating_content=B,B.style.width=A.dd_items_width+"px",B.classList.add(b.dd_content),B.dataset.linkedto_tb=d,B.dataset.linkedto_tool_index=z,document.body.appendChild(B)}else y.classList.add(b.button)}j.appendChild(u),o=k}return d},this.hideGroup=function(a,c){var e,f,g,h=d(a);if(h){if(e=h.element.getElementsByClassName(h.opts.vertical?b.vertical_group:b.group),0===e.length)return;f=e[c],g=f.previousElementSibling,(g.classList.contains(b.minimize_group)||g.classList.contains(b.minimize_gr_v))&&(g.style.display="none"),f.style.display="none"}},this.showGroup=function(a,c){var e,f,g,h=d(a);if(h){if(e=h.element.getElementsByClassName(h.opts.vertical?b.vertical_group:b.group),0===e.length)return;f=e[c],g=f.previousElementSibling,(g.classList.contains(b.minimize_group)||g.classList.contains(b.minimize_gr_v))&&(g.style.display=""),e[c].style.display=""}},this.toggle=function(a,b,c){var e=d(a);e&&h(e.tools[b].element,a,c)},this.getItemElement=function(a,b){var c=d(a);return c?c.tools[b].element:void 0},this.destroy=function(b){var c,d,e,f,g,h,i,j=a[b];if(void 0===j)return void console.log("Element id '"+b+"' is not a WUI_ToolBar, destroying aborted.");for(c=j.toolbar,d=j.tools,c.parentElement.removeChild(c),i=0;d.length>i;i+=1)e=d[i],"dropdown"===e.type&&(f=e.items,f.length>0&&(g=f[0],h=g.element,h.parentElement.removeChild(h)));delete a[b]}};
