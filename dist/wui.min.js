var WUI_Dialog=new function(){var a={},b=null,c=null,d=0,e=0,f=null,g={dialog:"wui-dialog",content:"wui-dialog-content",btn:"wui-dialog-btn",btn_close:"wui-dialog-close",minimize:"wui-dialog-minimize",maximize:"wui-dialog-maximize",header:"wui-dialog-header",open:"wui-dialog-open",closed:"wui-dialog-closed",draggable:"wui-dialog-draggable"},h={title:"",width:"80%",height:"40%",open:!0,closable:!0,minimizable:!1,draggable:!1,resizable:!1,halign:"none",valign:"none",top:"0px",bottom:"0px",left:"0px",right:"0px",minimized:!1,on_close:null},i=function(b,c){var d=a[b.id];d.dialog.classList.contains(g.open)&&(b.classList.add(g.closed),b.classList.remove(g.open),c&&null!==d.opts.on_close&&d.opts.on_close())},j=function(b){var c=0,d=null;for(var e in a)a.hasOwnProperty(e)&&(d=a[e].dialog,isNaN(d.style.zIndex)||(c=parseInt(d.style.zIndex,10),c>100&&(d.style.zIndex=100)));b.style.zIndex=101},k=function(a,b){a.classList.toggle(g.minimize),a.classList.toggle(g.maximize),b.classList.toggle("wui-dialog-minimized")},l=function(){null===f&&(f=setTimeout(function(){f=null;var a,b=document.getElementsByClassName(g.content);for(a=0;b.length>a;a+=1){var c=b[a],d=c.parentElement;c.style.height=d.offsetHeight-32+"px"}},125))},m=function(a){a.preventDefault(),a.stopPropagation();var b=a.target,c=null;b.classList.contains(g.btn_close)?(c=b.parentElement.parentElement,i(c,!0)):(b.classList.contains(g.maximize)||b.classList.contains(g.minimize))&&(c=b.parentElement.parentElement,k(b,c))},n=function(f){f.preventDefault();var g,h,i,j=f.clientX,k=f.clientY,l=f.changedTouches,m=null,n=a[b.id];if(l)for(g=0;l.length>g;g+=1)if(m=l[g],m.identifier===c){j=l[g].clientX,k=l[g].clientY;break}h=j-d,i=k-e,b.style.left=h+"px",b.style.top=i+"px","right"===n.opts.halign?b.style.right=h+"px":"center"===n.opts.halign&&(b.style.right=-h+"px"),"bottom"===n.opts.valign?b.style.bottom=i+"px":"center"===n.opts.valign&&(b.style.bottom=-i+"px")},o=function(a){var d,e=a.changedTouches,f=null;if(e){for(d=0;e.length>d;d+=1)if(f=e[d],f.identifier===c){b=null,document.body.style.cursor="default",window.removeEventListener("touchmove",n,!1),window.removeEventListener("touchmove",o,!1);break}}else b=null,document.body.style.cursor="default",window.removeEventListener("mousemove",n,!1),window.removeEventListener("mousemove",o,!1)},p=function(a){var f=a.clientX,h=a.clientY,i=a.changedTouches;if(a.preventDefault&&a.preventDefault(),null===b)if(i)c=i[0].identifier,f=i[0].clientX,h=i[0].clientY;else if(0!==a.button)return;b=a.target.parentElement,!b.classList.contains(g.maximize)&&b.classList.contains(g.draggable)&&(j(b),document.body.style.cursor="move",d=f-parseInt(b.style.left,10),e=h-parseInt(b.style.top,10),window.addEventListener("mousemove",n,!1),window.addEventListener("touchmove",n,!1),window.addEventListener("mouseup",o,!1),window.addEventListener("touchend",o,!1))};this.create=function(b,c){var d,e={};if(void 0!==a[b])return void console.log("WUI_Dialog id '"+b+"' already created, aborting.");for(d in h)h.hasOwnProperty(d)&&(e[d]=h[d]);if(void 0!==c)for(d in c)c.hasOwnProperty(d)&&void 0!==h[d]&&(e[d]=c[d]);var f=document.getElementById(b),i=document.createElement("div"),j=null,n=null,o=null;if(null===f)return void("undefined"!=typeof console&&console.log('WUI dialog create, unknow element with id "'+b+'".'));var q=f.firstElementChild;return null===q&&(q=document.createElement("div"),f.appendChild(q)),f.style.width=e.width,f.style.height=e.height,e.resizable&&(f.style.resize="both"),"center"===e.halign?(f.style.left="0",f.style.right="0"):"right"===e.halign?(f.style.right="0",f.style.left="auto"):"left"===e.halign?f.style.left="0":(f.style.left=e.left,f.style.right=e.right),"center"===e.valign?(f.style.top="0",f.style.bottom="0"):"bottom"===e.valign?(f.style.top="auto",f.style.bottom="0"):"top"===e.valign?f.style.top="0":(f.style.top=e.top,f.style.bottom=e.bottom),f.classList.add(g.dialog),q.classList.add(g.content),i.className=g.header,q.style.height=f.offsetHeight-32+"px",""!==e.title&&(o=document.createElement("div"),o.className="wui-dialog-title",o.innerHTML=e.title,i.appendChild(o)),f.classList.add(e.open?g.open:g.closed),e.draggable&&(f.classList.toggle(g.draggable),i.addEventListener("mousedown",p,!1),i.addEventListener("touchstart",p,!1)),e.closable&&(j=document.createElement("div"),j.className=g.btn+" "+g.btn_close,i.appendChild(j)),e.minimizable&&(n=document.createElement("div"),n.className=g.btn+" "+g.minimize,e.minimized&&k(n,f),i.appendChild(n)),f.addEventListener("click",m,!1),f.addEventListener("touchstart",m,!1),window.addEventListener("resize",l,!1),f.classList.add("wui-dialog-transition"),f.insertBefore(i,q),a[b]={dialog:f,minimized_id:-1,bottom_pos:f.style.bottom,opts:e},b},this.open=function(b){var c=a[b];return void 0===c?void("undefined"!=typeof console&&console.log('Cannot open WUI dialog "'+b+'".')):(c.dialog.classList.remove(g.closed),c.dialog.classList.add(g.open),void j(c.dialog))},this.close=function(b,c){var d=a[b];return void 0===d?void("undefined"!=typeof console&&console.log('Cannot close WUI dialog "'+b+'".')):void i(d.dialog,c)},this.destroy=function(b){var c,d=a[b];return void 0===d?void console.log("Element id '"+b+"' is not a WUI_Dialog, destroying aborted."):(c=d.dialog,c.parentElement.removeChild(c),void delete a[b])}},WUI_DropDown=new function(){var a={},b={dropdown:"wui-dropdown",item:"wui-dropdown-item",content:"wui-dropdown-content",selected:"wui-dropdown-selected",open:"wui-dropdown-open"},c={width:"auto",height:24,ms_before_hiding:2e3,vertical:!1,vspacing:0,selected_id:0,on_item_selected:null},d=function(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:Math.round(i),left:Math.round(j)}},e=function(a){a.floating_content.classList.remove(b.open),a.element.classList.remove("wui-dropdown-on"),a.close_timeout=null},f=function(c){c.preventDefault(),c.stopPropagation();var d=c.target,f=null,g=null;d.classList.contains(b.dropdown)&&(f=a[d.id],g=f.floating_content,f.floating_content.classList.contains(b.open)&&e(f))},g=function(c){c.preventDefault(),c.stopPropagation();var d,e=c.target,f=a[e.id],g=null,h=null;if(e.classList.contains(b.item)){for(g=e.parentElement,f=a[g.dataset.linkedto],h=g.getElementsByTagName("div"),d=0;h.length>d;d+=1)h[d].classList.remove(b.selected);e.classList.add(b.selected),f.button_item.innerHTML=e.textContent,void 0!==f.opts.on_item_selected&&f.opts.on_item_selected(e.dataset.index)}},h=function(c){c.preventDefault(),c.stopPropagation();var e=c.target,f=null,g=null,h=null;if(e.classList.contains(b.dropdown))f=a[e.id],f.element.classList.add("wui-dropdown-on"),h=f.floating_content,g=d(e),h.style.top=g.top-h.offsetHeight-f.opts.vspacing+"px",h.style.left=g.left+"px",h.classList.add(b.open);else if(e.classList.contains(b.content))f=a[e.dataset.linkedto];else{if(!e.classList.contains(b.item))return;f=a[e.parentElement.dataset.linkedto]}window.clearTimeout(f.close_timeout),e.addEventListener("mouseleave",i,!1)},i=function(c){c.preventDefault();var d=c.target,f=null;f=d.classList.contains(b.content)?a[d.dataset.linkedto]:d.classList.contains(b.item)?a[d.parentElement.dataset.linkedto]:a[d.id],f.close_timeout=window.setTimeout(e,f.opts.ms_before_hiding,f),d.removeEventListener("mouseleave",i,!1)};this.create=function(d,e,i){var j,k=document.getElementById(d),l=null,m="",n=[],o={},p=0;if(void 0!==a[d])return void console.log("WUI_DropDown id '"+d+"' already created, aborting.");for(j in c)c.hasOwnProperty(j)&&(o[j]=c[j]);if(void 0!==e)for(j in e)e.hasOwnProperty(j)&&void 0!==c[j]&&(o[j]=e[j]);k.classList.add(b.dropdown),k.style.width=o.width,k.style.height=o.height;var q=document.createElement("div");q.classList.add("wui-dropdown-icon"),k.appendChild(q);var r=document.createElement("div");r.classList.add("wui-dropdown-text"),0!==i.length&&(r.innerHTML=i[o.selected_id]),k.appendChild(r);var s=document.createElement("div");for(k.addEventListener("click",f,!1),p=0;i.length>p;p+=1)m=i[p],l=document.createElement("div"),o.vertical||l.classList.add("wui-dropdown-horizontal"),l.classList.add(b.item),l.innerHTML=m,l.dataset.index=p,s.appendChild(l),n.push(l),l.addEventListener("click",g,!1),m===i[o.selected_id]&&l.classList.add(b.selected);k.addEventListener("mouseover",h,!1),s.addEventListener("mouseover",h,!1),s.classList.add(b.content),s.dataset.linkedto=d,document.body.appendChild(s);var t={element:k,floating_content:s,items:n,opts:o,button_item:r,hover_count:0,close_timeout:null};return a[d]=t,d},this.destroy=function(b){var c,d,e=a[b];return void 0===e?void console.log("Element id '"+b+"' is not a WUI_DropDown, destroying aborted."):(c=e.element,d=e.floating_content,c.parentElement.removeChild(c),d.parentElement.removeChild(d),void delete a[b])}},WUI_RangeSlider=new function(){var a={},b=null,c=null,d=null,e=null,f={hook:"wui-rangeslider-hook",bar:"wui-rangeslider-bar",filler:"wui-rangeslider-filler",hook_focus:"wui-rangeslider-hook-focus"},g={width:148,height:8,title:"",title_min_width:0,value_min_width:0,min:0,max:1,step:.01,scroll_step:.01,vertical:!1,title_on_top:!1,on_change:null,default_value:.5},h=function(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:Math.round(i),left:Math.round(j)}},i=function(a,b){null!==a&&a(b)},j=function(a,b){var c=""+a,d=c.indexOf("."),e=-1==d?c.length:1+d+b,f=c.substr(0,e),g=isNaN(f)?0:f;return parseFloat(g)},k=function(a){return a.classList.contains(f.hook)?a:a.classList.contains(f.filler)?a.firstElementChild:a.firstElementChild.firstElementChild},l=function(a,b){var c=a.element,d=c.childNodes[2],e=c.childNodes[1],f=e.firstElementChild,g=f.firstElementChild,h=a.opts.width,i=a.opts.height,k=Math.abs((b-a.opts.min)/a.opts.range);a.opts.vertical?(k=Math.round(k*e.offsetHeight),f.style.position="absolute",f.style.bottom="0",f.style.width="100%",f.style.height=k+"px",g.style.marginTop=-h+"px",g.style.marginLeft=-h/2-1+"px",g.style.width=2*h+"px",g.style.height=2*h+"px",d.style.marginTop="13px"):(k=Math.round(k*h),f.style.width=k+"px",f.style.height="100%",g.style.left=k+"px",g.style.marginTop=-i/2+"px",g.style.marginLeft=-i+"px",g.style.width=2*i+"px",g.style.height=2*i+"px"),d.value=j(b,4),a.value=b},m=function(a){if(a.preventDefault(),null!==d){var f,g=c.element.lastElementChild,k=d.parentElement,l=k.parentElement,m=h(l),n=l.offsetWidth,o=0,p=a.clientX,q=a.clientY,r=a.changedTouches,s=null;if(r)for(f=0;r.length>f;f+=1)if(s=r[f],s.identifier===e){p=r[f].clientX,q=r[f].clientY;break}if(c.opts.vertical?(n=l.offsetHeight,o=Math.round((m.top+l.offsetHeight-q)/c.opts.step)*c.opts.step):o=Math.round((p-m.left)/c.opts.step)*c.opts.step,o>n?(o=n,b=c.opts.max):0>o?(o=0,b=c.opts.min):b=Math.round((c.opts.min+o/n*c.opts.range)/c.opts.step)*c.opts.step,c.value===b)return;c.value=b,g.value=j(b,4),c.opts.vertical?k.style.height=o+"px":(k.style.width=o+"px",d.style.left=o+"px"),i(c.opts.on_change,b)}},n=function(a){a.preventDefault();var b,g=a.changedTouches,h=null,i=!1;if(g){for(b=0;g.length>b;b+=1)if(h=g[b],h.identifier===e){i=!0,window.removeEventListener("touchend",n,!1),window.removeEventListener("touchmove",m,!1);break}}else i=!0,window.removeEventListener("mouseup",n,!1),window.removeEventListener("mousemove",m,!1);i&&(d.classList.remove(f.hook_focus),d=null,c=null,document.body.style.cursor="default")},o=function(b){b.preventDefault(),b.stopPropagation();var g=null,h=!1,i=b.changedTouches;null===c&&i&&(e=i[0].identifier,h=!0),0===b.button&&(h=!0),h&&(d=k(b.target),d.classList.add(f.hook_focus),g=d.parentElement.parentElement.parentElement,c=a[g.id],document.body.style.cursor="pointer",m(b),window.addEventListener("mousemove",m,!1),window.addEventListener("touchmove",m,!1),window.addEventListener("mouseup",n,!1),window.addEventListener("touchend",n,!1))},p=function(b){b.preventDefault(),b.stopPropagation();var c=b.target,d=c.parentElement.parentElement.parentElement,e=a[d.id],f=e.opts.default_value;l(e,f),i(e.opts.on_change,f)},q=function(b){b.preventDefault(),b.stopPropagation();var c=k(b.target),d=c.parentElement.parentElement.parentElement,e=a[d.id],f=b.wheelDelta?b.wheelDelta/40:b.detail?-b.detail:0,g=e.value;f>=0?g+=e.opts.scroll_step:g-=e.opts.scroll_step,g>e.opts.max?g=e.opts.max:e.opts.min>g&&(g=e.opts.min),l(e,g),i(e.opts.on_change,g)},r=function(b){if(!b.target.validity||b.target.validity.valid){var c=b.target.parentElement.childNodes[1];if(void 0!==c){var d=k(c),e=d.parentElement.parentElement.parentElement,f=a[e.id];l(f,b.target.value),i(f.opts.on_change,b.target.value)}}};this.create=function(b,c){var d,e=document.getElementById(b),h={};if(void 0!==a[b])return void console.log("WUI_RangeSlider id '"+b+"' already created, aborting.");for(d in g)g.hasOwnProperty(d)&&(h[d]=g[d]);if(void 0!==c){for(d in c)c.hasOwnProperty(d)&&void 0!==g[d]&&(h[d]=c[d]);void 0!==c.max&&(h.range=c.max),void 0!==c.step&&(h.step=c.step,void 0===c.scroll_step&&(h.scroll_step=h.step)),void 0!==c.title_on_top?h.title_on_top=c.title_on_top:h.vertical&&(h.title_on_top=!0),void 0!==c.default_value?h.default_value=c.default_value:void 0!==c.min&&void 0!==c.max&&(h.default_value=h.min+h.max/2)}0>h.min&&(h.range=h.max-h.min),a[b]=null,e.classList.add("wui-rangeslider"),h.title_on_top&&e.classList.add("wui-rangeslider-title-ontop");var i=document.createElement("div"),j=document.createElement("div"),k=document.createElement("div"),m=document.createElement("div"),n=document.createElement("div"),s=document.createElement("input"),t={element:e,opts:h,value:h.default_value};return i.innerHTML=h.title,s.setAttribute("value",h.default_value),s.setAttribute("type","number"),s.setAttribute("min",h.min),s.setAttribute("max",h.max),s.setAttribute("step",h.step),s.classList.add("wui-rangeslider-input"),n.classList.add("wui-rangeslider-value"),i.classList.add("wui-rangeslider-title"),j.classList.add(f.bar),k.classList.add(f.filler),m.classList.add(f.hook),i.style.minWidth=h.title_min_width+"px",n.style.minWidth=h.value_min_width+"px",s.style.minWidth=h.value_min_width+"px",j.style.width=h.width+"px",j.style.height=h.height+"px",j.appendChild(k),k.appendChild(m),e.appendChild(i),e.appendChild(j),e.appendChild(s),l(t,h.default_value),j.addEventListener("mousedown",o,!1),j.addEventListener("touchstart",o,!1),m.addEventListener("dblclick",p,!1),s.addEventListener("input",r,!1),j.addEventListener("mousewheel",q,!1),j.addEventListener("DOMMouseScroll",q,!1),a[b]=t,b},this.destroy=function(b){var c,d=a[b];return void 0===d?void console.log("Element id '"+b+"' is not a WUI_RangeSlider, destroying aborted."):(c=d.element,c.parentElement.removeChild(c),void delete a[b])}},WUI_Tabs=new function(){var a={},b={enabled:"wui-tab-enabled",disabled:"wui-tab-disabled",display_none:"wui-tab-display-none",tabs:"wui-tabs",tab:"wui-tab",tabs_content:"wui-tabs-content",tab_content:"wui-tab-content",underline:"wui-tabs-underline"},c={on_tab_click:null},d=function(c){c.preventDefault(),c.stopPropagation();var d=c.target,e=d.parentElement,f=e.nextElementSibling.nextElementSibling,g=e.parentElement.id,h=0,i=null,j=0;for(j=0;e.childElementCount>j;j+=1)i=e.children[j],i.classList.remove(b.enabled),i.classList.add(b.disabled),i===d&&(h=j);for(j=0;f.childElementCount>j;j+=1)i=f.children[j],i.classList.remove(b.display_none),h!==j&&i.classList.add(b.display_none);c.target.classList.remove(b.disabled),c.target.classList.toggle(b.enabled),a[g].opts.on_tab_click&&a[g].opts.on_tab_click(h)};this.create=function(e,f){var g,h=document.getElementById(e),i=h.firstElementChild,j=document.createElement("div"),k=i.nextElementSibling,l=i.children[0],m={},n=0;if(void 0!==a[e])return void console.log("WUI_Tabs id '"+e+"' already created, aborting.");for(g in c)c.hasOwnProperty(g)&&(m[g]=c[g]);if(void 0!==f)for(g in f)f.hasOwnProperty(g)&&void 0!==c[g]&&(m[g]=f[g]);j.className="wui-tabs-underline",h.insertBefore(j,k),i.classList.add(b.tabs);var o=i.childElementCount;for(n=0;o>n;n+=1){var p=i.children[n];p.classList.add("wui-tab"),p!==l&&p.classList.add(b.disabled),p.addEventListener("click",d,!1)}l.classList.add(b.enabled),l.classList.add("wui-first-tab"),k.classList.add("wui-tabs-content");var q=k.childElementCount;for(k.style.height=k.offsetHeight-32+"px",k.children[0].classList.add(b.tab_content),n=1;q>n;n+=1){var r=k.children[n];r.classList.add(b.tab_content),r.classList.add(b.display_none)}return a[e]={element:h,opts:m},e},this.getContentElement=function(a,b){var c=document.getElementById(a),d=c.firstElementChild.nextElementSibling.nextElementSibling;return d.children[b]},this.getTabName=function(a,b){var c=this.getContentElement(a,b);return c.getAttribute("data-group-name")},this.destroy=function(c){var d,e,f,g,h,i=a[c];if(void 0===i)return void console.log("Element id '"+c+"' is not a WUI_Tabs, destroying aborted.");if(d=i.element,d.classList.contains("wui-dialog-content"))for(e=d.getElementsByClassName(b.tabs),f=d.getElementsByClassName(b.underline),g=d.getElementsByClassName(b.tabs_content),h=0;e.length>h;h+=1)d.removeChild(e[h]),d.removeChild(f[h]),d.removeChild(g[h]);else d.parentElement.removeChild(d);delete a[c]}},WUI_ToolBar=new function(){var a={},b={minimize_icon:"wui-toolbar-minimize-icon",maximize_icon:"wui-toolbar-maximize-icon",button:"wui-toolbar-button",minimize_group:"wui-toolbar-minimize-group",minimize_gr_v:"wui-toolbar-minimize-group-vertical",toggle:"wui-toolbar-toggle",toggle_on:"wui-toolbar-toggle-on",item:"wui-toolbar-item",group:"wui-toolbar-group",vertical_group:"wui-toolbar-group-vertical",dd_content:"wui-toolbar-dropdown-content",dd_item:"wui-toolbar-dropdown-item",dd_open:"wui-toolbar-dropdown-open"},c={item_hmargin:null,item_vmargin:null,item_width:32,item_height:32,icon_width:32,icon_height:32,allow_groups_minimize:!1,vertical:!1},d=function(b){var c=a[b];return void 0===c?("undefined"!=typeof console&&console.log('_getWidget failed, the element id "'+b+'" is not a WUI_ToolBar.'),null):c},e=function(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:Math.round(i),left:Math.round(j)}},f=function(c,d){return void 0!==d?a[d]:c.classList.contains(b.minimize_icon)||c.classList.contains(b.maximize_icon)?a[c.parentElement.id]:a[c.parentElement.parentElement.id]},g=function(a,b,c){if(void 0!==a.on_click&&null!==a.on_click){var d={id:a.id,type:b};void 0!==c&&(d.state=c),a.on_click(d)}},h=function(a,c,d){var e,h=null,i=!1,j=0;h=f(a,c);var k=h.tools[a.dataset.tool_id];if("1"===k.element.dataset.on?(k.element.dataset.on=0,k.element.title=k.tooltip,void 0!==k.icon&&(k.element.classList.add(k.icon),k.element.classList.remove(k.toggled_icon))):(k.element.dataset.on=1,void 0!==k.tooltip_toggled&&(k.element.title=k.tooltip_toggled),void 0!==k.toggled_icon&&(k.element.classList.add(k.toggled_icon),k.element.classList.remove(k.icon)),i=!0),"none"!==k.toggled_style&&k.element.classList.toggle(b.toggle_on),e=a.dataset.toggle_group,void 0!==e)for(j=0;h.tools.length>j;j+=1){var l=h.tools[j];if(e===l.element.dataset.toggle_group&&l.element!==a){if("0"===l.element.dataset.on)continue;l.element.dataset.on="0",l.element.classList.remove(b.toggle_on),void 0!==l.toggled_icon&&l.element.classList.remove(l.toggled_icon),void 0!==l.icon&&l.element.classList.add(l.icon),(d||void 0===d)&&g(l,"toggle",!1)}}(d===!0||void 0===d)&&g(k,"toggle",i)},i=function(c){c.preventDefault(),c.stopPropagation();var d=c.target,e=d.parentElement,f=a[e.dataset.linkedto_tb],g=f.tools[parseInt(e.dataset.linkedto_tool_index,10)],h=parseInt(d.dataset.index,10),i=g.items[h];void 0!==i.on_click&&(i.on_click(),g.element.classList.remove(b.toggle_on),e.classList.remove(b.dd_open))},j=function(a,c){c.classList.remove(b.dd_open),a.element.classList.remove(b.toggle_on)},k=function(a,b){var c=function(){j(a,b),window.removeEventListener("click",c)};return c},l=function(a){a.preventDefault(),a.stopPropagation();var c=a.target;if(c.classList.contains(b.minimize_group)||c.classList.contains(b.minimize_gr_v))return void m(c);if(c.classList.contains(b.toggle))return void h(c);var d=null,i=null,l=null,n=null;if(n=f(c),d=n.tools[c.dataset.tool_id],"dropdown"===d.type){if(i=d.floating_content,c.classList.contains(b.toggle_on))return void j(d,i);var o=d.element;o.classList.add(b.toggle_on),l=e(c),"tb_item"===d.dd_items_width&&(i.style.width=c.offsetWidth+"px"),"s"===d.orientation?(i.style.top=l.top+c.offsetHeight+"px",i.style.left=l.left+"px"):"sw"===d.orientation?(i.style.top=l.top+c.offsetHeight+"px",i.style.left=l.left-i.offsetWidth+"px"):"nw"===d.orientation?(i.style.top=l.top-i.offsetHeight+c.offsetHeight+"px",i.style.left=l.left-i.offsetWidth+"px"):"se"===d.orientation?(i.style.top=l.top+c.offsetHeight+"px",i.style.left=l.left+c.offsetWidth+"px"):"ne"===d.orientation?(i.style.top=l.top-i.offsetHeight+c.offsetHeight+"px",i.style.left=l.left+c.offsetWidth+"px"):(i.style.top=l.top-i.offsetHeight+"px",i.style.left=l.left+"px"),i.classList.add(b.dd_open),a.stopPropagation&&a.stopPropagation(),window.addEventListener("click",k(d,i),!1)}else g(d,"click")},m=function(a){var c=a.nextSibling;a.classList.contains(b.minimize_icon)?(a.classList.add(b.maximize_icon),a.classList.remove(b.minimize_icon),a.title="Maximize group",c.style.display="none"):(a.classList.add(b.minimize_icon),a.classList.remove(b.maximize_icon),a.title="Minimize group",c.style.display="")};this.create=function(d,e,f){var g,j=document.getElementById(d),k=null,m=null,n=null,o=null,p={};if(void 0!==a[d])return void console.log("WUI_Toolbar id '"+d+"' already created, aborting.");for(g in c)c.hasOwnProperty(g)&&(p[g]=c[g]);if(void 0!==f)for(g in f)f.hasOwnProperty(g)&&void 0!==c[g]&&(p[g]=f[g]);a[d]={element:j,tools:[],opts:p},j.classList.add("wui-toolbar");var q=b.group,r=b.item,s="wui-toolbar-spacer",t=b.minimize_group;p.vertical?(j.classList.add("wui-toolbar-vertical"),q=b.vertical_group,r+=" wui-toolbar-item-vertical",s="wui-toolbar-spacer-vertical",t=b.minimize_gr_v,j.style.maxWidth=p.item_width+4+"px",null===p.item_hmargin&&(p.item_hmargin=3),null===p.item_vmargin&&(p.item_vmargin=8)):(j.style.maxHeight=p.item_height+4+"px",null===p.item_hmargin&&(p.item_hmargin=3),null===p.item_vmargin&&(p.item_vmargin=0)),t=b.button+" "+b.minimize_icon+" "+t,j.addEventListener("click",l,!1);for(n in e)if(e.hasOwnProperty(n)){null!==o&&(m=document.createElement("div"),m.className=s,j.appendChild(m)),p.allow_groups_minimize&&(m=document.createElement("div"),m.className=t,m.title="Minimize group",j.appendChild(m)),k=e[n];var u=document.createElement("div");u.className=q,p.vertical?u.style.maxWidth=p.item_width+"px":u.style.maxHeight=p.item_height+"px";for(var v=0;k.length>v;v+=1){var w,x=k[v],y=document.createElement("div"),z=a[d].tools.length,A={element:y,on_click:x.on_click,icon:x.icon,items:[],tooltip:"",type:x.type,dd_items_width:x.dropdown_items_width,orientation:x.orientation,id:z};if(y.className=r,y.style.minWidth=p.item_width+"px",y.style.minHeight=p.item_height+"px",y.style.marginLeft=p.item_hmargin+"px",y.style.marginRight=p.item_hmargin+"px",y.style.marginTop=p.item_vmargin+"px",y.style.marginBottom=p.item_vmargin+"px",y.style.backgroundSize=p.icon_width-4+"px "+(p.icon_height-4)+"px",u.appendChild(y),a[d].tools.push(A),y.dataset.tool_id=z,A.tooltip=x.tooltip,void 0!==x.tooltip&&(y.title=x.tooltip),void 0!==x.text&&(y.innerHTML=x.text,y.style.lineHeight=p.item_height+"px",y.classList.add("wui-toolbar-text"),void 0!==x.icon&&(y.style.paddingLeft=p.icon_width+2+"px",y.style.backgroundPosition="left center")),void 0!==x.icon&&y.classList.add(x.icon),"toggle"===x.type)y.classList.add(b.toggle),A.toggled_icon=x.toggled_icon,A.tooltip_toggled=x.tooltip_toggled,A.toggled_style=x.toggled_style,void 0!==x.toggle_group&&(y.dataset.toggle_group=x.toggle_group),x.toggle_state&&(y.dataset.on="0",h(y,d,!0));else if("dropdown"===x.type){y.classList.add(b.button);var B=document.createElement("div");if(void 0!==x.items)for(w=0;x.items.length>w;w+=1){var C=x.items[w],D=document.createElement("div");x.vertical||D.classList.add("wui-toolbar-dropdown-horizontal"),D.classList.add(b.dd_item),D.innerHTML=C.title,D.dataset.index=w,B.appendChild(D),A.items.push({element:D,on_click:C.on_click})}B.addEventListener("click",i,!1),A.floating_content=B,B.style.width=A.dd_items_width+"px",B.classList.add(b.dd_content),B.dataset.linkedto_tb=d,B.dataset.linkedto_tool_index=z,document.body.appendChild(B)}else y.classList.add(b.button)}j.appendChild(u),o=k}return d},this.hideGroup=function(a,c){var e,f,g,h=d(a);if(h){if(e=h.element.getElementsByClassName(h.opts.vertical?b.vertical_group:b.group),0===e.length)return;f=e[c],g=f.previousElementSibling,(g.classList.contains(b.minimize_group)||g.classList.contains(b.minimize_gr_v))&&(g.style.display="none"),f.style.display="none"}},this.showGroup=function(a,c){var e,f,g,h=d(a);if(h){if(e=h.element.getElementsByClassName(h.opts.vertical?b.vertical_group:b.group),0===e.length)return;f=e[c],g=f.previousElementSibling,(g.classList.contains(b.minimize_group)||g.classList.contains(b.minimize_gr_v))&&(g.style.display=""),e[c].style.display=""}},this.toggle=function(a,b,c){var e=d(a);e&&h(e.tools[b].element,a,c)},this.getItemElement=function(a,b){var c=d(a);return c?c.tools[b].element:void 0},this.destroy=function(b){var c,d,e,f,g,h,i,j=a[b];if(void 0===j)return void console.log("Element id '"+b+"' is not a WUI_ToolBar, destroying aborted.");for(c=j.toolbar,d=j.tools,c.parentElement.removeChild(c),i=0;d.length>i;i+=1)e=d[i],"dropdown"===e.type&&(f=e.items,f.length>0&&(g=f[0],h=g.element,h.parentElement.removeChild(h)));delete a[b]}},WUI=new function(){var a=[WUI_DropDown,WUI_Dialog,WUI_RangeSlider,WUI_ToolBar,WUI_Tabs],b={display_none:"wui-display-none",hide_fi_500:"wui-hide-fi-500",hide_show_500:"wui-show-fi-500",draggable:"wui-draggable"},c=[],d=null,e=null,f=0,g=0,h=function(a,c,d){var e=function(){d&&a.classList.add(b.display_none),c&&c(),a.removeEventListener("transitionend",e)};return e},i=function(a){a.preventDefault();var c=a.clientX,h=a.clientY,i=a.changedTouches;if(a.target.classList.contains(b.draggable)){if(null===d)if(i)e=i[0].identifier,c=i[0].clientX,h=i[0].clientY;else if(0!==a.button)return;d=a.target,document.body.style.cursor="move",f=c-parseInt(d.style.left,10),g=h-parseInt(d.style.top,10),window.addEventListener("mousemove",j,!1),window.addEventListener("touchmove",j,!1),window.addEventListener("mouseup",k,!1),window.addEventListener("touchend",k,!1)}},j=function(a){a.preventDefault();var b,h,i,j=a.clientX,k=a.clientY,l=a.changedTouches,m=null,n=c[parseInt(d.dataset.wui_draggable_id,10)];if(l)for(b=0;l.length>b;b+=1)if(m=l[b],m.identifier===e){j=l[b].clientX,k=l[b].clientY;break}h=j-f,i=k-g,d.style.left=h+"px",d.style.top=i+"px",n&&n.cb(d,h,i)},k=function(a){a.preventDefault();var b,f=a.changedTouches,g=null;if(0!==c.length)if(f){for(b=0;f.length>b;b+=1)if(g=f[b],g.identifier===e){d=null,document.body.style.cursor="default",window.removeEventListener("touchmove",j,!1),window.removeEventListener("touchend",k,!1);break}}else d=null,document.body.style.cursor="default",window.removeEventListener("mousemove",j,!1),window.removeEventListener("mouseup",k,!1)};this.dispatchEvent=function(b,c){for(var d=0;a.length>d;d+=1)a[d].triggerEvent(b,c)},this.fadeOut=function(a,c,d){a.addEventListener("transitionend",h(a,c,d),!1),a.classList.add(b.hide_fi_500),a.classList.remove(b.hide_show_500)},this.fadeIn=function(a){a.classList.remove(b.hide_fi_500),a.classList.add(b.hide_show_500),a.classList.remove(b.display_none)},this.draggable=function(a,d,e){if(d)a.classList.add(b.draggable),a.addEventListener("mousedown",i,!1),a.addEventListener("touchstart",i,!1),a.dataset.wui_draggable_id=c.length,c.push({cb:e,element:a});else{a.classList.remove(b.draggable),a.removeEventListener("mousedown",i,!1),a.removeEventListener("touchstart",i,!1);var f,g=parseInt(a.dataset.wui_draggable_id,10);for(c.splice(g,1),f=0;c.length>f;f+=1){var h=c[f];h.element.dataset.wui_draggable_id=f}}}};
